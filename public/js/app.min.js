Object.sort=function(e,r){var t,i;do{t=!1,i=null;for(var s in e){if(i&&Number(e[s][r])<Number(e[i][r])){var o=e[s];e[s]=e[i],e[i]=o,t=!0}i=s}}while(t)},Object.index=function(e,r,t){for(var i in e)if(e[i][r]==t)return i},Object.find=function(e,r,t){for(var i in e)if(e[i][r]==t)return e[i];return!1},Object.maxTime=function(e,r){var t,i="";for(var s in e)(!t||t<new Date(e[s][r]))&&(t=new Date(e[s][r]),i=e[s][r]);return i},Object.size=function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},Object.time=function(e){var r,t=[];for(r in e)t.push(new Date(e[r].time));return t.length?t.sort()[t.length-1].getTime()/1e3:0},function(e){e.fn.serializeObject=function(){var r=this,t={},i={},s={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,r,t){return e[r]=t,e},this.push_counter=function(e){return void 0===i[e]&&(i[e]=0),i[e]++},e.each(e(this).serializeArray(),function(){if(s.validate.test(this.name)){for(var i,o=this.name.match(s.key),n=this.value,a=this.name;void 0!==(i=o.pop());)a=a.replace(new RegExp("\\["+i+"\\]$"),""),i.match(s.push)?n=r.build([],r.push_counter(a),n):i.match(s.fixed)?n=r.build([],i,n):i.match(s.named)&&(n=r.build({},i,n));t=e.extend(!0,t,n)}}),t}}(jQuery);var numFormat=function(e){var r=e.toString().split(".");return r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),r.join(".")},letterToNumbers=function(e){e=e.toUpperCase();var r,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=0;for(r=0;r<e.length;r++)i+=Math.pow(t.length,r)*(t.indexOf(e.substr(-1*(r+1),1))+1);return i},sigFormat=function(e,r){if(!e)return"";for(var t=/^[a-zA-Z]+$/,i=/^[0-9]+$/,s="type"==r?options.chain.typeFormat||"":options.chain.classFormat||"",o=0,n=s.length;o<n;o++)if(s[o].match(t)){if("B"==s[o].toUpperCase()&&"a"==e)return"";s=s[o]==s[o].toUpperCase()?s.substr(0,o)+e.toUpperCase()+s.substr(o+1,n):s.substr(0,o)+e+s.substr(o+1,n)}else if(s[o].match(i)){if(2==s[o]&&"a"==e)return"";s=s.substr(0,o)+letterToNumbers(e)+s.substr(o+1,n)}return s},sigClass=function(e,r){var t=$.map(tripwire.systems,function(r,t){return r.name==e?t:null})[0],i={name:e,class:t?tripwire.systems[t].class:null,security:t?tripwire.systems[t].security:null,type:r},s=null;return 6==i.class||"Class-6"==i.name||void 0!==tripwire.wormholes[i.type]&&"Class 6"==tripwire.wormholes[i.type].leadsTo?s="C6":5==i.class||"Class-5"==i.name||void 0!==tripwire.wormholes[i.type]&&"Class 5"==tripwire.wormholes[i.type].leadsTo?s="C5":4==i.class||"Class-4"==i.name||void 0!==tripwire.wormholes[i.type]&&"Class 4"==tripwire.wormholes[i.type].leadsTo?s="C4":3==i.class||"Class-3"==i.name||void 0!==tripwire.wormholes[i.type]&&"Class 3"==tripwire.wormholes[i.type].leadsTo?s="C3":2==i.class||"Class-2"==i.name||void 0!==tripwire.wormholes[i.type]&&"Class 2"==tripwire.wormholes[i.type].leadsTo?s="C2":1==i.class||"Class-1"==i.name||void 0!==tripwire.wormholes[i.type]&&"Class 1"==tripwire.wormholes[i.type].leadsTo?s="C1":i.security>=.45||"High-Sec"==i.name||void 0!==tripwire.wormholes[i.type]&&"High-Sec"==tripwire.wormholes[i.type].leadsTo&&!i.security?s="HS":i.security>0||"Low-Sec"==i.name||void 0!==tripwire.wormholes[i.type]&&"Low-Sec"==tripwire.wormholes[i.type].leadsTo&&!i.security?s="LS":(i.security<=0&&null!=i.security||"Null-Sec"==i.name||void 0!==tripwire.wormholes[i.type]&&"Null-Sec"==tripwire.wormholes[i.type].leadsTo)&&(s="NS"),s},isEmpty=function(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return!0},getCookie=function(e){var r=document.cookie,t=r.indexOf(" "+e+"=");if(-1==t&&(t=r.indexOf(e+"=")),-1==t)r=null;else{t=r.indexOf("=",t)+1;var i=r.indexOf(";",t);-1==i&&(i=r.length),r=unescape(r.substring(t,i))}return r},setCookie=function(e,r,t){var i=new Date;i.setDate(i.getDate()+t);var s=escape(r)+(null==t?"":"; expires="+i.toUTCString());document.cookie=e+"="+s+";"+("https:"==document.location.protocol?"secure;":"")};
var viewingSystem=$("meta[name=system]").attr("content"),viewingSystemID=$("meta[name=systemID]").attr("content"),server=$("meta[name=server]").attr("content"),app_name=$("meta[name=app_name]").attr("content");"true"==getCookie("loadedFromBrowserCache")&&$("#pageTime").html("Page is Cached"),setCookie("loadedFromBrowserCache",!0);
var options=new function(){var t=["grid"],i=JSON.parse(localStorage.getItem("tripwire_options"));this.userID=init.userID,this.character={id:init.characterID,name:init.characterName},this.background=null,this.uiscale=1,this.favorites=[],this.grid={},this.tracking={active:"new"},this.masks={active:init.corporationID+".2"},this.chain={typeFormat:null,classFormat:null,gridlines:!0,active:0,tabs:[],"node-reference":"type"},this.signatures={pasteLife:72,alignment:{sigID:"centerAlign",sigType:"centerAlign",sigAge:"centerAlign",leadsTo:"centerAlign",sigLife:"centerAlign",sigMass:"centerAlign"}},this.buttons={follow:!1,chainWidget:{viewing:!1,favorites:!1},signaturesWidget:{autoMapper:!1}},this.save=function(){var t=JSON.stringify(this.get());return localStorage.setItem("tripwire_options",t),$.ajax({url:"options.php",data:{mode:"set",options:t},type:"POST",dataType:"JSON"})},this.load=function(t){t&&void 0!==t?this.set(this,t):i&&this.set(this,i),this.apply()},this.get=function(){var t={};for(var i in this)"function"!=typeof this[i]&&(t[i]=this[i]);return t},this.set=function(t,i){for(var s in i)i[s]&&i[s].constructor&&i[s].constructor===Object?t&&this.set(t[s],i[s]):t&&void 0!==t[s]&&(t[s]=i[s])},this.reset=function(){for(var t in this)"function"!=typeof this[t]&&(this[t]=JSON.parse(JSON.stringify(this.reset.defaults[t])))},this.apply=function(){if(i)for(key in t)this[t[key]]=i[t[key]];if(this.grid.hasOwnProperty("oog")&&!isEmpty(this.grid.oog)?$.each(this.grid.oog,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}):isEmpty(this.grid)||$.each(this.grid,function(){$("#"+this.id).attr({"data-col":this.col,"data-row":this.row,"data-sizex":this.size_x,"data-sizey":this.size_y}).css({width:this.width,height:this.height})}),this.favorites=$.map(this.favorites,function(t){return parseInt(t)}),this.buttons.follow&&$("#follow").addClass("active"),this.buttons.chainWidget.home&&$("#home").addClass("active"),this.buttons.chainWidget.kspace&&$("#k-space").addClass("active"),this.buttons.chainWidget.viewing&&$("#show-viewing").addClass("active"),this.buttons.chainWidget.favorites&&$("#show-favorite").addClass("active"),this.buttons.chainWidget.evescout&&$("#eve-scout").addClass("active"),-1!==$.inArray(parseInt(viewingSystemID),this.favorites)&&$("#system-favorite").attr("data-icon","star").addClass("active"),this.buttons.signaturesWidget.autoMapper&&$("#toggle-automapper").addClass("active"),this.uiscale&&$("body").css("zoom",this.uiscale),this.background){var s=$("<a>",{href:this.background})[0];$("#wrapper").attr("style","background-image: url(https://"+s.hostname+s.pathname+s.search+");")}else $("#wrapper").attr("style","");$("#dialog-options #characters").html("<img src='https://image.eveonline.com/Character/"+init.characterID+"_64.jpg' />"),$("#dialog-options input[name='mask']").filter("[value='"+this.masks.active+"']").attr("checked",!0),$("#chainTabs").html("");for(var a in this.chain.tabs)if(this.chain.tabs[a]){var e=$("#chainTab .tab").clone();e.attr("id",a).find(".name").data("tab",this.chain.tabs[a].systemID).html(this.chain.tabs[a].name),a==this.chain.active&&e.addClass("current"),$("#chainTabs").append(e)}"undefined"!=typeof tripwire&&chain.redraw()},this.reset.defaults=JSON.parse(JSON.stringify(this.get())),this.load(init&&init.options?init.options:null)};
var grid=$(".gridster ul").gridster({widget_selector:"li.gridWidget",avoid_overlapped_widgets:!1,widget_base_dimensions:[50,50],widget_margins:[5,5],autogrow_cols:!0,helper:"clone",draggable:{start:function(i,e){$("div.gridster").width($("div.gridster ul").width())}},resize:{enabled:!0,handle_class:"grid-resize",max_size:[30,30],min_size:[4,4],start:function(i){$("div.gridster").width($("div.gridster ul").width())},stop:function(i,e,s){switch(s.attr("id")){case"infoWidget":setTimeout("activity.redraw();",300)}}},serialize_params:function(i,e){return{id:i.attr("id"),col:e.col,row:e.row,size_x:e.size_x,size_y:e.size_y,width:i.width(),height:i.height()}}}).data("gridster").disable();grid.disable_resize(),$(".grid-resize").addClass("hidden").attr("data-icon","resize"),$(".gridster").css({visibility:"visible"}),$(".gridster > *").addClass("gridster-transition"),$("#layout").click(function(){$(this).hasClass("active")?(grid.disable(),grid.disable_resize(),$(".grid-resize").addClass("hidden"),$(this).removeClass("active"),options.grid=grid.serialize(),options.save()):(grid.enable(),grid.enable_resize(),$(".grid-resize").removeClass("hidden"),$(this).addClass("active"))});
var tripwire=new function(){this.timer,this.xhr,this.version="0.8.6",this.client={signatures:{}},this.server={signatures:{}},this.signatures={list:{},undo:JSON.parse(sessionStorage.getItem("tripwire_undo"))||{},redo:JSON.parse(sessionStorage.getItem("tripwire_redo"))||{}},this.activity={},this.data={tracking:{},esi:{}},this.refreshRate=5e3,this.connected=!0,this.ageFormat="HM",this.instance=window.name?window.name:((new Date).getTime(),window.name=(new Date).getTime()/1e3),this.stop=function(){return clearTimeout(this.timer),this.timer},this.start=function(){return this.sync()},this.setAgeFormat=function(e){var e=void 0!==e?e:this.ageFormat;return $("span[data-age]").each(function(){$(this).countdown("option",{format:e})}),!0},this.serverTime=function(){this.time,this.serverTime.getTime=function(){return tripwire.serverTime.time}},this.serverTime(),this.chainMap=function(){this.chainMap.parse=function(e){chain.draw(e)}},this.chainMap(),this.pastEOL=function(){var e={since:$(this).countdown("option","until"),format:"HM",layout:"-{hnn}{sep}{mnn}&nbsp;"};$(this).countdown("option",e)},this.whTooltip=function(e){if(viewingSystemID==e.systemID)if($.inArray(e.type,$.map(tripwire.wormholes,function(e,t){return t}))>=0)var t=e.type,i="";else i="<b>Type:</b> "+(t=e.sig2Type)+"<br/>";else if($.inArray(e.sig2Type,$.map(tripwire.wormholes,function(e,t){return t}))>=0)var t=e.sig2Type,i="";else i="<b>Type:</b> "+(t=e.type)+"<br/>";if($.inArray(t,$.map(tripwire.wormholes,function(e,t){return t}))>=0)s=!0;else var s=!1;if(i+="<b>Life:</b> "+(s?tripwire.wormholes[t].life:"Unknown")+"<br/>",s)switch(tripwire.wormholes[t].leadsTo.split(" ")[0]){case"High-Sec":i+="<b>Leads To:</b> <span class='hisec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Low-Sec":i+="<b>Leads To:</b> <span class='lowsec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Null-Sec":i+="<b>Leads To:</b> <span class='nullsec'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;case"Class":i+="<b>Leads To:</b> <span class='wh'>"+tripwire.wormholes[t].leadsTo+"</span><br/>";break;default:i+="<b>Leads To:</b> <span>"+tripwire.wormholes[t].leadsTo+"</span><br/>"}else i+="<b>Leads To:</b> <span>Unknown</span><br/>";return i+="<b>Max Mass</b>: "+(s?numFormat(tripwire.wormholes[t].mass):"Unknown")+" Kg<br/>",i+="<b>Max Jumpable</b>: "+(s?numFormat(tripwire.wormholes[t].jump):"Unknown")+" Kg<br/>"},this.ageTooltip=function(e){var t=new Date(e.lifeTime),i=6e4*t.getTimezoneOffset(),s='<table class="age-tooltip-table"><tr><th>Created:</th><td>'+((t=new Date(t.getTime()+i)).getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td></tr>";return e.lifeTime!=e.time&&(i=6e4*(t=new Date(e.time)).getTimezoneOffset(),s+="<tr><th>Last Modified:</th><td>"+((t=new Date(t.getTime()+i)).getMonth()+1)+"/"+t.getDate()+" "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+"</td></tr>"),s+="</table>"},this.refresh=function(e,t,i,s){var e=e||"refresh";this.sync(e,t,i,s)}};
function linkSig(e){return["Average Frontier Deposit","Unexceptional Frontier Deposit","Common Perimeter Deposit","Exceptional Core Deposit","Infrequent Core Deposit","Unusual Core Deposit","Rarified Core Deposit","Isolated Core Deposit","Ordinary Permiter Deposit","Uncommon Core Deposit","Barren Perimeter Reservoir","Minor Perimeter Reservoir","Ordinary Perimeter Reservoir","Sizeable Perimeter Reservoir","Token Perimeter Reservoir","Bountiful Frontier Reservoir","Vast Frontier Reservoir","Instrumental Core Reservoir","Vital Core Reservoir","Perimeter Ambush Point","Perimeter Camp","Phase Catalyst Node","The Line","Forgotten Perimeter Coronation Platform","Forgotten Perimeter Power Array","Unsecured Perimeter Amplifier","Unsecured Perimeter Information Center","Perimeter Checkpoint","Perimeter Hangar","The Ruins of Enclave Cohort 27","Sleeper Data Sanctuary","Forgotten Perimeter Gateway","Forgotten Perimeter Habitation Coils","Unsecured Perimeter Comms Relay","Unsecured Perimeter Transponder Farm","Fortification Frontier Stronghold","Outpost Frontier Stronghold","Solar Cell","The Oruze Construct","Forgotten Frontier Quarantine Outpost","Forgotten Frontier Recursive Depot","Unsecured Frontier Database","Unsecured Frontier Receiver","Frontier Barracks","Frontier Command Post","Integrated Terminus","Sleeper Information Sanctum","Forgotten Frontier Conversion Module","Forgotten Frontier Evacuation Center","Unsecured Frontier Digital Nexus","Unsecured Frontier Trinary Hub","Core Garrison","Core Stronghold","Oruze Osobnyk","Quarantine Area","Forgotten Core Data Field","Forgotten Core Information Pen","Unsecured Frontier Enclave Relay","Unsecured Frontier Server Bank","Core Citadel","Core Bastion","Strange Energy Readings","The Mirror","Forgotten Core Assembly Hall","Forgotten Core Circuitry Disassembler","Unsecured Core Backup Array","Unsecured Core Emergence"].indexOf(e)>-1?'<a href="http://eve-survival.org/wikka.php?wakka='+e.replace(/ /g,"")+'" target="_blank" class="siteLink">'+e+"</a>":e}-1!=window.location.href.indexOf("galileo")&&Notify.trigger("This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>"),$("body").on("click","a[href^='.?system=']",function(e){e.preventDefault();var t=$(this).attr("href").replace(".?system=",""),a=Object.index(tripwire.systems,"name",t);tripwire.systemChange(a)}),$("body").on("submit","#systemSearch",function(e){e.preventDefault();var t=$(this).find("[name='system']").val(),a=Object.index(tripwire.systems,"name",t)||!1;!1!==a&&(tripwire.systemChange(a),$(this).find("[name='system']").val(""),$("#search").click())}),$("body").on("click","#undo:not(.disabled)",function(){tripwire.undo()}),$("body").on("click","#redo:not(.disabled)",function(){tripwire.redo()}),$(document).keydown(function(e){if((e.metaKey||e.ctrlKey)&&(89==e.keyCode||90==e.keyCode)){if($(document.activeElement).is("textarea, input"))return;e.preventDefault(),89!=e.keyCode||$("#redo").hasClass("disabled")?90!=e.keyCode||$("#undo").hasClass("disabled")||($("#undo").click(),Notify.trigger("Undoing last action")):($("#redo").click(),Notify.trigger("Redoing last undo"))}}),$("#APIclock").knob({angleArc:359.9,height:20,width:20,max:60,readOnly:!0,displayInput:!1,fgColor:"#CCC",bgColor:"#666"}),$("#follow").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.follow=$(this).hasClass("active"),options.save()}),$("#show-viewing").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.viewing=$(this).hasClass("active"),options.save()}),$("#show-favorite").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),chain.redraw(),options.buttons.chainWidget.favorites=$(this).hasClass("active"),options.save()}),$("#system-favorite").click(function(){$(this).hasClass("active")?($(this).removeClass("active").attr("data-icon","star-empty"),options.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)),1)):($(this).attr("data-icon","star").addClass("active"),options.favorites.push(parseInt(viewingSystemID))),$("#show-favorite").hasClass("active")&&chain.redraw(),options.save()}),$("#search").click(function(e){$("#searchSpan").toggle(),$(this).hasClass("active")?($(this).removeClass("active"),tripwire.client.EVE&&tripwire.client.EVE.systemName&&$("#currentSpan").show()):($(this).addClass("active"),$("#currentSpan").hide(),$("#searchSpan input[name=system]").focus().select())}),$("#toggle-automapper").click(function(e){e.preventDefault(),$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active"),options.buttons.signaturesWidget.autoMapper=$(this).hasClass("active"),options.save()}),$("#track").on("click",".tracking-clone",function(){var e=$(this).attr("data-characterid");$("#tracking .tracking-clone").removeClass("active"),options.tracking.active==e?(options.tracking.active=null,tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")):(options.tracking.active=e,tripwire.esi.characters[options.tracking.active]&&($("#tracking .tracking-clone[data-characterid='"+options.tracking.active+"']").addClass("active"),tripwire.EVE(tripwire.esi.characters[options.tracking.active],!0)),$("#removeESI").removeAttr("disabled")),options.save()}),$("#login").on("click","#removeESI",function(){var e=options.tracking.active;options.tracking.active=null,tripwire.EVE(!1,!0),options.save(),$("#tracking .tracking-clone[data-characterid='"+e+"']").remove(),$("#removeESI").attr("disabled","disabled"),tripwire.data.esi.delete=e}),$("#user").click(function(e){e.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active"),$("#login > #panel").css({display:"none"})):($(this).addClass("active"),$("#login > #panel").css({display:"inline"}),$("#loginForm input[name=username]").focus().select(),$("#wrapper").click(function(e){$("#login > #panel").css({display:"none"}),$("#user").removeClass("active")}),$("#login").click(function(e){e.stopPropagation()}))}),$("#logout").click(function(){window.location="logout.php"});var Notify=new function(){this.trigger=function(e,t,a,i){var t=void 0!==t?t:"blue",a=void 0!==a?a:1e4,i=void 0!==i?i:null;new jBox("Notice",{id:i,content:e,offset:{y:35},animation:"flip",color:t,autoClose:a})}},ValidationTooltips=new jBox("Tooltip",{trigger:null,addClass:"validation-tooltip",animation:"flip",fade:0}),Tooltips=new jBox("Tooltip",{attach:$("[data-tooltip]"),getContent:"data-tooltip",position:{x:"right",y:"center"},outside:"x"}),WormholeTypeToolTips=new jBox("Tooltip",{attach:$(".whEffect[data-tooltip]"),getContent:"data-tooltip",position:{x:"left",y:"center"},outside:"x"}),OccupiedToolTips=new jBox("Tooltip",{pointer:"top:-3",position:{x:"right",y:"center"},outside:"x",animation:"move",repositionOnOpen:!0,onOpen:function(){var e=this,t=$(this.source).closest("[data-nodeid]").data("nodeid");e.setContent("&nbsp;"),$.ajax({url:"occupants.php",dataType:"JSON",data:"systemID="+t,cache:!1}).done(function(t){var a="<table>";for(var i in t.occupants)a+="<tr><td>"+t.occupants[i].characterName+"</td><td style='padding-left: 10px;'>"+(t.occupants[i].shipTypeName?t.occupants[i].shipTypeName:"")+"</td></tr>";a+="</table>",e.setContent(a)})}});$("#chainTabs").sortable({items:"> .tab",axis:"x",delay:150,tolerance:"pointer",containment:"parent",update:function(e,t){var a=$("#chainTabs").sortable("toArray"),i=[];for(var o in a)i.push(options.chain.tabs[a[o]]),$("#chainTabs .tab:eq("+o+")").attr("id",o);options.chain.active=$(".tab.current").index(),options.chain.tabs=i,options.save()}}),$("#chainTabs").on("click",".tab",function(e){e.preventDefault(),$(this).hasClass("current")?($("#chainTabs .tab").removeClass("current"),options.chain.active=null):($("#chainTabs .tab").removeClass("current"),$(this).addClass("current"),options.chain.active=$(this).index()),options.save(),chain.redraw(),tripwire.parse(tripwire.client,"refresh")}),$("#chainTabs").on("click",".closeTab",function(e){e.stopPropagation();var t=$(this).closest(".tab");$("#dialog-confirm #msg").html("This tab will be removed, are you sure?"),$("#dialog-confirm").dialog("option",{buttons:{"Remove Tab":function(){var e=t.index();options.chain.active=$(".tab.current").index(),options.chain.tabs.splice(e,1),options.save(),t.remove(),0==$("#chainTabs .tab.current").length&&$("#chainTabs .tab:last").click();for(var a=0,i=$("#chainTabs .tab").length;a<i;a++)$("#chainTabs .tab:eq("+a+")").attr("id",a);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#newTab").on("click",function(){$("#dialog-newTab").hasClass("ui-dialog-content")?$("#dialog-newTab").dialog("isOpen")||$("#dialog-newTab").dialog("open"):$("#dialog-newTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#newTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-newTab .name").val(viewingSystem).focus(),$("#dialog-newTab .sigSystemsAutocomplete").val(viewingSystem)},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-newTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#newTab_form").submit(function(e){e.preventDefault();var t=$("#chainTab .tab").clone(),a=$("#dialog-newTab .name").val(),i=Object.index(tripwire.systems,"name",$("#dialog-newTab .sigSystemsAutocomplete").val()),o=!!$("#tabThera")[0].checked;return a?!i&&$("#tabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-newTab .sigSystemsAutocomplete")}).setContent("Must have a valid system!"),!1):($("#tabType2")[0].checked&&(i=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",i).html(a),options.chain.tabs.push({systemID:i,name:a,evescout:o}),options.save(),$("#chainTabs").append(t),void $("#dialog-newTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-newTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-newTab .sigSystemsAutocomplete").click(function(e){$("#dialog-newTab #tabType1").click()})}})}),$("#chainTabs").on("click",".editTab",function(e){e.stopPropagation(),$("#dialog-editTab").hasClass("ui-dialog-content")?$("#dialog-editTab").dialog("isOpen")||$("#dialog-editTab").dialog("open"):$("#dialog-editTab").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{OK:function(){$("#editTab_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#dialog-editTab .name").val(options.chain.tabs[options.chain.active].name).focus(),$("#dialog-editTab .sigSystemsAutocomplete").val(options.chain.tabs[options.chain.active].systemID>0?tripwire.systems[options.chain.tabs[options.chain.active].systemID].name:""),options.chain.tabs[options.chain.active].systemID>0?$("#dialog-editTab #editTabType1")[0].checked=!0:$("#dialog-editTab #editTabType2")[0].checked=!0,$("#dialog-editTab #editTabThera")[0].checked=options.chain.tabs[options.chain.active].evescout},close:function(){ValidationTooltips.close()},create:function(){$("#dialog-editTab .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#editTab_form").submit(function(e){e.preventDefault();var t=$("#chainTabs .tab").eq([options.chain.active]),a=$("#dialog-editTab .name").val(),i=Object.index(tripwire.systems,"name",$("#dialog-editTab .sigSystemsAutocomplete").val()),o=!!$("#editTabThera")[0].checked;return a?!i&&$("#editTabType1")[0].checked?(ValidationTooltips.open({target:$("#dialog-editTab .sigSystemsAutocomplete")}).setContent("Must have a valid system!"),!1):($("#editTabType2")[0].checked&&(i=0),t.attr("id",$("#chainTabs .tab").length).find(".name").data("tab",i).html(a),options.chain.tabs[options.chain.active]={systemID:i,name:a,evescout:o},options.save(),chain.redraw(),tripwire.parse(tripwire.client,"refresh"),void $("#dialog-editTab").dialog("close")):(ValidationTooltips.open({target:$("#dialog-editTab .name")}).setContent("Must have a name!"),!1)}),$("#dialog-editTab .sigSystemsAutocomplete").click(function(e){$("#dialog-editTab #editTabType1").click()})}})}),$("#signaturesWidget #sigTable thead").contextmenu({delegate:"th.sortable",menu:"#signatureColumnMenu",select:function(e,t){var a=$(t.target).parent().parent().children().index($(t.target).parent())+1;switch(a){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}switch(t.cmd){case"leftAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+a+")").removeClass("centerAlign rightAlign").addClass("leftAlign"),options.signatures.alignment[colName]="leftAlign";break;case"centerAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+a+")").removeClass("leftAlign rightAlign").addClass("centerAlign"),options.signatures.alignment[colName]="centerAlign";break;case"rightAlign":$("#signaturesWidget #sigTable tbody td:nth-child("+a+")").removeClass("centerAlign leftAlign").addClass("rightAlign"),options.signatures.alignment[colName]="rightAlign"}options.save()},beforeOpen:function(e,t){switch($(t.target).parent().parent().children().index($(t.target).parent())+1){case 1:colName="sigID";break;case 2:colName="sigType";break;case 3:colName="sigAge";break;case 4:colName="leadsTo";break;case 5:colName="sigLife";break;case 6:colName="sigMass"}$(this).contextmenu("enableEntry","leftAlign",!0),$(this).contextmenu("enableEntry","centerAlign",!0),$(this).contextmenu("enableEntry","rightAlign",!0),$(this).contextmenu("enableEntry",options.signatures.alignment[colName],!1)}}),$("#chainMap").contextmenu({delegate:".node a",uiMenuOptions:{position:{my:"left top-1",at:"right top"}},menu:"#chainMenu",show:{effect:"slideDown",duration:150},select:function(e,t){var a=$(t.target[0]).closest("[data-nodeid]").data("nodeid"),i=$(t.target[0]).closest("[data-nodeid]").attr("id").replace("node","")-1;switch(t.cmd){case"showInfo":tripwire.esi.showInfo(a,options.tracking.active);break;case"setDest":tripwire.esi.setDestination(a,options.tracking.active);break;case"addWay":tripwire.esi.setDestination(a,options.tracking.active,!1);break;case"showMap":break;case"red":$(t.target[0]).closest("td").hasClass("redNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"yellow":$(t.target[0]).closest("td").hasClass("yellowNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"green":$(t.target[0]).closest("td").hasClass("greenNode")?$(this).contextmenu("removeFlare",a,t):$(this).contextmenu("setFlare",a,t.cmd,t);break;case"mass":$("#dialog-mass").data("id",$(t.target[0]).closest("[data-nodeid]").data("sigid")).data("systemID",$(t.target[0]).closest("[data-nodeid]").data("nodeid")).dialog("open");break;case"rename":$("#dialog-rename").data("id",$(t.target[0]).closest("[data-nodeid]").data("sigid")).data("systemID",$(t.target[0]).closest("[data-nodeid]").data("nodeid")).dialog("open");break;case"collapse":var o=!options.chain.tabs[options.chain.active]||-1==$.inArray(a,options.chain.tabs[options.chain.active].collapsed);chain.map.collapse(i,o)}},beforeOpen:function(e,t){var a=$(t.target[0]).closest("[data-nodeid]").data("sigid")||null,i=$(t.target[0]).closest("[data-nodeid]").data("nodeid");tripwire.systems[i].class||!tripwire.esi.characters[options.tracking.active]?($(this).contextmenu("enableEntry","setDest",!1),$(this).contextmenu("enableEntry","addWay",!1),$(this).contextmenu("enableEntry","showMap",!1)):($(this).contextmenu("enableEntry","setDest",!0),$(this).contextmenu("enableEntry","addWay",!0),$(this).contextmenu("enableEntry","showMap",!1)),a?($(this).contextmenu("enableEntry","rename",!0),$(this).contextmenu("enableEntry","mass",!0)):($(this).contextmenu("enableEntry","rename",!1),$(this).contextmenu("enableEntry","mass",!1))},create:function(e,t){$("#dialog-mass").dialog({autoOpen:!1,width:"auto",height:"auto",dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Close:function(){$(this).dialog("close")}},open:function(){var e=$(this).data("id"),t=$(this).data("systemID"),a=Object.find(chain.data.rawMap,"id",e);$("#dialog-mass").dialog("option","title","From "+(a.systemID==t?tripwire.systems[a.connectionID].name:tripwire.systems[a.systemID].name)+" to "+tripwire.systems[t].name),$("#dialog-mass #massTable tbody tr").remove();var i={signatureID:e};$.ajax({url:"mass.php",type:"POST",data:i,dataType:"JSON"}).done(function(e){if(e&&e.mass){var a=0;for(x in e.mass)a+=parseFloat(e.mass[x].mass),$("#dialog-mass #massTable tbody").append("<tr><td>"+e.mass[x].characterName+"</td><td>"+(e.mass[x].toID==t?"In":"Out")+"</td><td>"+e.mass[x].shipType+"</td><td>"+numFormat(e.mass[x].mass)+"Kg</td><td>"+e.mass[x].time+"</td></tr>");$("#dialog-mass #massTable tbody").append("<tr><td></td><td></td><td></td><th>"+numFormat(a)+"Kg</th><td></td></tr>")}})}}),$("#dialog-rename").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Save:function(){$("#rename_form").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){var e=$(this).data("id"),t=$(this).data("systemID"),a=Object.find(tripwire.client.chain.map,"id",e);$(this).find("#name").val(a.systemID==t?a.system:a.connection)},create:function(){$("#rename_form").submit(function(e){e.preventDefault();var t=$("#dialog-rename").data("id"),a=$("#dialog-rename").data("systemID"),i=Object.find(tripwire.client.chain.map,"id",t);$("#dialog-rename").parent().find(":button:contains('Save')").button("disable");var o={request:{signatures:{rename:{id:t,name:$("#dialog-rename").find("#name").val(),side:i.systemID==a?"parent":"child"}}}};tripwire.refresh("refresh",o,function(e){e&&1==e.result&&$("#dialog-rename").dialog("close")},function(e){$("#dialog-rename").parent().find(":button:contains('Save')").button("enable")})})}}),$.moogle.contextmenu.prototype.setFlare=function(e,t,a){var i={systemID:e,flare:t};$.ajax({url:"flares.php",type:"POST",data:i,dataType:"JSON"}).done(function(a){a&&a.result&&(chain.data.flares.flares.push({systemID:e,flare:t,time:null}),chain.flares(chain.data.flares))})},$.moogle.contextmenu.prototype.removeFlare=function(e,t){var a={systemID:e};$.ajax({url:"flares.php",type:"POST",data:a,dataType:"JSON"}).done(function(t){t&&t.result&&(chain.data.flares.flares.splice(Object.index(chain.data.flares.flares,"systemID",e),1),chain.flares(chain.data.flares))})}}}),$.widget("custom.inlinecomplete",$.ui.autocomplete,{_create:function(){return this.element.is("input")||this._selectInit(),this._super()},_value:function(){var e=this._superApply(arguments);return this.element.change(),e},_suggest:function(e){return this.element.val()!=e[0].value&&this.element.val(e[0].value.substr(0,this.element.val().length)),this._super(e)},_initSource:function(){if(!$.isArray(this.options.source))return this._super();this.source=function(e,t){for(var a=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term),"i"),i=new Array,o=this.options.source,n=this.options.maxSize||25,s=0,r=o.length;s<r&&!(a.test(o[s])&&(i.push(o[s]),n&&i.length>n));s++);t(i)}},_close:function(e){return this.options.source=this.options.input_source?this.options.input_source:this.options.source,this._super(e)},_selectInit:function(){this.element.addClass("custom-combobox"),this.wrapper=this.element,this.element=this.wrapper.find("input:first"),this.select=this.wrapper.find("select:first").remove(),this.options.input_source=this.options.source,this.options.select_source=this.select.children("option[value!='']").map(function(){return $.trim(this.text)}).toArray(),this._createShowAllButton()},_createShowAllButton:function(){var e=this,t=!1;$("<a>").attr("tabIndex",e.element.prop("tabindex")).attr("title","").appendTo(e.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").on("mousedown",function(){t=e.widget().is(":visible")}).on("click",function(){e.element.trigger("focus"),t||(e.options.source=e.options.select_source,e._search(""))})}}),$("#sigTable").tablesorter({sortReset:!0,widgets:["saveSort"],textExtraction:{2:function(e){return $(e).find("span").data("age")}}});var whList;(whList=$.map(tripwire.wormholes,function(e,t){return t})).splice(26,0,"K162"),whList.push("???","GATE"),$(".systemsAutocomplete").inlinecomplete({source:tripwire.aSystems,maxSize:10,delay:0}),$("#dialog-error").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}},create:function(){$(this).dialog("option","show",{effect:"shake",duration:150,easing:"easeOutElastic"})}}),$("#dialog-msg").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Ok:function(){$(this).dialog("close")}}}),$("#dialog-confirm").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Cancel:function(){$(this).dialog("close")}}});
tripwire.active=function(t){var i=[],a=[];for(var e in t){var d=JSON.parse(t[e].activity);i.push(parseInt(d.editSig)),a.push(parseInt(d.editComment)),d.editSig&&$("#sigTable tr[data-id='"+d.editSig+"']").addClass("editing").find("td").animate({backgroundColor:"#001b47"},1e3),d.editComment&&$("#commentWrapper .comment[data-id='"+d.editComment+"'] .cke").length>0&&$("#commentWrapper .comment[data-id='"+d.editComment+"']").addClass("editing").find(".commentStatus").html(t[e].characterName+" is editing").fadeIn()}$("#sigTable tr.editing").each(function(){-1==$.inArray($(this).data("id"),i)&&$("#sigTable tr[data-id='"+$(this).data("id")+"']").removeClass("editing").find("td").animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})})}),$("#commentWrapper .editing").each(function(){-1==$.inArray($(this).data("id"),a)&&$("#commentWrapper .editing[data-id='"+$(this).data("id")+"']").removeClass("editing").find(".commentStatus").fadeOut(function(){$(this).html("")})})};
tripwire.addSig=function(t,s,e){var a=void 0===(s=s||{}).animate||s.animate,e=e||!1;if(t.mass){t.systemID==viewingSystemID?t.nth:t.nth2;var i=t.systemID==viewingSystemID?t.signatureID:t.sig2ID,n=t.systemID==viewingSystemID?t.type:t.sig2Type,d=t.systemID==viewingSystemID?t.typeBM:t.type2BM,l=t.systemID==viewingSystemID?t.connectionID:t.systemID,o=t.systemID==viewingSystemID?t.connection:t.system,r=tripwire.systems[l]?"<a href='.?system="+tripwire.systems[l].name+"'>"+(o||tripwire.systems[l].name)+"</a>":o;switch(t.life){case"Stable":g="stable";break;case"Critical":g="critical";break;default:var g=""}switch(t.mass){case"Stable":c="stable";break;case"Destab":c="destab";break;case"Critical":c="critical";break;default:var c=""}var p="<tr data-id='"+t.id+"' data-tooltip='' "+(e?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+i+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(t)+'">'+n+sigFormat(d,"type")+'</td><td class="age-tooltip '+options.signatures.alignment.sigAge+"\" data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+r+"</td><td class='"+g+" "+options.signatures.alignment.sigLife+"'>"+t.life+"</td><td class='"+c+" "+options.signatures.alignment.sigMass+"'>"+t.mass+"</td><td><a href='' class='sigDelete' "+(e?'disabled="disabled"':"")+">X</a></td><td><a href='' class='sigEdit' "+(e?'disabled="disabled"':"")+"><</a></td></tr>",m=$(p)}else var p="<tr data-id='"+t.id+"' data-tooltip='' "+(e?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+t.signatureID+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td><td><a href='' class='sigDelete' "+(e?'disabled="disabled"':"")+">X</a></td><td><a href='' class='sigEdit' "+(e?'disabled="disabled"':"")+"><</a></td></tr>",m=$(p);Tooltips.attach($(m).find("[data-tooltip]")),$("#sigTable").append(m),$("#sigTable").trigger("update"),"Critical"==t.life?$(m).find("span[data-age]").countdown({until:new Date(t.lifeLeft),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).countdown("pause").addClass("critical").countdown("resume"):$(m).find("span[data-age]").countdown({since:new Date(t.lifeTime),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).countdown("pause").countdown("resume"),a&&($(m).find("td").wrapInner('<div class="hidden" />').parent().find("td > div").slideDown(700,function(){$set=$(this),$set.replaceWith($set.contents())}),$(m).find("td").animate({backgroundColor:"#004D16"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3,null,function(){$(this).css({backgroundColor:""})}))};
tripwire.API=function(){this.indicator,this.APIrefresh,this.API.expire=function(){var e={since:tripwire.API.APIrefresh,until:null,format:"MS",layout:"-{mnn}{sep}{snn}"};$("#APItimer").countdown("option",e)},this.API.refresh=function(){$.ajax({url:"api_update.php",cache:!1,dataType:"JSON",data:"indicator="+tripwire.API.indicator}).done(function(e){if(e&&e.APIrefresh){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),activity.refresh();var i={until:tripwire.API.APIrefresh,since:null,layout:"{mnn}{sep}{snn}"};$("#APItimer").countdown("option",i),setTimeout("tripwire.API.refresh();",$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30),e.chain&&tripwire.chainMap.parse(e.chain)}else"-{mnn}{sep}{snn}"!==$("#APItimer").countdown("option","layout")&&$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))>120?setTimeout("tripwire.API.refresh();",1e3*($.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30)):setTimeout("tripwire.API.refresh();",5e3)})},this.API.init=function(){$.ajax({url:"api_update.php",cache:!0,dataType:"JSON",data:"init=true"}).done(function(e){tripwire.API.indicator=e.indicator,tripwire.API.APIrefresh=new Date(e.APIrefresh),$("#APItimer").countdown({until:tripwire.API.APIrefresh,onExpiry:tripwire.API.expire,alwaysExpire:!0,compact:!0,format:"MS",serverSync:tripwire.serverTime.getTime,onTick:function(e){$("#APIclock").val(e[5]+1).trigger("change")}});var i="-{mnn}{sep}{snn}"===$("#APItimer").countdown("option","layout")?15:$.countdown.periodsToSeconds($("#APItimer").countdown("getTimes"))-30;setTimeout("tripwire.API.refresh();",1e3*i),e.chain&&tripwire.chainMap.parse(e.chain)})},this.API.init()};
tripwire.autoMapper=function(e,s){var t=[33328,670];if(!tripwire.systems[e]||!tripwire.systems[s])return!1;if(!$("#toggle-automapper").hasClass("active"))return!1;if($.inArray(parseInt(tripwire.client.EVE.shipTypeID),t)>=0)return!1;if(void 0!==tripwire.map.shortest[e-3e7]&&void 0!==tripwire.map.shortest[e-3e7][s-3e7])return!1;if($.map(chain.data.rawMap,function(t){return t.systemID==e&&t.connectionID==s||t.connectionID==e&&t.systemID==s?t:null})[0])return!1;var i,n={request:{signatures:{add:[],update:[]}}},r=null;if(r=tripwire.systems[s].class?"Class "+tripwire.systems[s].class:tripwire.systems[s].security>=.45?"High-Sec":tripwire.systems[s].security>0?"Low-Sec":"Null-Sec",(i=$.map(chain.data.rawMap,function(s){return s.systemID==e&&s.mass&&(tripwire.wormholes[s.type]&&tripwire.wormholes[s.type].leadsTo==r&&s.connectionID<=0||s.connection==r)?s:null})).length?i.length>1?$("#dialog-msg").dialog({autoOpen:!0,buttons:{Cancel:function(){$(this).dialog("close")},Ok:function(){var e=$("#dialog-msg #msg [name=sig]:checked").val();n.request.signatures.update.push({id:i[e].id,side:"parent",signatureID:i[e].signatureID,systemID:i[e].systemID,systemName:i[e].system,type:"Wormhole",whType:i[e].type,sig2ID:i[e].sig2ID,sig2Type:i[e].sig2Type,connectionName:tripwire.systems[s].name,connectionID:s,whLife:i[e].life,whMass:i[e].mass,lifeLength:i[e].lifeLength}),n.systemID=viewingSystemID;tripwire.refresh("refresh",n,function(e){e&&1==e.result&&$("#dialog-msg").dialog("close")})}},open:function(){$("#dialog-msg #msg").html("Which signature would you like to update?<br/><br/>"),$.each(i,function(e){$("#dialog-msg #msg").append("<input type='radio' name='sig' value='"+e+"' />"+this.signatureID+"<br/>")})}}):i.length&&(i=i[0],n.request.signatures.update.push({id:i.id,side:"parent",signatureID:i.signatureID,systemID:i.systemID,systemName:i.system,type:"Wormhole",whType:i.type,sig2ID:i.sig2ID,sig2Type:i.sig2Type,connectionName:tripwire.systems[s].name,connectionID:s,whLife:i.life,whMass:i.mass,lifeLength:i.lifeLength})):(i=$.map(chain.data.rawMap,function(s){return s.systemID==e&&s.connectionID<=0&&("???"==s.type||"K162"==s.type)?s:null}))&&(i.length>1?$("#dialog-msg").dialog({autoOpen:!0,buttons:{Cancel:function(){$(this).dialog("close")},Ok:function(){var e=$("#dialog-msg #msg [name=sig]:checked").val();n.request.signatures.update.push({id:i[e].id,side:"parent",signatureID:i[e].signatureID,systemID:i[e].systemID,systemName:i[e].system,type:"Wormhole",whType:i[e].type,sig2ID:i[e].sig2ID,sig2Type:i[e].sig2Type,connectionName:tripwire.systems[s].name,connectionID:s,whLife:i[e].life,whMass:i[e].mass,lifeLength:i[e].lifeLength}),n.systemID=viewingSystemID;tripwire.refresh("refresh",n,function(e){e&&1==e.result&&$("#dialog-msg").dialog("close")})}},open:function(){$("#dialog-msg #msg").html("Which signature would you like to update?<br/><br/>"),$.each(i,function(e){$("#dialog-msg #msg").append("<input type='radio' name='sig' value='"+e+"' /> "+this.signatureID+"<br/>")})}}):i.length&&(i=i[0],n.request.signatures.update.push({id:i.id,side:"parent",signatureID:i.signatureID,systemID:i.systemID,systemName:i.system,type:"Wormhole",whType:i.type,sig2ID:i.sig2ID,sig2Type:i.sig2Type,connectionName:tripwire.systems[s].name,connectionID:s,whLife:i.life,whMass:i.mass,lifeLength:i.lifeLength}))),0==i.length&&n.request.signatures.add.push({signatureID:"???",systemID:e,type:"Wormhole",whType:"???",class:sigClass(tripwire.systems[e].name,"???"),class2:sigClass(tripwire.systems[s].name,null),connectionName:"",connectionID:s}),n.request.signatures.add.length||n.request.signatures.update.length){n.systemID=viewingSystemID;var a=$.map(n.request.signatures.update,function(e){return tripwire.client.signatures[e.id]});tripwire.refresh("refresh",n,function(e){1==e.result&&($("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?(e.resultSet&&tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:$.map(e.resultSet,function(s){return e.signatures[s]})}),a.length&&tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:a})):(e.resultSet&&(tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:$.map(e.resultSet,function(s){return e.signatures[s]})}]),a.length&&(tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:a}])),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}};
tripwire.comments=function(){this.comments.data={},this.comments.parse=function(t){for(var e in t){o=t[e].id;if(Object.find(tripwire.comments.data,"id",o)||0!=$(".comment[data-id='"+o+"']").length){if(Object.find(tripwire.comments.data,"id",o)&&Object.find(tripwire.comments.data,"id",o).modified!=t[e].modified){m=$(".comment[data-id='"+o+"']");try{m.find(".commentBody").html(t[e].comment)}catch(t){m.find(".commentFooter").show(),m.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),m.find(".commentFooter .commentControls").hide()}m.find(".commentModified").html("Edited by "+t[e].modifiedBy+" at "+t[e].modified),m.find(".commentSticky").addClass(t[e].sticky?"active":"")}}else{var m=$(".comment:last").clone(),i=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(m),m.attr("data-id",o);try{m.find(".commentBody").html(t[e].comment)}catch(t){m.find(".commentFooter").show(),m.find(".commentStatus").html("<span class='critical'>"+t.constructor.name+": "+t.message+"</span>"),m.find(".commentFooter .commentControls").hide()}m.find(".commentModified").html("Edited by "+t[e].modifiedBy+" at "+t[e].modified),m.find(".commentCreated").html("Posted by "+t[e].createdBy+" at "+t[e].created),m.find(".commentBody").attr("id","comment"+i),m.find(".commentSticky").addClass(t[e].sticky?"active":""),m.removeClass("hidden"),Tooltips.attach(m.find("[data-tooltip]"))}}for(var e in tripwire.comments.data){var o=tripwire.comments.data[e].id;Object.find(t,"id",o)||(m=$(".comment[data-id='"+o+"']")).remove()}tripwire.comments.data=t}},tripwire.comments();
tripwire.deleteSig=function(e){var a=$("#sigTable tr[data-id='"+e+"']");$(a).find("td:empty, a:empty").append("&nbsp;"),$(a).find("td").wrapInner("<div />").parent().find("td > div").animate({backgroundColor:"#4D0000"},1e3).delay(1e3).animate({backgroundColor:"#111"},1e3).slideUp(700,function(){$(a).find("span[data-age]").countdown("destroy"),$(this).parent().parent().remove(),$("#sigTable").trigger("update")})};
tripwire.editSig=function(t,s){var s=s||!1;if(t.mass){t.systemID==viewingSystemID?t.nth:t.nth2;var a=t.systemID==viewingSystemID?t.signatureID:t.sig2ID,e=t.systemID==viewingSystemID?t.type:t.sig2Type,i=t.systemID==viewingSystemID?t.typeBM:t.type2BM,d=t.systemID==viewingSystemID?t.connectionID:t.systemID,n=t.systemID==viewingSystemID?t.connection:t.system,l=tripwire.systems[d]?"<a href='.?system="+tripwire.systems[d].name+"'>"+(n||tripwire.systems[d].name)+"</a>":n;switch(t.life){case"Stable":o="stable";break;case"Critical":o="critical";break;default:var o=""}switch(t.mass){case"Stable":r="stable";break;case"Destab":r="destab";break;case"Critical":r="critical";break;default:var r=""}var g="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+a+"</td><td class='type-tooltip "+options.signatures.alignment.sigType+"' data-tooltip=\""+this.whTooltip(t)+'">'+e+sigFormat(i,"type")+'</td><td class="age-tooltip '+options.signatures.alignment.sigAge+"\" data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"'>"+l+"</td><td class='"+o+" "+options.signatures.alignment.sigLife+"'>"+t.life+"</td><td class='"+r+" "+options.signatures.alignment.sigMass+"'>"+t.mass+"</td><td><a href='' class='sigDelete' "+(s?'disabled="disabled"':"")+">X</a></td><td><a href='' class='sigEdit' "+(s?'disabled="disabled"':"")+"><</a></td></tr>",p=$(g)}else var g="<tr data-id='"+t.id+"' data-tooltip='' "+(s?'disabled="disabled"':"")+"><td class='"+options.signatures.alignment.sigID+"'>"+t.signatureID+"</td><td class='"+options.signatures.alignment.sigType+"'>"+t.type+"</td><td class='age-tooltip "+options.signatures.alignment.sigAge+"' data-tooltip='"+this.ageTooltip(t)+"'><span data-age='"+t.lifeTime+"'></span></td><td class='"+options.signatures.alignment.leadsTo+"' colspan='3'>"+(t.name?linkSig(t.name):"")+"</td><td><a href='' class='sigDelete' "+(s?'disabled="disabled"':"")+">X</a></td><td><a href='' class='sigEdit' "+(s?'disabled="disabled"':"")+"><</a></td></tr>",p=$(g);Tooltips.attach($(p).find("[data-tooltip]")),$("#sigTable tr[data-id='"+t.id+"']").replaceWith(p),$("#sigTable").trigger("update"),$(p).find("span[data-age]").countdown("destroy"),"Critical"==t.life?$(p).find("span[data-age]").countdown({until:new Date(t.lifeLeft),onExpiry:this.pastEOL,alwaysExpire:!0,compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}).addClass("critical"):$(p).find("span[data-age]").countdown({since:new Date(t.lifeTime),compact:!0,format:this.ageFormat,serverSync:this.serverTime.getTime}),$(p).effect("pulsate")};
tripwire.esi=function(){var e="https://esi.tech.ccp.is",a="Tripwire Client "+tripwire.version+" ("+window.location.hostname+") - "+window.navigator.userAgent;this.esi.connection=!0,this.esi.characters={};var t=function(e){$("#tracking .tracking-clone[data-characterid='"+e+"']").find(".alert").show()},i=function(){i.timer,clearTimeout(i.timer);for(characterID in tripwire.esi.characters){var t=tripwire.esi.characters[characterID];moment(t.tokenExpire).subtract(5,"minutes").isBefore(moment())?tripwire.data.esi={expired:!0}:$.ajax({url:e+"/v1/characters/"+characterID+"/location/?"+$.param({token:t.accessToken,user_agent:a}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,t){var i=tripwire.esi.characters[this.characterID];i&&(i.locationDate=t.getResponseHeader("last-modified"),i.systemID!=e.solar_system_id&&(i.systemID=e.solar_system_id||null,i.systemName=tripwire.systems[e.solar_system_id]?tripwire.systems[e.solar_system_id].name:null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".system").html(i.systemName||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.stationID!=e.station_id&&(i.stationID=e.station_id||null,e.station_id?tripwire.esi.stationLookup(e.station_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.stationName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".station").html(e.name.substring(0,17)+"..."||"&nbsp;").attr("data-tooltip",e.name),Tooltips.attach($("#tracking .tracking-clone[data-characterid='"+this.reference+"'] .station[data-tooltip]")),tripwire.data.tracking[characterID]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(i.stationName=null,Tooltips.detach($("#tracking .tracking-clone[data-characterid='"+this.characterID+"'] .station[data-tooltip]")),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName})),options.tracking.active==this.characterID&&tripwire.EVE(tripwire.esi.characters[options.tracking.active]))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"))})}i.timer=setTimeout(i,5e3)},r=function(){r.timer,clearTimeout(r.timer);for(characterID in tripwire.esi.characters){var t=tripwire.esi.characters[characterID];moment(t.tokenExpire).subtract(5,"minutes").isBefore(moment())?tripwire.data.esi={expired:!0}:$.ajax({url:e+"/v1/characters/"+characterID+"/ship/?"+$.param({token:t.accessToken,user_agent:a}),type:"GET",dataType:"JSON",characterID:characterID}).done(function(e,a,t){var i=tripwire.esi.characters[this.characterID];i&&(i.shipDate=t.getResponseHeader("last-modified"),i.shipID!=e.ship_item_id&&(i.shipID=e.ship_item_id||null,tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.shipName!=e.ship_name&&(i.shipName=e.ship_name||null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".shipname").html(e.ship_name||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName}),i.shipTypeID!=e.ship_type_id&&(i.shipTypeID=e.ship_type_id||null,e.ship_type_id?tripwire.esi.typeLookup(e.ship_type_id,this.characterID).always(function(e){var a=tripwire.esi.characters[this.reference];a.shipTypeName=e.name||null,$("#tracking .tracking-clone[data-characterid='"+this.reference+"']").find(".ship").html(e.name||"&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:a.characterID,characterName:a.characterName,systemID:a.systemID,systemName:a.systemName,stationID:a.stationID,stationName:a.stationName,shipID:a.shipID,shipName:a.shipName,shipTypeID:a.shipTypeID,shipTypeName:a.shipTypeName}}):(i.shipTypeName=null,$("#tracking .tracking-clone[data-characterid='"+this.characterID+"']").find(".ship").html("&nbsp;"),tripwire.data.tracking[this.characterID]={characterID:i.characterID,characterName:i.characterName,systemID:i.systemID,systemName:i.systemName,stationID:i.stationID,stationName:i.stationName,shipID:i.shipID,shipName:i.shipName,shipTypeID:i.shipTypeID,shipTypeName:i.shipTypeName})))}).fail(function(e){403==e.status&&tripwire.refresh("refresh",{esi:{expired:!0}})}).always(function(e,a){"success"!=a&&"abort"!=a&&1==tripwire.esi.connection?(tripwire.esi.connection=!1,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Failed","red",!1,"esiConnectionError")):"success"==a&&0==tripwire.esi.connection&&(tripwire.esi.connection=!0,$("#esiConnectionSuccess, #esiConnectionError").click(),Notify.trigger("ESI Connection Resumed","green",5e3,"esiConnectionSuccess"))})}r.timer=setTimeout(r,5e3)},s=function(){s.timer,clearTimeout(s.timer);for(characterID in tripwire.esi.characters){var e=tripwire.esi.characters[characterID];tripwire.esi.characterStatus(e.characterID,e).done(function(e){e?$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("critical").addClass("stable"):$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")}).fail(function(e){e&&403==e.status&&t(this.reference.characterID),$("#tracking .tracking-clone[data-characterid='"+this.reference.characterID+"']").find(".online").removeClass("stable").addClass("critical")})}s.timer=setTimeout(s,6e4)};this.esi.typeLookup=function(t,i){return $.ajax({url:e+"/v2/universe/types/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",reference:i})},this.esi.stationLookup=function(t,i){return $.ajax({url:e+"/v2/universe/stations/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",reference:i})},this.esi.setDestination=function(t,i,r,s){return $.ajax({url:e+"/v2/ui/autopilot/waypoint/?"+$.param({destination_id:t,clear_other_waypoints:r,add_to_beginning:s}),headers:{Authorization:"Bearer "+tripwire.esi.characters[i].accessToken,"X-User-Agent":a},type:"POST",dataType:"JSON"})},this.esi.showInfo=function(t,i){return $.ajax({url:e+"/v1/ui/openwindow/information/?"+$.param({target_id:t}),headers:{Authorization:"Bearer "+tripwire.esi.characters[i].accessToken,"X-User-Agent":a},type:"POST",dataType:"JSON"})},this.esi.characterStatus=function(t,i){return $.ajax({url:e+"/v1/characters/"+t+"/online/?"+$.param({token:tripwire.esi.characters[t].accessToken,user_agent:a}),type:"GET",dataType:"JSON",reference:i})},this.esi.eveStatus=function(){return $.ajax({url:e+"/v1/status/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON"})},this.esi.idLookup=function(t){return $.ajax({url:e+"/v2/universe/names/?"+$.param({user_agent:a}),type:"POST",dataType:"JSON",contentType:"application/json",processData:!1,data:JSON.stringify(t)})},this.esi.characterLookup=function(t,i,r){var r=void 0===r||r;return $.ajax({url:e+"/v4/characters/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",async:r,eveID:t,reference:i})},this.esi.corporationLookup=function(t,i,r){var r=void 0===r||r;return $.ajax({url:e+"/v4/corporations/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",async:r,eveID:t,reference:i})},this.esi.allianceLookup=function(t,i,r){var r=void 0===r||r;return $.ajax({url:e+"/v3/alliances/"+t+"/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",async:r,eveID:t,reference:i})},this.esi.search=function(t,i,r){return $.ajax({url:e+"/v2/search/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON",contentType:"application/json",data:{search:t,categories:i,strict:r}})},this.esi.universeJumps=function(){return $.ajax({url:e+"/v1/universe/system_jumps/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON"})},this.esi.universeKills=function(){return $.ajax({url:e+"/v1/universe/system_kills/?"+$.param({user_agent:a}),type:"GET",dataType:"JSON"})},this.esi.fullLookup=function(e){var a=$.Deferred();return tripwire.esi.idLookup(e).done(function(e){for(item in e)"character"==e[item].category?tripwire.esi.characterLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),tripwire.esi.corporationLookup(a.corporation_id,this.reference,!1).done(function(a){e[item].corporation=a,a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})})}):"corporation"==e[item].category&&tripwire.esi.corporationLookup(e[item].id,e[item],!1).done(function(a){$.extend(e[item],a),a.alliance_id&&tripwire.esi.allianceLookup(a.alliance_id,this.reference,!1).done(function(a){e[item].alliance=a})});a.resolve(e)}),a},this.esi.parse=function(e){for(characterID in tripwire.esi.characters)characterID in e||(delete tripwire.esi.characters[characterID],$("#tracking .tracking-clone[data-characterid='"+characterID+"']").remove(),options.tracking.active==characterID&&(tripwire.EVE(!1,!0),$("#removeESI").attr("disabled","disabled")));for(characterID in e){if("new"==options.tracking.active&&(options.tracking.active=characterID),!(characterID in tripwire.esi.characters)){var a=$("#tracking-clone").clone();a.attr("data-characterid",characterID),a.find(".avatar img").attr("src","https://image.eveonline.com/Character/"+characterID+"_32.jpg"),a.find(".name").html(e[characterID].characterName),a.removeAttr("id"),a.removeClass("hidden"),a.addClass("tracking-clone"),options.tracking.active==characterID&&(a.addClass("active"),$("#removeESI").removeAttr("disabled")),$("#tracking").append(a)}tripwire.esi.characters[characterID]=e[characterID]}r(),i(),s()}},tripwire.esi();
tripwire.EVE=function(t,e){var s=this.client.EVE&&this.client.EVE.systemChange||!1;t?(e||(this.client.EVE&&this.client.EVE.systemID!=t.systemID||1==s)&&(s=!0,moment(t.locationDate).isAfter(moment(this.client.EVE.shipDate))&&(s=!1,tripwire.autoMapper(this.client.EVE.systemID,t.systemID))),!e&&options.buttons.follow&&this.client.EVE&&this.client.EVE.systemID!=t.systemID&&0==$(".ui-dialog:visible").length&&tripwire.systemChange(t.systemID),$("#search").hasClass("active")||$("#currentSpan").show(),t.systemID&&$("#EVEsystem").html(tripwire.systems[t.systemID].name).attr("href",".?system="+tripwire.systems[t.systemID].name)):($("#EVEsystem").html(""),$("#currentSpan").hide()),this.client.EVE={characterID:t.characterID,characterName:t.characterName,systemID:t.systemID,systemName:t.systemName,shipTypeID:t.shipTypeID,shipTypeName:t.shipTypeName,stationID:t.stationID,stationName:t.stationName,locationDate:t.locationDate,shipDate:t.shipDate,systemChange:s}};
tripwire.parse=function(i,s){var t=$.extend(!0,{},i);if((null==options.chain.active||options.chain.tabs[options.chain.active]&&1!=options.chain.tabs[options.chain.active].evescout)&&"273.0"!=options.masks.active)for(var e in t.signatures)"273.0"==t.signatures[e].mask&&delete t.signatures[e];if("refresh"==s){for(var e in t.signatures){a="273.0"==t.signatures[e].mask&&"273.0"!=options.masks.active;if(tripwire.signatures.list[e]){if(tripwire.signatures.list[e].time!==t.signatures[e].time){var n=!1;for(column in t.signatures[e])t.signatures[e][column]!=tripwire.signatures.list[e][column]&&"time"!=column&&"editing"!=column&&(n=!0);n?this.editSig(t.signatures[e],a):this.sigEditing(t.signatures[e])}}else this.addSig(t.signatures[e],{animate:!0},a)}for(var e in tripwire.signatures.list)t.signatures[e]||this.deleteSig(e);this.client=i}else if("init"==s||"change"==s){for(var e in t.signatures){var a="273.0"==t.signatures[e].mask&&"273.0"!=options.masks.active;this.addSig(t.signatures[e],{animate:!1},a),t.signatures[e].editing&&this.sigEditing(t.signatures[e])}this.client=i}tripwire.signatures.list=t.signatures,$("#signature-count").html(t.signatures.length||Object.size(t.signatures)||0)};
tripwire.pasteSignatures=function(){var e,i=!1,t=function(e){var i={group:"",type:""},t=e.split("\t"),s=["Cosmic Signature","Cosmic Anomaly","Kosmische Anomalie","Kosmische Signatur"," "," "],n=["Wormhole","Relic Site","Gas Site","Ore Site","Data Site","Combat Site","Wurmloch","Reliktgebiet","Gasgebiet","Mineraliengebiet","Datengebiet","Kampfgebiet","",":   ",":   ",":   ",":   ",":   "];for(var a in t)t[a].match(/([A-Z]{3}[-]\d{3})/)?i.id=t[a].split("-"):t[a].match(/(\d([.|,]\d)?[ ]?(%))/)||t[a].match(/(\d[.|,]?\d+\s(AU|AE|km|m|..||))/i)||(-1==$.inArray(t[a],s)?-1==$.inArray(t[a],n)?""!=t[a]&&(i.type=t[a]):i.group=t[a]:i.scanGroup=t[a]);return!(!i.id||2!==i.id.length)&&i};this.pasteSignatures.parsePaste=function(e){var s=e.split("\n"),e={request:{signatures:{add:[],update:[]}}},n=$.map(tripwire.client.signatures,function(e){return"273.0"!=e.mask||(null==options.chain.active||options.chain.tabs[options.chain.active].evescout)&&null!=options.chain.active?viewingSystemID==e.systemID?e.signatureID:e.sig2ID:null}),a=["Wormhole","Wurmloch",""],r=["Combat Site","Kampfgebiet",":   "],g={"Gas Site":"Gas","Data Site":"Data","Relic Site":"Relic","Ore Site":"Ore",Gasgebiet:"Gas",Datengebiet:"Data",Reliktgebiet:"Relic",Mineraliengebiet:"Ore",":   ":"Gas",":   ":"Data",":   ":"Relic",":   ":"Ore"};for(var u in s){var o=t(s[u]);o.id&&(-1!=$.inArray(o.group,a)?(type="Wormhole",whType="???",sigName=null):-1!=$.inArray(o.group,r)?(type="Sites",sigName=o.type):g[o.group]?(type=g[o.group],sigName=o.type):(type=null,sigName=null),-1!==n.indexOf(o.id[0])?(sig=$.map(tripwire.client.signatures,function(e){return"273.0"!=e.mask||(null==options.chain.active||options.chain.tabs[options.chain.active].evescout)&&null!=options.chain.active?viewingSystemID==e.systemID?e.signatureID==o.id[0]?e:null:e.sig2ID==o.id[0]?e:null:null})[0],sig&&viewingSystemID==sig.systemID?(type&&sig.type!=type||sigName&&sig.name!=sigName)&&("Wormhole"==type&&null==sig.life||"Wormhole"!==type)&&e.request.signatures.update.push({id:sig.id,side:"parent",signatureID:o.id[0],systemID:viewingSystemID,systemName:"",type:type||sig.type||"???",name:sigName||sig.name,sig2ID:sig.sig2ID||"???",connectionName:sig.connection||null,connectionID:sig.connectionID||null,whLife:sig.life||"New Stable",whMass:sig.mass||"Stable",lifeLength:sig.lifeLength||24,life:sig.lifeLength||24}):sig&&(type&&sig.sig2Type!=type||sigName&&sig.name!=sigName)&&("Wormhole"==type&&null==sig.life||"Wormhole"!==type)&&e.request.signatures.update.push({id:sig.id,side:"child",sig2ID:o.id[0],systemID:sig.connectionID||null,systemName:sig.connectionName||null,type:type||sig.sig2Type||"???",name:sigName||sig.name,connectionName:"",connectionID:viewingSystemID,whLife:sig.life||"New Stable",whMass:sig.mass||"Stable",lifeLength:sig.lifeLength||24,life:sig.lifeLength||24})):(n.push(o.id[0]),e.request.signatures.add.push({signatureID:o.id[0],systemID:viewingSystemID,connectionName:"",type:type||"???",name:sigName,life:options.signatures.pasteLife,lifeLength:options.signatures.pasteLife})))}if(e.request.signatures.add.length||e.request.signatures.update.length){e.systemID=viewingSystemID;var l=$.map(e.request.signatures.update,function(e){return tripwire.client.signatures[e.id]});tripwire.refresh("refresh",e,function(e){1==e.result&&($("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?(e.resultSet&&tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:$.map(e.resultSet,function(i){return e.signatures[i]})}),l.length&&tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:l})):(e.resultSet&&(tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:$.map(e.resultSet,function(i){return e.signatures[i]})}]),l.length&&(tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:l}])),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(e){i=!1})}else i=!1},this.pasteSignatures.init=function(){$(document).keydown(function(e){if((e.metaKey||e.ctrlKey)&&(86==e.keyCode||91==e.keyCode)&&!i){if($(document.activeElement).is("textarea, input"))return;$("#clipboard").focus()}}),$("body").on("click","#fullPaste",function(i){i.preventDefault();var s=e.split("\n"),n=[],a=[],r=[];for(var g in s)(scan=t(s[g]))&&n.push(scan.id[0]);for(var u in tripwire.client.signatures){var o=tripwire.client.signatures[u];o.systemID==viewingSystemID&&-1==$.inArray(o.signatureID,n)&&"GATE"!==o.type&&"???"!==o.signatureID?(a.push(o.id),r.push(o)):o.connectionID==viewingSystemID&&-1==$.inArray(o.sig2ID,n)&&"GATE"!==o.sig2Type&&"???"!==o.sig2ID&&(a.push(o.id),r.push(o))}if(a.length>0){var l={request:{signatures:{delete:a}}};tripwire.refresh("refresh",l,function(e){1==e.result&&($("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"delete",signatures:r}):tripwire.signatures.undo[viewingSystemID]=[{action:"delete",signatures:r}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))})}}),$("#clipboard").on("paste",function(t){t.preventDefault();var s=window.clipboardData?window.clipboardData.getData("Text"):(t.originalEvent||t).clipboardData.getData("text/plain");$("#clipboard").blur(),i=!0,e=s,Notify.trigger("Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)"),tripwire.pasteSignatures.parsePaste(s)})},this.pasteSignatures.init()},tripwire.pasteSignatures();
tripwire.redo=function(){if(tripwire.signatures.redo[viewingSystemID].length>0){$("#redo").addClass("disabled");var e=tripwire.signatures.redo[viewingSystemID].length-1,i={systemID:viewingSystemID,request:{signatures:{add:[],delete:[],update:[]}}},t=tripwire.signatures.redo[viewingSystemID][e];switch(t.action){case"add":i.request.signatures.add=i.request.signatures.add.concat(t.signatures);break;case"delete":i.request.signatures.delete=i.request.signatures.delete.concat($.map(t.signatures,function(e){return e.id}));break;case"update":i.request.signatures.update=i.request.signatures.update.concat(t.signatures)}var s=tripwire.client.signatures;tripwire.refresh("refresh",i,function(e){1==e.result&&(tripwire.signatures.redo[viewingSystemID].pop(),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?"update"==t.action?tripwire.signatures.undo[viewingSystemID].push({action:t.action,signatures:$.map(t.signatures,function(e){return s[e.id]})}):tripwire.signatures.undo[viewingSystemID].push({action:t.action,signatures:t.signatures}):"update"==t.action?tripwire.signatures.undo[viewingSystemID]=[{action:t.action,signatures:$.map(t.signatures,function(e){return s[e.id]})}]:tripwire.signatures.undo[viewingSystemID]=[{action:t.action,signatures:t.signatures}],sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)),sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(e){tripwire.signatures.redo[viewingSystemID].length>0&&$("#redo").removeClass("disabled")})}};
tripwire.serverStatus=function(){this.data,this.timer,clearTimeout(tripwire.serverStatus.timer),tripwire.esi.eveStatus().always(function(t){t&&t.players&&t.players>0?(tripwire.serverStatus.data&&tripwire.serverStatus.data.players===t.players||($("#serverStatus").html("<span class='"+(t.players>0?"stable":"critical")+"'>TQ</span>: "+numFormat(t.players)),tripwire.serverStatus.data&&$("#serverStatus").effect("pulsate",{times:5})),tripwire.serverStatus.data=t):$("#serverStatus").html("<span class='critical'>TQ</span>"),tripwire.serverStatus.timer=setTimeout("tripwire.serverStatus();",15e3)})},tripwire.serverStatus();
tripwire.sync=function(e,i,t,r){var i="object"==typeof i?i:{};return $.extend(!0,i,tripwire.data),this.timer&&clearTimeout(this.timer),this.xhr&&this.xhr.abort(),"refresh"==e||"change"==e?(i.sigCount=Object.size(this.client.signatures),i.sigTime=Object.maxTime(this.client.signatures,"time"),i.chainCount=Object.size(chain.data.rawMap),i.chainTime=Object.maxTime(chain.data.rawMap,"time"),i.flareCount=chain.data.flares?chain.data.flares.flares.length:0,i.flareTime=chain.data.flares?chain.data.flares.last_modified:0,i.commentCount=Object.size(this.comments.data),i.commentTime=Object.maxTime(this.comments.data,"modified"),i.activity=this.activity):($.extend(this,$.ajax({url:"//"+server+"/js/combine.json?v=2017-01-30",async:!1,dataType:"JSON"}).responseJSON),this.aSystems=$.map(this.systems,function(e){return e.name}),this.aSigSystems=["Null-Sec","Low-Sec","High-Sec","Class-1","Class-2","Class-3","Class-4","Class-5","Class-6"],$.merge(this.aSigSystems,this.aSystems.slice())),i.mode="init"!=e?"refresh":"init",i.systemID=viewingSystemID,i.systemName=viewingSystem,i.instance=tripwire.instance,i.version=tripwire.version,this.xhr=$.ajax({url:"refresh.php",data:i,type:"POST",dataType:"JSON",cache:!1}).done(function(i){i&&(tripwire.server=i,i.esi&&tripwire.esi.parse(i.esi),i.sync&&(tripwire.serverTime.time=new Date(i.sync),tripwire.API()),i.signatures&&tripwire.parse(i,e),i.chain&&tripwire.chainMap.parse(i.chain),i.comments&&tripwire.comments.parse(i.comments),tripwire.active(i.activity),i.notify&&!$("#serverNotification")[0]&&Notify.trigger(i.notify,"yellow",!1,"serverNotification")),tripwire.data={tracking:{},esi:{}},t&&t(i)}).always(function(e,i){tripwire.timer=setTimeout("tripwire.refresh();",tripwire.refreshRate),r&&r(e),403==e.status?window.location.href=".":"success"!=i&&"abort"!=i&&1==tripwire.connected?(tripwire.connected=!1,$("#ConnectionSuccess").click(),Notify.trigger("Error syncing with server","red",!1,"connectionError")):"success"==i&&0==tripwire.connected&&(tripwire.connected=!0,$("#connectionError").click(),Notify.trigger("Successfully reconnected with server","green",5e3,"connectionSuccess"))}),!0},tripwire.sync("init");
tripwire.systemChange=function(e,s){if("init"!=s&&($("#infoSecurity").removeClass(),$("#infoStatics").empty(),viewingSystem=tripwire.systems[e].name,viewingSystemID=e,activity.refresh(!0),$("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=[],chain.redraw(),$("#notesWidget .content .comment:visible").remove(),tripwire.comments.data=null,history.replaceState(null,null,"?system="+viewingSystem),tripwire.refresh("change")),document.title=tripwire.systems[e].name+" - "+app_name,$("#infoSystem").text(tripwire.systems[e].name),-1!=$.inArray(parseInt(viewingSystemID),options.favorites)?$("#system-favorite").attr("data-icon","star").addClass("active"):$("#system-favorite").attr("data-icon","star-empty").removeClass("active"),tripwire.systems[e].class){if($("#infoSecurity").html("<span class='wh pointer'>Class "+tripwire.systems[e].class+"</span>"),tripwire.systems[e].effect){var t='<table cellpadding="0" cellspacing="1">';for(var i in tripwire.effects[tripwire.systems[e].effect]){var r=tripwire.effects[tripwire.systems[e].effect][i].name,a=tripwire.effects[tripwire.systems[e].effect][i].base,n=tripwire.effects[tripwire.systems[e].effect][i].bad,c=tripwire.systems[e].class>6?6:tripwire.systems[e].class,p=0;switch(Math.abs(a)){case 15:p=a>0?7:-7;break;case 30:p=a>0?14:-14;break;case 60:p=a>0?28:-28}t+="<tr><td>"+r+'</td><td style="padding-left: 25px; text-align: right;" class="'+(n?"critical":"stable")+'">',t+=a+p*(c-1)+"%</td></tr>"}t+="</table>",$("#infoSecurity").append("&nbsp;<span class='pointer' data-tooltip='"+t+"'>"+tripwire.systems[e].effect+"</span>"),Tooltips.attach($("#infoSecurity [data-tooltip]"))}for(var i in tripwire.systems[e].statics){var o=tripwire.systems[e].statics[i],l=tripwire.wormholes[o],m="wh";switch(l.leadsTo){case"High-Sec":m="hisec";break;case"Low-Sec":m="lowsec";break;case"Null-Sec":m="nullsec"}$("#infoStatics").append("<div><span class='"+m+"'>&#9679;</span> <b>"+l.leadsTo+"</b> via <span class='"+m+"'>"+o+"</span></div>")}$("#infoFaction").html("&nbsp;")}else tripwire.systems[e].security>=.45?$("#infoSecurity").addClass("hisec").text("High-Sec "+tripwire.systems[e].security):tripwire.systems[e].security>0?$("#infoSecurity").addClass("lowsec").text("Low-Sec "+tripwire.systems[e].security):$("#infoSecurity").addClass("nullsec").text("Null-Sec "+tripwire.systems[e].security),$("#infoFaction").html(tripwire.systems[e].factionID?tripwire.factions[tripwire.systems[e].factionID].name:"&nbsp;");$("#infoRegion").text(tripwire.regions[tripwire.systems[e].regionID].name),$("#infoWidget .infoLink").each(function(){this.href=$(this).data("href").replace(/\$systemName/gi,tripwire.systems[e].name).replace(/\$systemID/gi,e)}),tripwire.signatures.undo[e]&&tripwire.signatures.undo[e].length>0?$("#undo").removeClass("disabled"):$("#undo").addClass("disabled"),tripwire.signatures.redo[e]&&tripwire.signatures.redo[e].length>0?$("#redo").removeClass("disabled"):$("#redo").addClass("disabled")},tripwire.systemChange(viewingSystemID,"init");
var tutorial;$("#infoWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#infoWidget"),intro:"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system (not the in-game system).</p>"},{element:document.querySelector("#infoGeneral"),intro:"<p>This section includes the system name, security rating, region, and owning faction.</p>"},{element:document.querySelector("#activityGraph"),intro:"<p>This is the graph containing historical ship jump and kill information.</p>"},{element:$("#activityGraph svg > g > g:nth-child(5)")[0],intro:"<p>Each value can be toggled by clicking these keys to drill down the graph into finer detail.</p>"},{element:document.querySelector("#activityGraphControls"),intro:"<p>Select different lengths of historical data to show</p>"},{element:document.querySelector("#infoStatics"),intro:"<p>If a wormhole system is selected, the static wormholes will appear here.</p>"},{element:document.querySelector("#infoLinks"),intro:"<p>These are some quick links to various sites for this specific system.</p>"}]}).start()}),$("#signaturesWidget .tutorial").click(function(){tutorial=introJs().setOptions({showStepNumbers:!1,steps:[{element:document.querySelector("#signaturesWidget"),intro:"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system (not the in-game system).</p>"},{element:document.querySelector("#add-signature2"),intro:"<p>Add new signatures or wormholes manually by clicking the + icon.</p>"},{element:document.querySelector("#toggle-automapper"),intro:"<p>Toggle the Auto-mapper feature on (orange) or off. (more details here)</p>"},{element:document.querySelector("#signature-count"),intro:"<p>Shows the current count of signatures.</p>"},{element:document.querySelector("#undo"),intro:"<p>Click or use the keyboard shortcut CTRL-Z to undo the last changes made to these signatures (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#redo"),intro:"<p>Click or use the keyboard shortcut CTRL-Y to redo the last changes made to these signatures (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>"},{element:document.querySelector("#sigTable"),intro:"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>"}]}).start()}),$("#notesWidget .tutorial").click(function(t){t.preventDefault(),(tutorial=introJs().setOptions({showStepNumbers:!1,exitOnEsc:!1,exitOnOverlayClick:!1,skipLabel:"Abort",steps:[{element:document.querySelector("#notesWidget"),intro:"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system (not the in-game system).</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>"},{element:document.querySelector("#add-comment"),intro:"<p>Now click the + icon to begin adding a new comment in this system ("+viewingSystem+").</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Type some basic text now and click save.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>Click on the <b>Edit</b> now on our comment.</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>"},{element:document.querySelector("#notesWidget"),intro:"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>"}]}).start()).onchange(function(t){switch(tutorial._currentStep){case 1:$(".introjs-prevbutton, .introjs-nextbutton").hide(),console.log("switch mask to private"),tutorial.previousMask=options.masks.active,options.masks.active=options.character.id+".1",options.save(),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[2].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(3),tutorial.exiting=!0},200)},$("#notesWidget #add-comment").on("click",tutorial.stepFunc);break;case 2:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),tutorial.stepFunc=function(){tutorial.comment=$(this).closest(".comment"),setTimeout(function(){tutorial._options.steps[3].element=tutorial.comment[0],tutorial._options.steps[4].element=tutorial.comment.find(".commentSticky")[0],tutorial._options.steps[5].element=tutorial.comment.find(".commentControls")[0],tutorial._options.steps[6].element=tutorial.comment.find(".commentControls")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(4),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentSave",tutorial.stepFunc);break;case 6:$(".introjs-prevbutton, .introjs-nextbutton").hide(),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),tutorial.stepFunc=function(){setTimeout(function(){tutorial._options.steps[7].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial._options.steps[8].element=$("#notesWidget").find(".comment:has(.cke_toolbar)")[0],tutorial.setOption("steps",tutorial._options.steps),tutorial.exiting=!1,tutorial.exit().start().goToStep(8),tutorial.exiting=!0},200)},$("#notesWidget").on("click",".commentEdit",tutorial.stepFunc)}}),tutorial.onexit(function(){if(tutorial.exiting){if($(".commentCancel:visible").click(),tutorial.comment){var t={mode:"delete",commentID:tutorial.comment.data("id")};$.ajax({url:"comments.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){t&&1==t.result&&tutorial.comment.remove()})}tutorial.previousMask&&setTimeout(function(){console.log("change mask back, delete comment",tutorial.previousMask),options.masks.active=tutorial.previousMask,options.save()},200),$("#notesWidget #add-comment").off("click",tutorial.stepFunc),$("#notesWidget").off("click",".commentSave",tutorial.stepFunc),$("#notesWidget").off("click",".commentEdit",tutorial.stepFunc),$("#notesWidget").off("click",".cke_toolgroup:has(.cke_button__toolbarswitch)",tutorial.stepFunc)}}),tutorial.previousMask,tutorial.comment,tutorial.stepFunc,tutorial.exiting=!0});
tripwire.undo=function(){if(tripwire.signatures.undo[viewingSystemID].length>0){$("#undo").addClass("disabled");var e=tripwire.signatures.undo[viewingSystemID].length-1,i={systemID:viewingSystemID,request:{signatures:{add:[],delete:[],update:[]}}},t=tripwire.signatures.undo[viewingSystemID][e];switch(t.action){case"add":i.request.signatures.delete=i.request.signatures.delete.concat($.map(t.signatures,function(e){return e.id}));break;case"delete":i.request.signatures.add=i.request.signatures.add.concat(t.signatures);break;case"update":i.request.signatures.update=i.request.signatures.update.concat(t.signatures)}var s=tripwire.client.signatures;tripwire.refresh("refresh",i,function(e){1==e.result&&(tripwire.signatures.undo[viewingSystemID].pop(),$("#redo").removeClass("disabled"),viewingSystemID in tripwire.signatures.redo?"update"==t.action?tripwire.signatures.redo[viewingSystemID].push({action:t.action,signatures:$.map(t.signatures,function(e){return s[e.id]})}):tripwire.signatures.redo[viewingSystemID].push({action:t.action,signatures:t.signatures}):"update"==t.action?tripwire.signatures.redo[viewingSystemID]=[{action:t.action,signatures:$.map(t.signatures,function(e){return s[e.id]})}]:tripwire.signatures.redo[viewingSystemID]=[{action:t.action,signatures:t.signatures}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)),sessionStorage.setItem("tripwire_redo",JSON.stringify(tripwire.signatures.redo)))},function(e){tripwire.signatures.undo[viewingSystemID].length>0&&$("#undo").removeClass("disabled")})}};
var activity=new function(){this.graph,this.options,this.view,this.span=24,this.columns=[{id:"time",label:"Time",role:"domain",type:"string",calc:function(t,i){return t.getValue(i,0)+"h"}},{id:"jumps",label:"Jumps",role:"data",type:"number",sourceColumn:1,column:1,title:"Jumps"},{id:"podkills",label:"Pod Kills",role:"data",type:"number",sourceColumn:2,column:2,title:"Pod Kills"},{id:"shipkills",label:"Ship Kills",role:"data",type:"number",sourceColumn:3,column:3,title:"Ship Kills"},{id:"npckills",label:"NPC Kills",role:"data",type:"number",sourceColumn:4,column:4,title:"NPC Kills"}],this.getData=function(t,i){var t=void 0!==t?t:this.span,i=void 0===i||i,e=$.ajax({url:"activity_graph.php",data:{systemID:viewingSystemID,time:t},type:"GET",dataType:"JSON",async:!1,cache:i}).responseJSON;return e.rows.reverse(),this.view=new google.visualization.DataView(new google.visualization.DataTable(e)),this.view.setColumns(this.columns),this.view},this.selectHandler=function(){var t=activity.graph.getSelection();if(t[0]&&null==t[0].row){var i=t[0].column;activity.columns[i].sourceColumn?(activity.columns[i].label=activity.columns[i].title+" (off)",delete activity.columns[i].sourceColumn):(activity.columns[i].sourceColumn=activity.columns[i].column,activity.columns[i].label=activity.columns[i].title),activity.view.setColumns(activity.columns),activity.options.animation.duration=0,activity.graph.draw(activity.view,activity.options),activity.options.animation.duration=500}},this.init=function(){this.graph=new google.visualization.AreaChart(document.getElementById("activityGraph")),this.options={isStacked:!1,backgroundColor:"transparent",hAxis:{textStyle:{color:"#999",fontName:"Verdana",fontSize:10},showTextEvery:3},vAxis:{textStyle:{color:"#666",fontName:"Verdana",fontSize:10},viewWindowMode:"maximized",viewWindow:{min:0},maxValue:5},gridlineColor:"#454545",pointSize:2,lineWidth:1,chartArea:{left:"10%",top:"5%",width:"88%",height:"85%"},legend:{position:"in",textStyle:{color:"#CCC",fontName:"Verdana",fontSize:8.5}},animation:{duration:500,easing:"inAndout"},tooltip:{showColorCode:!0},annotations:{style:"line",textStyle:{fontSize:12,color:"#ccc"},domain:0},focusTarget:"category"},google.visualization.events.addListener(this.graph,"select",this.selectHandler),this.graph.draw(this.getData(this.span),this.options)},this.time=function(t){switch(t){case 24:this.options.hAxis.showTextEvery=3;break;case 48:this.options.hAxis.showTextEvery=6;break;case 168:this.options.hAxis.showTextEvery=24}this.span=t,this.graph.draw(this.getData(t),this.options)},this.redraw=function(){this.graph.draw(this.view,this.options)},this.refresh=function(t){this.graph.draw(this.getData(this.span,t),this.options)},google.setOnLoadCallback(this.init())};
var chain=new function(){this.map,this.view,this.options,this.drawing,this.data={},this.newView=function(i){return this.view=new google.visualization.DataView(new google.visualization.DataTable(i)),this.view},this.activity=function(i){return $("#chainMap .nodeActivity > span:not(.invisible)").addClass("invisible"),$("#chainMap [data-nodeid]").each(function(){var s=$(this).attr("data-nodeid");if(i[s]){var e=i[s].shipJumps,t=i[s].podKills,a=i[s].shipKills,n=i[s].npcKills,l=$(this).find(".nodeActivity");e>0&&l.find(".jumps").removeClass("invisible").attr("title",e+" Jumps"),t>0&&l.find(".pods").removeClass("invisible").attr("title",t+" Pod Kills"),a>0&&l.find(".ships").removeClass("invisible").attr("title",a+" Ship Kills"),n>0&&l.find(".npcs").removeClass("invisible").attr("title",n+" NPC Kills")}}),$("#chainMap .nodeActivity > span[title]").jBox("Tooltip",{position:{y:"bottom"}}),i},this.occupied=function(i){$("#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge").addClass("invisible");for(var s in i)$("#chainMap [data-nodeid='"+i[s].systemID+"'] [data-icon='user']").removeClass("invisible"),$("#chainMap [data-nodeid='"+i[s].systemID+"'] [data-icon='user'] + .badge").removeClass("invisible").html(i[s].count);return OccupiedToolTips.attach($("#chainMap [data-icon='user']:not(.invisible)")),i},this.flares=function(i){if($("#chainMap td.node").removeClass("redNode yellowNode greenNode"),$("#chainGrid tr").removeClass("red yellow green"),i)for(var s in i.flares){var e=i.flares[s].systemID,t=i.flares[s].flare,a=($("#chainMap [data-nodeid="+e+"]").parent().addClass(t+"Node").parent().index()-1)/3*2;a>0&&$("#chainGrid tr:eq("+a+")").addClass(t).next().addClass(t)}return i},this.grid=function(){if(0==options.chain.gridlines)return $("#chainGrid tr").addClass("hidden"),!1;$("#chainGrid tr").removeClass("hidden");var i=2*$(".google-visualization-orgchart-table tr:has(.node)").length-1;$("#chainGrid tr:gt("+i+")").addClass("hidden")},this.lines=function(i){for(var s in i.lines)!function(s,e,t,a){var n=$("#chainMap #node"+s).parent();if(0==n.length)return!1;var l=Math.ceil((n[0].cellIndex+1)/2-1),r=$(n.parent().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[l]).addClass("left-"+t+" right-"+t),c=$("#chainMap #node"+e).parent();if(0==c.length||0==r.length)return!1;var d=0,p=r[0].cellIndex;n.parent().prev().find("td").each(function(i){if(d+=this.colSpan,i==p)return!1});for(var o=Math.ceil((c[0].cellIndex+1)/2-1),h=o,m=0;m<=o;m++){var y=0;n.parent().prev().prev().prev().find("td > [data-nodeid]").each(function(i){if(i==m)return y=$(this).attr("id").replace("node",""),!1}),$.map(i.map.rows,function(i){return i.c[1].v==y?i:null}).length<=0&&h--}o=h;var v=$(n.parent().prev().prev().children("td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright")[o]).addClass("left-"+t+" right-"+t),u=0,e=!1,f=!1;n.parent().prev().prev().find("td").each(function(i,s){if(u+=this.colSpan,f&&e)return!1;if(void 0!==v[0]&&v[0].cellIndex==i){if(e=!0,$(this).addClass("left-"+t),f||u==d||$(this).addClass("bottom-"+t),d==u)return!1}else if(u==d)f=!0,$(this).addClass("bottom-"+t);else if(f||e){var a=0,l=!1,r=!1;if(n.parent().prev().find("td").each(function(i){if((a+=this.colSpan)==u&&($(this).hasClass("google-visualization-orgchart-lineleft")||$(this).hasClass("google-visualization-orgchart-lineright"))){if(0==e)return l=!0,v.removeClass("left-"+t+" right-"+t),!1;1==e&&(v.removeClass("left-"+t+" right-"+t),n.parent().prev().prev().find("td").each(function(i){i>=v[0].cellIndex&&$(this).removeClass("bottom-"+t)}),r=!0)}}),l)return!1;r||$(this).addClass("bottom-"+t)}})}(i.lines[s][0],i.lines[s][1],i.lines[s][2],i.lines[s][3])},this.nodes=function(i){function s(i,s){if(!i||!tripwire.systems[i])return!1;var e;tripwire.systems[i].class?e="<span class='wh'>C"+tripwire.systems[i].class+"</span>":tripwire.systems[i].security>=.45?e="<span class='hisec'>HS</span>":tripwire.systems[i].security>0?e="<span class='lowsec'>LS</span>":tripwire.systems[i].security<=0&&(e="<span class='nullsec'>NS</span>");var t=null,a=null;if(tripwire.systems[i].class){switch(tripwire.systems[i].effect){case"Black Hole":t="blackhole";break;case"Cataclysmic Variable":t="cataclysmic-variable";break;case"Magnetar":t="magnetar";break;case"Pulsar":t="pulsar";break;case"Red Giant":t="red-giant";break;case"Wolf-Rayet Star":t="wolf-rayet"}a=tripwire.systems[i].effect}var n={v:s},l="<div id='node"+s+"' data-nodeid='"+i+"'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' "+(t?"data-icon='"+t+"' data-tooltip='"+a+"'":null)+"></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge' class='invisible'></span></div></div><h4 class='nodeClass'>"+e+"</h4><h4 class='nodeSystem'><a href='.?system="+tripwire.systems[i].name+"'>"+(options.chain.tabs[options.chain.active]&&0!=options.chain.tabs[options.chain.active].systemID?options.chain.tabs[options.chain.active].name:tripwire.systems[i].name)+"</a></h4><h4 class='nodeType'>&nbsp;</h4><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>";return n.f=l,n}function e(i){if(i[0]<=0)return!1;var s=parseInt(i[1]),e=r.length;for(var t in c){var a=c[t];if(-1==$.inArray(a.id,p))if(a.systemID==i[0]){if((n={}).id=a.id,n.life=a.life,n.mass=a.mass,n.time=a.time,n.parent={},n.parent.id=s,n.parent.systemID=a.systemID,n.parent.name=a.system,n.parent.type=a.sig2Type,n.parent.typeBM=a.type2BM,n.parent.classBM=a.class2BM,n.parent.nth=a.nth2,n.parent.signatureID=a.sig2ID,n.child={},n.child.id=++e,n.child.systemID=a.connectionID,n.child.name=a.connection,n.child.type=a.type,n.child.typeBM=a.typeBM,n.child.classBM=a.classBM,n.child.nth=a.nth,n.child.signatureID=a.signatureID,d.push(n),r.push([n.child.systemID,n.child.id,i[2]]),p.push(n.id),$("#show-viewing").hasClass("active")&&tripwire.systems[n.child.systemID]&&!tripwire.systems[viewingSystemID].class&&!tripwire.systems[n.child.systemID].class){l=guidance.findShortestPath(tripwire.map.shortest,[viewingSystemID-3e7,n.child.systemID-3e7]).length-1;(o={}).life="Gate",o.parent={},o.parent.id=n.child.id,o.parent.systemID=n.child.systemID,o.parent.name=n.child.name,o.parent.type=n.child.type,o.parent.nth=n.child.nth,o.child={},o.child.id=++e,o.child.systemID=viewingSystemID,o.child.name=tripwire.systems[viewingSystemID].name,o.child.type=l,o.child.nth=null,o.child.signatureID=l,d.push(o),r.push([0,e])}if($("#show-favorite").hasClass("active")&&tripwire.systems[n.child.systemID])for(t in options.favorites)if(!(tripwire.systems[options.favorites[t]].regionID>=11e6||tripwire.systems[n.child.systemID].regionID>=11e6)){l=guidance.findShortestPath(tripwire.map.shortest,[options.favorites[t]-3e7,n.child.systemID-3e7]).length-1;(o={}).life="Gate",o.parent={},o.parent.id=n.child.id,o.parent.systemID=n.child.systemID,o.parent.name=n.child.name,o.parent.type=n.child.type,o.parent.nth=n.child.nth,o.child={},o.child.id=++e,o.child.systemID=options.favorites[t],o.child.name=tripwire.systems[options.favorites[t]].name,o.child.type=l,o.child.nth=null,o.child.signatureID=l,d.push(o),r.push([0,e])}}else if(a.connectionID==i[0]){var n={};if(n.id=a.id,n.life=a.life,n.mass=a.mass,n.time=a.time,n.parent={},n.parent.id=s,n.parent.systemID=a.connectionID,n.parent.name=a.connection,n.parent.type=a.type,n.parent.typeBM=a.typeBM,n.parent.classBM=a.classBM,n.parent.nth=a.nth,n.parent.signatureID=a.signatureID,n.child={},n.child.id=++e,n.child.systemID=a.systemID,n.child.name=a.system,n.child.type=a.sig2Type,n.child.typeBM=a.type2BM,n.child.classBM=a.class2BM,n.child.nth=a.nth2,n.child.signatureID=a.sig2ID,d.push(n),r.push([n.child.systemID,n.child.id,i[2]]),p.push(n.id),$("#show-viewing").hasClass("active")&&tripwire.systems[n.child.systemID]&&!tripwire.systems[viewingSystemID].class&&!tripwire.systems[n.child.systemID].class){l=guidance.findShortestPath(tripwire.map.shortest,[viewingSystemID-3e7,n.child.systemID-3e7]).length-1;(o={}).life="Gate",o.parent={},o.parent.id=n.child.id,o.parent.systemID=n.child.systemID,o.parent.name=n.child.name,o.parent.type=n.child.type,o.parent.nth=n.child.nth,o.child={},o.child.id=++e,o.child.systemID=viewingSystemID,o.child.name=tripwire.systems[viewingSystemID].name,o.child.type=l,o.child.nth=null,o.child.signatureID=l,d.push(o),r.push([0,e])}if($("#show-favorite").hasClass("active")&&tripwire.systems[n.child.systemID])for(t in options.favorites)if(!(tripwire.systems[options.favorites[t]].regionID>=11e6||tripwire.systems[n.child.systemID].regionID>=11e6)){var l=guidance.findShortestPath(tripwire.map.shortest,[options.favorites[t]-3e7,n.child.systemID-3e7]).length-1,o={};o.life="Gate",o.parent={},o.parent.id=n.child.id,o.parent.systemID=n.child.systemID,o.parent.name=n.child.name,o.parent.type=n.child.type,o.parent.nth=n.child.nth,o.child={},o.child.id=++e,o.child.systemID=options.favorites[t],o.child.name=tripwire.systems[options.favorites[t]].name,o.child.type=l,o.child.nth=null,o.child.signatureID=l,d.push(o),r.push([0,e])}}}}var t={cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}],rows:[]},a=["Q003","E004","L005","Z006","M001","C008","G008","A009"],n=[];if($("#chainTabs .current").length>0){var l=$("#chainTabs .current .name").data("tab").toString().split(","),r=[],c=i,d=[],p=[];if(0==l){y=0;for(var o in i)void 0===tripwire.systems[i[o].systemID].class?(y++,t.rows.push({c:[s(i[o].systemID,y),{v:null}]}),r.push([i[o].systemID,y,i[o].systemID])):tripwire.systems[i[o].connectionID]&&void 0===tripwire.systems[i[o].connectionID].class&&(y++,t.rows.push({c:[s(i[o].connectionID,y),{v:null}]}),r.push([i[o].connectionID,y,i[o].connectionID]))}else for(var o in l)t.rows.push({c:[s(l[o],parseInt(o)+1),{v:null}]}),r.push([l[o],parseInt(o)+1,l[o]]);for(y=0;y<r.length;y++)e(r[y])}else{$("#chainError").hide();var h={c:[]},m=viewingSystemID;h.c.push(s(m,1),{v:null}),t.rows.push(h);for(var r=[[m,1]],c=i,d=[],p=[],y=0;y<r.length;++y)e(r[y])}for(var o in d){var v,u=d[o],h={c:[]},f=tripwire.systems[u.child.systemID]?tripwire.systems[u.child.systemID].class:null,w=tripwire.systems[u.child.systemID]?tripwire.systems[u.child.systemID].security:null;v=6==f||"Class-6"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Class 6"==tripwire.wormholes[u.child.type].leadsTo?"<span class='wh'>C6</span>":5==f||"Class-5"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Class 5"==tripwire.wormholes[u.child.type].leadsTo?"<span class='wh'>C5</span>":4==f||"Class-4"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Class 4"==tripwire.wormholes[u.child.type].leadsTo?"<span class='wh'>C4</span>":3==f||"Class-3"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Class 3"==tripwire.wormholes[u.child.type].leadsTo?"<span class='wh'>C3</span>":2==f||"Class-2"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Class 2"==tripwire.wormholes[u.child.type].leadsTo?"<span class='wh'>C2</span>":1==f||"Class-1"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Class 1"==tripwire.wormholes[u.child.type].leadsTo?"<span class='wh'>C1</span>":f>6?"<span class='wh'>C"+f+"</span>":void 0!==tripwire.wormholes[u.child.type]&&tripwire.wormholes[u.child.type].leadsTo.split(" ").length>1?"<span class='wh'>C"+tripwire.wormholes[u.child.type].leadsTo.split(" ")[1]+"</span>":w>=.45||"High-Sec"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"High-Sec"==tripwire.wormholes[u.child.type].leadsTo&&!w?"<span class='hisec'>HS</span>":w>0||"Low-Sec"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Low-Sec"==tripwire.wormholes[u.child.type].leadsTo&&!w?"<span class='lowsec'>LS</span>":w<=0&&null!=w||"Null-Sec"==u.child.name||void 0!==tripwire.wormholes[u.child.type]&&"Null-Sec"==tripwire.wormholes[u.child.type].leadsTo?"<span class='nullsec'>NS</span>":"<span>&nbsp;</span>";var g=null,I=null;if(void 0!==tripwire.systems[u.child.systemID]){switch(tripwire.systems[u.child.systemID].effect){case"Black Hole":g="blackhole";break;case"Cataclysmic Variable":g="cataclysmic-variable";break;case"Magnetar":g="magnetar";break;case"Pulsar":g="pulsar";break;case"Red Giant":g="red-giant";break;case"Wolf-Rayet Star":g="wolf-rayet";break;default:g=null}I=tripwire.systems[u.child.systemID].effect}var D={v:u.child.id},b="<div id='node"+u.child.id+"' data-nodeid='"+u.child.systemID+"' data-sigid='"+u.id+"'><div class='nodeIcons'><div style='float: left;'><i class='whEffect' "+(g?"data-icon='"+g+"' data-tooltip='"+I+"'":null)+"></i></div><div style='float: right;'><i data-icon='user' class='invisible'></i><span class='badge' class='invisible'></span></div></div><h4 class='nodeClass'>"+(v+sigFormat(u.child.classBM,"class"))+"</h4><h4 class='nodeSystem'>"+(tripwire.systems[u.child.systemID]?"<a href='.?system="+tripwire.systems[u.child.systemID].name+"'>"+(u.child.name?u.child.name:tripwire.systems[u.child.systemID].name)+"</a>":"<a class='invisible'>system</a>")+"</h4><h4 class='nodeType'>"+("id"==options.chain["node-reference"]?u.child.signatureID:u.child.type+sigFormat(u.child.typeBM,"type")||"&nbsp;")+"</h4><div class='nodeActivity'><span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span></div></div>";D.f=b;var C={v:u.parent.id};h.c.push(D,C),t.rows.push(h),"Critical"!=u.life||-1==$.inArray(u.parent.type,a)&&-1==$.inArray(u.child.type,a)?"Critical"==u.life&&"Critical"==u.mass?n.push(Array(D.v,C.v,"eol-critical",u.id)):"Critical"==u.life&&"Destab"==u.mass?n.push(Array(D.v,C.v,"eol-destab",u.id)):-1!=$.inArray(u.parent.type,a)||-1!=$.inArray(u.child.type,a)?n.push(Array(D.v,C.v,"frig",u.id)):"Critical"==u.life?n.push(Array(D.v,C.v,"eol",u.id)):"Critical"==u.mass?n.push(Array(D.v,C.v,"critical",u.id)):"Destab"==u.mass?n.push(Array(D.v,C.v,"destab",u.id)):"Gate"!=u.life&&"GATE"!=u.parent.type&&"GATE"!=u.child.type||n.push(Array(D.v,C.v,"gate",u.id)):n.push(Array(D.v,C.v,"eol-frig",u.id))}return n.reverse(),{map:t,lines:n}},this.redraw=function(){var i=$.extend(!0,{},this.data);i.map=$.extend(!0,{},i.rawMap),this.draw(i)},this.draw=function(i){if((i=void 0!==i?i:{}).map){if(this.drawing=!0,this.data.rawMap=$.extend(!0,{},i.map),(null==options.chain.active||options.chain.tabs[options.chain.active]&&0==options.chain.tabs[options.chain.active].evescout)&&"273.0"!=options.masks.active)for(var s in i.map)"273.0"==i.map[s].mask&&delete i.map[s];if(Object.sort(i.map,"id"),$.extend(i,this.nodes(i.map)),$.extend(this.data,i),this.map.draw(this.newView(i.map),this.options),options.chain.tabs[options.chain.active])for(var e in options.chain.tabs[options.chain.active].collapsed){var t=$("#chainMap [data-nodeid='"+options.chain.tabs[options.chain.active].collapsed[e]+"']").attr("id");t&&(t=t.split("node")[1],this.map.collapse(t-1,!0))}this.lines(i),this.grid(),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attach($("#chainMap .whEffect")),this.drawing=!1}!this.data.activity||new Date>this.data.activity.expires?(i.activity={},tripwire.esi.universeJumps().done(function(s,e,t){i.activity.expires=new Date(t.getResponseHeader("expires")),$.each(s,function(e){i.activity[s[e].system_id]={systemID:s[e].system_id,shipJumps:s[e].ship_jumps}})}).then(function(){return tripwire.esi.universeKills().done(function(s){$.each(s,function(e){i.activity[s[e].system_id]?(i.activity[s[e].system_id].podKills=s[e].pod_kills,i.activity[s[e].system_id].shipKills=s[e].ship_kills,i.activity[s[e].system_id].npcKills=s[e].npc_kills):i.activity[s[e].system_id]={systemID:s[e].system_id,podKills:s[e].pod_kills,shipKills:s[e].ship_kills,npcKills:s[e].npc_kills}})})}).then(function(){chain.data.activity=chain.activity(i.activity)})):chain.activity(this.data.activity),i.occupied&&(this.data.occupied=this.occupied(i.occupied)),i.flares&&(this.data.flares=this.flares(i.flares)),i.last_modified&&(this.data.last_modified=i.last_modified)},this.collapse=function(i){if(chain.drawing)return!1;var s=chain.map.getCollapsedNodes();options.chain.tabs[options.chain.active].collapsed=[];for(x in s){var e=$("#chainMap #node"+(s[x]+1)).data("nodeid");options.chain.tabs[options.chain.active].collapsed.push(e)}chain.lines(chain.data),$("#chainMap [data-nodeid='"+viewingSystemID+"']").parent().addClass("currentNode"),WormholeTypeToolTips.attach($("#chainMap .whEffect")),chain.activity(chain.data.activity),chain.occupied(chain.data.occupied),chain.flares(chain.data.flares),chain.grid(),options.save()},this.init=function(){this.map=new google.visualization.OrgChart(document.getElementById("chainMap")),this.options={allowHtml:!0,allowCollapse:!0,size:"medium",nodeClass:"node"},google.visualization.events.addListener(this.map,"collapse",this.collapse),this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label:"System",type:"string"},{label:"Parent",type:"string"}]})),this.options)},this.init()};
var CKConfig={skin:"custom",height:100,allowedContent:!0,extraPlugins:"toolbarswitch,autogrow,autolink",enterMode:CKEDITOR.ENTER_BR,removeDialogTabs:"link:advanced",autoGrow_onStartup:!0,autoGrow_minHeight:100,toolbar_minToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike"]},{name:"paragraph",items:["BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize"]},{name:"tools",items:["Toolbarswitch"]}],toolbar_maxToolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript"]},{name:"paragraph",items:["NumberedList","BulletedList","Outdent","Indent"]},{name:"links",items:["Link"]},{name:"colors",items:["TextColor","BGColor"]},{name:"styles",items:["FontSize","Font"]},{name:"tools",items:["Source","Toolbarswitch"]}],toolbar:"minToolbar",smallToolbar:"minToolbar",maximizedToolbar:"maxToolbar",fontSize_style:{element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]}};CKEDITOR.on("instanceLoaded",function(e){e.editor.on("contentDom",function(){e.editor.on("key",function(t){return 27==t.data.keyCode?($(e.editor.element.$).closest(".comment").find(".commentCancel").click(),!1):t.data.domEvent.$.altKey&&83==t.data.domEvent.$.keyCode?($(e.editor.element.$).closest(".comment").find(".commentSave").click(),!1):void 0})}),$(".cke_combo__font a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>'),$(".cke_combo__fontsize a").removeClass("cke_combo_button").addClass("cke_button cke_button_off").html('<span class="cke_button_icon">&nbsp;</span>')}),CKEDITOR.on("instanceReady",function(e){e.editor.focus();var t=e.editor.getSelection(),o=t.getRanges(),n=o[0].startContainer,a=n.getParents(!0);if(!(n=a[a.length-2].getFirst()))return!1;for(;;){var i=n.getNext();if(null==i)break;n=i}t.selectElement(n),(o=t.getRanges())[0].collapse(!1),t.selectRanges(o)}),CKEDITOR.on("dialogDefinition",function(e){"link"==e.data.name&&(e.data.definition.getContents("target").get("linkTargetType").default="_blank")});
$("body").on("dblclick",".comment",function(e){e.preventDefault(),document.getSelection().removeAllRanges(),$(this).find(".commentEdit").click()}),$("body").on("click",".commentEdit",function(e){if(e.preventDefault(),$(".cke").length)return!1;var t=$(this).closest(".comment");t.find(".commentToolbar").hide(),CKEDITOR.replace(t.find(".commentBody").attr("id"),CKConfig).on("instanceReady",function(){t.find(".commentStatus").html(""),t.find(".commentFooter").show(),t.find(".commentFooter .commentControls").show()}),tripwire.activity.editComment=t.data("id"),tripwire.refresh("refresh")}),$("body").on("click",".commentSave, .commentCancel",function(e){e.preventDefault();var t=$(this);if(t.attr("disabled"))return!1;var o=t.closest(".comment");if(t.attr("disabled","true"),t.hasClass("commentSave")){var n={mode:"save",commentID:o.data("id"),systemID:o.find(".commentSticky").hasClass("active")?0:viewingSystemID,comment:CKEDITOR.instances[o.find(".commentBody").attr("id")].getData()};$.ajax({url:"comments.php",type:"POST",data:n,dataType:"JSON"}).done(function(e){e&&1==e.result&&(o.find(".commentModified").html("Edited by "+e.comment.modifiedBy+" at "+e.comment.modifiedDate),o.find(".commentCreated").html("Posted by "+e.comment.createdBy+" at "+e.comment.createdDate),Tooltips.attach(o.find("[data-tooltip]")),CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!1),o.attr("data-id",e.comment.id),o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),t.removeAttr("disabled"))})}else CKEDITOR.instances[o.find(".commentBody").attr("id")].destroy(!0),o.attr("data-id")?(o.find(".commentToolbar").show(),o.find(".commentFooter").hide(),t.removeAttr("disabled")):o.remove();o.find(".commentStatus").html(""),delete tripwire.activity.editComment,tripwire.refresh("refresh")}),$("body").on("click",".commentDelete",function(e){e.preventDefault();var t=$(this).closest(".comment");$("#dialog-deleteComment").hasClass("ui-dialog-content")?$("#dialog-deleteComment").dialog("isOpen")||$("#dialog-deleteComment").data("comment",t).dialog("open"):$("#dialog-deleteComment").data("comment",t).dialog({resizable:!1,minHeight:0,position:{my:"center",at:"center",of:$("#notesWidget")},dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("disable");var e=$(this).data("comment"),t={mode:"delete",commentID:e.data("id")};$.ajax({url:"comments.php",type:"POST",data:t,dataType:"JSON"}).done(function(t){t&&1==t.result&&($("#dialog-deleteComment").dialog("close"),e.remove())}).always(function(){$("#dialog-deleteComment").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}}})}),$("body").on("click","#add-comment",function(e){if(e.preventDefault(),$(".cke").length)return!1;var t=$(".comment:last").clone(),o=$(".comment:visible:last .commentBody").attr("id")?$(".comment:visible:last .commentBody").attr("id").replace("comment","")+1:0;$(".comment:last").before(t),t.find(".commentBody").attr("id","comment"+o),t.removeClass("hidden").find(".commentEdit").click()}),$("body").on("click",".commentSticky",function(e){e.preventDefault();var t=$(this).closest(".comment"),o={mode:"sticky",commentID:t.data("id"),systemID:t.find(".commentSticky").hasClass("active")?viewingSystemID:0};$.ajax({url:"comments.php",type:"POST",data:o,dataType:"JSON"}).done(function(e){e&&1==e.result&&(t.find(".commentSticky").hasClass("active")?t.find(".commentSticky").removeClass("active"):t.find(".commentSticky").addClass("active"))})});
var guidance=function(t){var r=function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.push(n);return r},n=function(t,r){return parseFloat(t)-parseFloat(r)},e=function(t,e,o,a){a=a||1/0;var i,c={},u={0:[e]},p={};for(c[e]=0;u&&(i=r(u)).length;){i.sort(n);var l=i[0],h=u[l],f=h.shift(),s=parseFloat(l),v=t[f]||{};h.length||delete u[l];for(var y in v)if(Object.prototype.hasOwnProperty.call(v,y)){var g=v[y]+s,d=c[y];(void 0===d||d>g)&&(c[y]=g,function(t,r){var n=""+t;u[n]||(u[n]=[]),u[n].push(r)}(g,y),p[y]=f)}}return void 0===c[o]?null:p},o=function(t,r){for(var n=[],e=r;e;)n.push(e),predecessor=t[e],e=t[e];return n.reverse(),n},a=function(t,r){for(var n,a,i,c=r.shift(),u=[];r.length;){if(n=r.shift(),!(a=e(t,c,n)))return null;if(i=o(a,n),!r.length)return u.concat(i);u.push.apply(u,i.slice(0,-1)),c=n}},i=function(t,r){try{return Array.prototype.slice.call(t,r)}catch(a){for(var n=[],e=r||0,o=t.length;e<o;++e)n.push(t[e]);return n}},c=function(t){this.map=t};return c.prototype.findShortestPath=function(t,r){return"[object Array]"===Object.prototype.toString.call(t)?a(this.map,t):2===arguments.length?a(this.map,[t,r]):a(this.map,i(arguments))},c.findShortestPath=function(t,r,n){return"[object Array]"===Object.prototype.toString.call(r)?a(t,r):3===arguments.length?a(t,[r,n]):a(t,i(arguments,1))},c}();
$("#admin").click(function(a){function i(){o&&o.abort(),t.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length),o=$.ajax({url:"admin.php",type:"POST",data:{mode:$("#dialog-admin .menu .active").attr("data-window")},dataType:"JSON"}).done(function(a){if(a&&a.results){for(var i=a.results,d=[],o=0,e=i.length;o<e;o++){var n=$("#dialog-admin .window .hasFocus tbody tr[data-id='"+i[o].id+"']");if(d.push(i[o].id),n.length)for(col in i[o])(l=n.find("[data-col='"+col+"']")).html(("number"==l.attr("data-format")?numFormat(i[o][col]):i[o][col])||"&nbsp;");else{(n=$("#dialog-admin .window .hasFocus table tr.hidden").clone()).attr("data-id",i[o].id);for(col in i[o]){var l=n.find("[data-col='"+col+"']");l.html(("number"==l.attr("data-format")?numFormat(i[o][col]):i[o][col])||"&nbsp;")}n.removeClass("hidden"),$("#dialog-admin .window .hasFocus tbody").append(n)}}$("#dialog-admin .window .hasFocus table tr[data-id]").each(function(){-1==$.inArray($(this).data("id").toString(),d)&&$(this).remove()}),$("#dialog-admin .window .hasFocus table").trigger("update",[!0])}else $("#dialog-admin .window .hasFocus table tr[data-id]").remove();t.html("Total: "+$("#dialog-admin .window .hasFocus table tr[data-id]").length)}),$("#dialog-admin").dialog("isOpen")&&$("#dialog-admin .menu .active").attr("data-refresh")&&(d=setTimeout(i,$("#dialog-admin .menu .active").attr("data-refresh")))}if(a.preventDefault(),$(this).hasClass("disabled"))return!1;if($("#dialog-admin").hasClass("ui-dialog-content"))$("#dialog-admin").dialog("isOpen")||$("#dialog-admin").dialog("open");else{var d=null,t=null,o=null;$("#dialog-admin").dialog({autoOpen:!0,modal:!0,height:350,width:800,buttons:{Close:function(){$(this).dialog("close")}},create:function(){$("#dialog-admin").on("click",".menu li",function(a){a.preventDefault(),$menuItem=$(this),clearTimeout(d),$("#dialog-admin .menu .active").removeClass("active"),$menuItem.addClass("active"),$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane").html(""),$("#dialog-admin .window [data-window]").removeClass("hasFocus").hide(),$("#dialog-admin .window [data-window='"+$menuItem.data("window")+"']").addClass("hasFocus").show(),i()}),$("#dialog-admin [data-sortable='true']").tablesorter({sortReset:!0,widgets:["saveSort"],sortList:[[0,0]]}),$($(this)[0].parentElement).find(".ui-dialog-buttonpane").append("<div class='ui-dialog-traypane'></div>"),t=$("div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane")},open:function(){$menuItem=$("#dialog-admin .menu li.active"),i()},close:function(){clearTimeout(d)}})}});
$("#wrapper").addClass("transition"),$(document).on("dialogopen",".ui-dialog",function(i,e){2==$(".ui-dialog:visible").length&&$(this).hasClass("dialog-modal")?$("body").append($("<div id='overlay' class='overlay' />").css("z-index",$(this).css("z-index")-1)):$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-1),$(this).hasClass("dialog-noeffect")||$("#wrapper").addClass("blur")}),$(document).on("dialogclose",".ui-dialog",function(i,e){$(".ui-dialog").is(":visible")||$("#wrapper").removeClass("blur"),1==$(".ui-dialog:visible").length?$("#overlay").remove():$("#overlay")&&$("#overlay").css("z-index",$(this).css("z-index")-2)}),$(document).on("click","#overwrite",function(){var i={request:{signatures:{delete:[$(this).data("id")]}},systemID:viewingSystemID};$("#overwrite").attr("disable",!0);tripwire.refresh("refresh",i,function(i){$("th.critical").removeClass("critical"),ValidationTooltips.close(),$("#dialog-sigEdit").parent().find(".ui-button-text:contains(Save)").click()},function(i){$("#overwrite").removeAttr("disable")})});
$(".options").click(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return!1;$("#dialog-options").dialog({autoOpen:!1,width:450,minHeight:400,modal:!0,buttons:{Save:function(){JSON.stringify(options);var a=!1;$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!0).addClass("ui-state-disabled"),options.chain.typeFormat=$("#dialog-options #typeFormat").val(),options.chain.classFormat=$("#dialog-options #classFormat").val(),options.chain.gridlines=JSON.parse($("#dialog-options input[name=gridlines]:checked").val()),options.chain["node-reference"]=$("#dialog-options input[name=node-reference]:checked").val(),options.signatures.pasteLife=$("#dialog-options #pasteLife").val(),options.background=$("#dialog-options #background-image").val(),options.uiscale=$("#dialog-options #uiscale-slider").slider("value"),options.masks.active!=$("#dialog-options input[name='mask']:checked").val()&&(a=!0),options.masks.active=$("#dialog-options input[name='mask']:checked").val(),options.apply(),options.save().done(function(){a&&($("#sigTable span[data-age]").countdown("destroy"),$("#sigTable tbody").empty(),$("#signature-count").html(0),tripwire.signatures.list={},tripwire.client.signatures=[],tripwire.refresh("change"))}),$("#dialog-options").dialog("close"),$("#dialog-options").parent().find(".ui-dialog-buttonpane button:contains('Save')").attr("disabled",!1).removeClass("ui-state-disabled"),$("#dialog-options input[name='mask']:checked").data("admin")?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")},Reset:function(){$("#dialog-confirm #msg").html("Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>"),$("#dialog-confirm").dialog("option",{buttons:{Reset:function(){options.reset(),options.apply(),$("#dialog-options").dialog("close"),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}).dialog("open")},Close:function(){$(this).dialog("close")}},open:function(){$.ajax({url:"user_stats.php",type:"POST",dataType:"JSON"}).done(function(a){for(stat in a)$("#"+stat).text(a[stat])}),$.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(a){if(a&&a.masks){$("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html("");for(var e in a.masks){var o=a.masks[e],i=$('<input type="radio" name="mask" id="mask'+e+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+e+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+a.masks[a.active].mask+"']").attr("checked",!0).trigger("change"),a.masks[a.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-options #pasteLife").val(options.signatures.pasteLife),$("#dialog-options #typeFormat").val(options.chain.typeFormat),$("#dialog-options #classFormat").val(options.chain.classFormat),$("#dialog-options input[name='node-reference'][value='"+options.chain["node-reference"]+"']").prop("checked",!0),$("#dialog-options input[name='gridlines'][value='"+options.chain.gridlines+"']").prop("checked",!0),$("#dialog-options #background-image").val(options.background)},create:function(){$("#optionsAccordion").accordion({heightStyle:"content",collapsible:!0,active:!1}),$("#uiscale-slider").slider({min:.7,max:1.4,step:.05,value:options.uiscale||1,change:function(a,e){$("body").css("zoom",e.value)},slide:function(a,e){$("label[for='uiscale-slider']").html(e.value)}}),$("label[for='uiscale-slider']").html($("#uiscale-slider").slider("value")),$("#dialog-pwChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#pwForm").submit()},Cancel:function(){$(this).dialog("close")}},close:function(){$("#pwForm input[name='password'], #pwForm input[name='confirm']").val(""),$("#pwError").text("").hide()}}),$("#pwChange").click(function(){$("#dialog-pwChange").dialog("open")}),$("#pwForm").submit(function(a){a.preventDefault(),$("#pwError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?($("#dialog-msg #msg").text("Password changed"),$("#dialog-msg").dialog("open"),$("#dialog-pwChange").dialog("close")):a&&a.error?$("#pwError").text(a.error).show("slide",{direction:"up"}):$("#pwError").text("Unknown error").show("slide",{direction:"up"})})}),$("#dialog-usernameChange").dialog({autoOpen:!1,resizable:!1,minHeight:0,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#usernameForm").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#usernameForm #username").html($("#dialog-options #username").html())},close:function(){$("#usernameForm [name='username']").val(""),$("#usernameError").text("").hide()}}),$("#usernameChange").click(function(){$("#dialog-usernameChange").dialog("open")}),$("#usernameForm").submit(function(a){a.preventDefault(),$("#usernameError").text("").hide(),$.ajax({url:"options.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?($("#dialog-msg #msg").text("Username changed"),$("#dialog-msg").dialog("open"),$("#dialog-options #username").html(a.result),$("#dialog-usernameChange").dialog("close")):a&&a.error?$("#usernameError").text(a.error).show("slide",{direction:"up"}):$("#usernameError").text("Unknown error").show("slide",{direction:"up"})})}),$("#masks").on("change","input.selector:checked",function(){$(this).data("owner")?($("#maskControls #edit").removeAttr("disabled"),$("#maskControls #delete").removeAttr("disabled")):($("#maskControls #edit").attr("disabled","disabled"),$("#maskControls #delete").attr("disabled","disabled")),0!=$(this).val()&&0==$(this).val().split(".")[1]?$("#dialog-options #leave").removeAttr("disabled"):$("#dialog-options #leave").attr("disabled","disabled")}),$("#dialog-joinMask").dialog({autoOpen:!1,resizable:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){var a=$("#dialog-joinMask #results input:checked"),e=$("#dialog-joinMask #results input:checked+label");$.ajax({url:"masks.php",type:"POST",data:{mask:a.val(),mode:"join"},dataType:"JSON"}).done(function(o){o&&o.result&&(e.css("width",""),e.find(".info").remove(),e.append('<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>'),$("#dialog-options #masks #"+o.type+" input.selector:last").before(a).before(e),$("#dialog-joinMask").dialog("close"))})},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-joinMask form").submit(function(a){a.preventDefault(),$("#dialog-joinMask #results").html(""),$("#dialog-joinMask #loading").show(),$("#dialog-joinMask input[type='submit']").attr("disabled","disabled"),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){if(a&&a.results)for(var e in a.results){var o=a.results[e],i=$('<input type="radio" name="mask" id="mask'+o.mask+'" value="'+o.mask+'" class="selector" data-owner="false" data-admin="'+o.admin+'" /><label for="mask'+o.mask+'" style="width: 100%; margin-left: -5px;">\t<img src="'+o.img+'" />\t<span class="selector_label">'+o.label+'</span>\t<div class="info">\t\t'+(o.characterName?o.characterName+"<br/>":"")+"\t\t"+o.corporationName+"<br/>\t\t"+o.allianceName+"\t</div></label>");$("#dialog-joinMask #results").append(i)}else a&&a.error?($("#dialog-error #msg").text(a.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))}).always(function(){$("#dialog-joinMask #loading").hide(),$("#dialog-joinMask input[type='submit']").removeAttr("disabled")})})},close:function(){$("#dialog-joinMask #results").html(""),$("#dialog-joinMask input[name='name']").val("")}}),$("#dialog-options #masks").on("click","input[name='find']+label",function(){$("#dialog-joinMask input[name='find']").val($(this).prev().val()),$("#dialog-joinMask").dialog("open")}),$("#dialog-options #masks").on("click",".closeIcon",function(){var a=$(this).closest("input.selector+label").prev();$("#dialog-confirm #msg").text("Are you sure you want to remove this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Remove:function(){var e={mode:"leave",mask:a.val()};$.ajax({url:"masks.php",type:"POST",data:e,dataType:"JSON"}).done(function(e){e&&e.result?(a.next().remove(),a.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#maskControls #delete").click(function(){var a=$("#masks input.selector:checked");$("#dialog-confirm #msg").text("Are you sure you want to delete this mask?"),$("#dialog-confirm").dialog("option",{buttons:{Delete:function(){var e={mode:"delete",mask:a.val()};$.ajax({url:"masks.php",type:"POST",data:e,dataType:"JSON"}).done(function(e){e&&e.result?(a.next().remove(),a.remove(),$("#dialog-confirm").dialog("close")):($("#dialog-confirm").dialog("close"),$("#dialog-error #msg").text("Unable to delete"),$("#dialog-error").dialog("open"))})},Cancel:function(){$(this).dialog("close")}}}).dialog("open")}),$("#dialog-createMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Create:function(){$("#dialog-createMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-createMask #accessList").on("click","#create_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-createMask form").submit(function(a){a.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?($.ajax({url:"masks.php",type:"POST",dataType:"JSON"}).done(function(a){if(a&&a.masks){$("#dialog-options #masks #default").html(""),$("#dialog-options #masks #personal").html(""),$("#dialog-options #masks #corporate").html("");for(var e in a.masks){var o=a.masks[e],i=$('<input type="radio" name="mask" id="mask'+e+'" value="'+o.mask+'" class="selector" data-owner="'+o.owner+'" data-admin="'+o.admin+'" /><label for="mask'+e+'"><img src="'+o.img+'" />'+(o.optional?'<i class="closeIcon" onclick="return false;" data-icon="red-giant"><i data-icon="times"></i></i>':"")+'<span class="selector_label">'+o.label+"</span></label>");$("#dialog-options #masks #"+o.type).append(i)}i=$('<input type="checkbox" name="find" id="findp" value="personal" class="selector" disabled="disabled" /><label for="findp"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');if($("#dialog-options #masks #personal").append(i),"1"==init.admin){i=$('<input type="checkbox" name="find" id="findc" value="corporate" class="selector" disabled="disabled" /><label for="findc"><i data-icon="search" style="font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;"></i></label>');$("#dialog-options #masks #corporate").append(i)}$("#dialog-options input[name='mask']").filter("[value='"+a.masks[a.active].mask+"']").attr("checked",!0).trigger("change"),a.masks[a.active].admin?$("#admin").removeClass("disabled"):$("#admin").addClass("disabled")}}),$("#dialog-createMask").dialog("close")):a&&a.error?($("#dialog-error #msg").text(a.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})}),$("#dialog-createMask select").selectmenu({width:100})},open:function(){$("#dialog-createMask input[name='name']").val(""),$("#dialog-createMask #accessList :not(.static)").remove()}}),$("#maskControls #create").click(function(){$("#dialog-createMask").dialog("open")}),$("#dialog-createMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().remove(),$(this).closest("label").remove()}),$("#dialog-editMask").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Save:function(){$("#dialog-editMask form").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){$("#dialog-editMask #accessList").on("click",".maskRemove",function(){$(this).closest("input.selector+label").prev().attr("name","deletes[]").hide(),$(this).closest("label").hide()}),$("#dialog-editMask #accessList").on("click","#edit_add+label",function(){$("#dialog-EVEsearch").dialog("open")}),$("#dialog-editMask form").submit(function(a){a.preventDefault(),$.ajax({url:"masks.php",type:"POST",data:$(this).serialize(),dataType:"JSON"}).done(function(a){a&&a.result?$("#dialog-editMask").dialog("close"):a&&a.error?($("#dialog-error #msg").text(a.error),$("#dialog-error").dialog("open")):($("#dialog-error #msg").text("Unknown error"),$("#dialog-error").dialog("open"))})})},open:function(){var a=$("#dialog-options input[name='mask']:checked").val();$("#dialog-editMask input[name='mask']").val(a),$("#dialog-editMask #accessList label.static").hide(),$("#dialog-editMask #loading").show(),$("#dialog-editMask #name").text($("#dialog-options input[name='mask']:checked+label .selector_label").text()),$.ajax({url:"masks.php",type:"POST",data:{mode:"edit",mask:a},dataType:"JSON"}).then(function(a){return tripwire.esi.fullLookup(a.results).done(function(a){if(a)for(var e in a)if("character"==a[e].category){o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+a[e].id+'_1373" value="'+a[e].id+'_1373" class="selector" /><label for="edit_'+a[e].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+a[e].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+a[e].corporation.name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}else if("corporation"==a[e].category){var o=$('<input type="checkbox" checked="checked" onclick="return false" name="" id="edit_'+a[e].id+'_2" value="'+a[e].id+'_2" class="selector" /><label for="edit_'+a[e].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+a[e].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+'<br/>\t\t<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />\t</div></label>');$("#dialog-editMask #accessList .static:first").before(o)}})}).then(function(a){$("#dialog-editMask #accessList label.static").show(),$("#dialog-editMask #loading").hide()})},close:function(){$("#dialog-editMask #accessList :not(.static)").remove()}}),$("#maskControls #edit").click(function(){$("#dialog-editMask").dialog("open")}),$("#dialog-EVEsearch").dialog({autoOpen:!1,dialogClass:"ui-dialog-shadow dialog-noeffect dialog-modal",buttons:{Add:function(){if($("#accessList input[value='"+$("#EVESearchResults input").val()+"']").length)return $("#dialog-error #msg").text("Already has access"),$("#dialog-error").dialog("open"),!1;$("#EVESearchResults .info").append('<input type="button" class="maskRemove" value="Remove" style="position: absolute; bottom: 3px; right: 3px;" />'),$("#EVESearchResults input:checked").attr("checked","checked"),$("#EVESearchResults input:checked").attr("onclick","return false");var a=$("#EVESearchResults .maskNode:has(input:checked)");$("#dialog-createMask").dialog("isOpen")?$("#dialog-createMask #accessList .static:first").before(a):$("#dialog-editMask").dialog("isOpen")&&$("#dialog-editMask #accessList .static:first").before(a),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},create:function(){$("#EVEsearch").submit(function(a){if(a.preventDefault(),""==$("#EVEsearch input[name='name']").val())return!1;$("#EVESearchResults, #searchCount").html(""),$("#EVEsearch #searchSpinner").show(),$("#EVEsearch input[type='submit']").attr("disabled","disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").attr("disabled",!0).addClass("ui-state-disabled"),tripwire.esi.search($("#EVEsearch input[name='name']").val(),$("#EVEsearch input[name='category']:checked").val(),$("#EVEsearch input[name='exact']")[0].checked).done(function(a){if(a&&(a.character||a.corporation))return a=$.merge(a.character||[],a.corporation||[]),total=a.length,a=a.slice(0,10),tripwire.esi.fullLookup(a).done(function(a){if($("#EVEsearch #searchCount").html("Found: "+total+"<br/>Showing: 10"),a)for(var e in a)if("character"==a[e].category){o=$('<div class="maskNode"><input type="checkbox" name="adds[]" id="find_'+a[e].id+'_1373" value="'+a[e].id+'_1373" class="selector" /><label for="find_'+a[e].id+'_1373">\t<img src="https://image.eveonline.com/Character/'+a[e].id+'_64.jpg" />\t<span class="selector_label">Character</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+a[e].corporation.name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}else if("corporation"==a[e].category){var o=$('<div class="maskNode"><input type="checkbox" name="" id="find_'+a[e].id+'_2" value="'+a[e].id+'_2" class="selector" /><label for="find_'+a[e].id+'_2">\t<img src="https://image.eveonline.com/Corporation/'+a[e].id+'_64.png" />\t<span class="selector_label">Corporation</span>\t<div class="info">\t\t'+a[e].name+"<br/>\t\t"+(a[e].alliance?a[e].alliance.name:"")+"<br/>\t</div></label></div>");$("#EVESearchResults").append(o)}}).always(function(){$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")});$("#dialog-error #msg").text("No Results"),$("#dialog-error").dialog("open"),$("#EVEsearch #searchSpinner").hide(),$("#EVEsearch input[type='submit']").removeAttr("disabled"),$("#dialog-EVEsearch").parent().find(".ui-dialog-buttonpane button:contains('Add')").removeAttr("disabled").removeClass("ui-state-disabled")})})},close:function(){$("#EVEsearch input[name='name']").val(""),$("#EVESearchResults, #searchCount").html("")}})}}),$("#dialog-options").dialog("open")});
$("#add-signature").click(function(i){i.preventDefault(),$("#dialog-sigAdd").dialog({autoOpen:!1,resizable:!1,minHeight:150,dialogClass:"dialog-noeffect",buttons:{Add:function(){$("#sigAddForm").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){$("#sigAddForm #sigID").val(""),$("#sigAddForm #sigType").val("Sites").selectmenu("refresh").trigger("selectmenuchange"),$("#sigAddForm #sigLife").val(72).selectmenu("refresh"),$("#sigAddForm #sigName").val(""),$("#sigAddForm #whType").val(""),$("#sigAddForm #connection").val(""),$("#sigAddForm #autoAdd")[0].checked=!1,$("#sigAddForm #autoAdd").button("refresh"),$("#sigAddForm #whLife").val("Stable").selectmenu("refresh"),$("#sigAddForm #whMass").val("Stable").selectmenu("refresh"),tripwire.client.EVE&&tripwire.client.EVE.systemName?$("#autoAdd").button("enable"):$("#autoAdd").button("disable")},close:function(){$("th.critical").removeClass("critical"),ValidationTooltips.close()},create:function(){$("#autoAdd").button().click(function(){$("#sigAddForm #connection").val(tripwire.client.EVE.systemName)}),$("#sigAddForm #sigType, #sigAddForm #sigLife").selectmenu({width:100}),$("#sigAddForm #whLife, #sigAddForm #whMass").selectmenu({width:80}),$("#sigAddForm .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#sigAddForm .typesAutocomplete").inlinecomplete({source:whList,maxSize:10,delay:0}),$("#sigAddForm #whType, #sigAddForm #sigID").blur(function(i){""==this.value&&(this.value="???")}),$("#sigAddForm #whType, #sigAddForm #sigID").focus(function(i){$(this).select()})}}),$("#dialog-sigAdd").dialog("open")}),$("#sigAddForm").submit(function(i){if(i.preventDefault(),$("#sigAddForm #connection").val($("#sigAddForm #connection").val().trim()),$("th.critical").removeClass("critical"),ValidationTooltips.close(),""==$("#sigAddForm #sigID").val()||3!==$("#sigAddForm #sigID").val().length)return $("#sigAddForm #sigID").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigAddForm #sigID")}).setContent("Must be 3 Letters in length!");if("???"!==$("#sigAddForm #sigID").val()){for(var e=$("#sigAddForm #sigID").val().length;e--;)if($("#sigAddForm #sigID").val()[e].toLowerCase()===$("#sigAddForm #sigID").val()[e].toUpperCase())return $("#sigAddForm #sigID").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigAddForm #sigID")}).setContent("Must be only letters!");if(-1!==$.map(tripwire.client.signatures,function(i){return"273.0"!=i.mask||(null==options.chain.active||options.chain.tabs[options.chain.active].evescout)&&null!=options.chain.active?viewingSystemID==i.systemID?i.signatureID:i.sig2ID:null}).indexOf($("#sigAddForm #sigID").val().toUpperCase()))return $("#sigAddForm #sigID").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigAddForm #sigID")}).setContent("Signature ID already exists!")}if("Wormhole"==$("#sigAddForm #sigType").val()&&""==$("#sigAddForm #whType").val())return $("#sigAddForm #whType").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigAddForm #whType")}).setContent("Must specify a wormhole type!");if("Wormhole"==$("#sigAddForm #sigType").val()&&-1==whList.indexOf($("#sigAddForm #whType").val()))return $("#sigAddForm #whType").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigAddForm #whType")}).setContent("Not a valid wormhole type!");if("Wormhole"==$("#sigAddForm #sigType").val()&&$("#sigAddForm #connection").val()&&-1==tripwire.aSigSystems.indexOf($("#sigAddForm #connection").val()))return $("#sigAddForm #connection").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigAddForm #connection")}).setContent("Not a valid leads to system!");var t=$(this).serializeObject();t.systemID=viewingSystemID,t.lifeLength=tripwire.wormholes[t.whType]?tripwire.wormholes[t.whType].life.split(" ")[0]:72,t.class=sigClass(viewingSystem,t.whType),Object.index(tripwire.systems,"name",t.connectionName)&&(t.connectionID=Object.index(tripwire.systems,"name",t.connectionName),t.class2=sigClass(t.connectionName,null),t.connectionName=null);var s={request:{signatures:{add:t}}};$("#sigAddForm input[type=submit]").attr("disabled",!0),$("#dialog-sigAdd").parent().find(":button:contains('Add')").button("disable");tripwire.refresh("refresh",s,function(i){if(1==i.result){$("#dialog-sigAdd").dialog("close"),$("#undo").removeClass("disabled");var e=$.map(i.resultSet,function(e){return i.signatures[e]});viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"add",signatures:e}):tripwire.signatures.undo[viewingSystemID]=[{action:"add",signatures:e}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo))}},function(i){$("#sigAddForm input[type=submit]").removeAttr("disabled"),$("#dialog-sigAdd").parent().find(":button:contains('Add')").button("enable")})});
$("#sigTable").on("click",".sigDelete",function(e){return e.preventDefault(),!$(this).closest("tr").attr("disabled")&&($("#dialog-sigEdit").hasClass("ui-dialog-content")&&$("#dialog-sigEdit").dialog("isOpen")?($("#dialog-sigEdit").parent().effect("shake",300),!1):($(this).closest("tr").addClass("selected"),void($("#dialog-deleteSig").hasClass("ui-dialog-content")?$("#dialog-deleteSig").dialog("isOpen")||$("#dialog-deleteSig").dialog("open"):$("#dialog-deleteSig").dialog({resizable:!1,minHeight:0,dialogClass:"dialog-noeffect ui-dialog-shadow",buttons:{Delete:function(){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("disable");var e=$.map($("#sigTable tr.selected"),function(e){return $(e).data("id")}),i={request:{signatures:{delete:e}},systemID:viewingSystemID},t=$.map(e,function(e){return tripwire.client.signatures[e]});tripwire.refresh("refresh",i,function(e){e&&1==e.result&&($("#dialog-deleteSig").dialog("close"),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"delete",signatures:t}):tripwire.signatures.undo[viewingSystemID]=[{action:"delete",signatures:t}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(e){$("#dialog-deleteSig").parent().find(":button:contains('Delete')").button("enable")})},Cancel:function(){$(this).dialog("close")}},close:function(){$("#sigTable tr.selected").removeClass("selected")}}))))});
$("#add-signature2").click(function(e){e.preventDefault(),$("#dialog-signature").hasClass("ui-dialog-content")?$("#dialog-signature").dialog("isOpen")||$("#dialog-signature").dialog("open"):$("#dialog-signature").dialog({autoOpen:!0,resizable:!1,dialogClass:"dialog-noeffect ui-dialog-shadow",position:{my:"center",at:"center",of:$("#signaturesWidget")},buttons:{Add:function(){$("#form-signature").submit()},Cancel:function(){$(this).dialog("close")}},create:function(){var e=$.map(tripwire.wormholes,function(e,i){return i});e.splice(26,0,"K162"),e.push("GATE"),$("#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']").selectmenu({width:100}),$("#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']").selectmenu({width:80}),$("#dialog-signature [data-autocomplete='sigSystems']").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#dialog-signature [data-autocomplete='sigType']").inlinecomplete({source:e,maxSize:10,delay:0}),$("#dialog-signature #durationPicker").durationPicker(),$("#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']").on("input",function(){for(;!/^[a-zA-Z?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']").on("input",function(){for(;!/^[0-9?]*$/g.test(this.value);)this.value=this.value.substring(0,this.value.length-1)}),$("#dialog-signature .signatureID, #dialog-signature .wormholeType").on("click",function(){$(this).select()}),$("#dialog-signature .wormholeType").on("input, change",function(){$(this).val().length>0&&-1!=$.inArray($(this).val(),e)&&"K162"!=$(this).val()&&($("#dialog-signature .wormholeType").not(this).val("K162"),$("#dialog-signature #durationPicker").val(60*tripwire.wormholes[$(this).val()].life.substring(0,2)*60).change())}),$("#dialog-signature").on("selectmenuchange","[name='signatureType']",function(){"wormhole"==this.value?($("#dialog-signature #site").slideUp(200,function(){$(this).hide(0)}),$("#dialog-signature #wormhole").slideDown(200,function(){$(this).show(200)})):($("#dialog-signature #site").slideDown(200,function(){$(this).show(200)}),$("#dialog-signature #wormhole").slideUp(200,function(){$(this).hide(0)})),ValidationTooltips.close()}),$("#form-signature").submit(function(i){i.preventDefault();var t=$(this).serializeObject(),a=!0;if(ValidationTooltips.close(),$.each($("#dialog-signature .signatureID:visible"),function(){if($(this).val().length>0&&$(this).val().length<3)return ValidationTooltips.open({target:$(this)}).setContent("Must be 3 characters in length!"),$(this).select(),a=!1,!1}),!a)return!1;if(isNaN(parseInt($("#dialog-signature #durationPicker").val()))||!(parseInt($("#dialog-signature #durationPicker").val())>=300))return ValidationTooltips.open({target:$("#dialog-signature #durationPicker + .bdp-input")}).setContent("Must be at least 5 minutes!"),$("#dialog-signature #durationPicker").select(),!1;if($.each($("#dialog-signature .wormholeType:visible"),function(){if($(this).val().length>0&&-1==$.inArray($(this).val(),e))return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid wormhole type!"),$(this).select(),a=!1,!1}),!a)return!1;if($("#dialog-signature .leadsTo:visible")[0]&&-1==$.inArray($("#dialog-signature .leadsTo:visible:first").val(),tripwire.aSigSystems))return ValidationTooltips.open({target:$("#dialog-signature .leadsTo:visible:first")}).setContent("Must be a valid leads to system!"),$(this).select(),!1;if($.each($("#dialog-signature .leadsTo:visible"),function(){if($(this).val().length>0&&-1==$.inArray($(this).val(),tripwire.aSigSystems))return ValidationTooltips.open({target:$(this)}).setContent("Must be a valid leads to system!"),$(this).select(),a=!1,!1}),!a)return!1;console.log(t);var s={};if("wormhole"===t.signatureType){var n={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:viewingSystemID,type:"wormhole",name:t.wormholeName},o={signatureID:t.signatureID2_Alpha+t.signatureID2_Numeric,systemID:Object.index(tripwire.systems,"name",t.leadsTo)?Object.index(tripwire.systems,"name",t.leadsTo):$.inArray(t.leadsTo,tripwire.aSigSystems),type:"wormhole",name:t.wormholeName2};s={wormholes:{add:[{wormhole:{type:tripwire.wormholes[t.wormholeType]?t.wormholeType:tripwire.wormholes[t.wormholeType2]?t.wormholeType2:"",life:t.wormholeLife,mass:t.wormholeMass},signatures:[n,o]}]}}}else s={signatures:{add:[n={signatureID:t.signatureID_Alpha+t.signatureID_Numeric,systemID:viewingSystemID,type:t.signatureType,name:t.signatureName}]}};$.ajax({url:"signatures2.php",method:"POST",data:s,dataType:"JSON"}).done(function(e){1==e.resultSet[0].result&&$("#dialog-signature").dialog("close")}).always(function(e){console.log(e)})})},open:function(){$("#dialog-signature input").val(""),$("#dialog-signature [name='signatureType']").val("combat").selectmenu("refresh"),$("#dialog-signature #site").show(),$("#dialog-signature #wormhole").hide(),$("#dialog-signature .sideLabel:first").html(viewingSystem+" Side"),$("#dialog-signature .sideLabel:last").html("Other Side"),$("#dialog-signature #durationPicker").val(60*options.signatures.pasteLife*60).change()},close:function(){ValidationTooltips.close()}})});
function openSigEdit(i){return i.preventDefault(),!$(this).closest("tr").attr("disabled")&&($("#dialog-deleteSig").hasClass("ui-dialog-content")&&$("#dialog-deleteSig").dialog("isOpen")?($("#dialog-deleteSig").parent().effect("shake",300),!1):$("#dialog-sigEdit").hasClass("ui-dialog-content")&&$("#dialog-sigEdit").dialog("isOpen")?($("#dialog-sigEdit").parent().effect("shake",300),!1):($(this).closest("tr").addClass("selected"),void($("#dialog-sigEdit").hasClass("ui-dialog-content")?$("#dialog-sigEdit").dialog("isOpen")||$("#dialog-sigEdit").dialog("open"):$("#dialog-sigEdit").dialog({resizable:!1,minHeight:150,dialogClass:"ui-dialog-shadow dialog-noeffect",buttons:{Save:function(){$("#sigEditForm").submit()},Cancel:function(){$(this).dialog("close")}},open:function(){var i=$("#sigTable tr.selected").data("id");$("#sigEditForm").data("id",i);var e=tripwire.client.signatures[i];tripwire.activity.editSig=i,tripwire.refresh("refresh"),$("#autoEdit")[0].checked=!1,$("#autoEdit").button("refresh"),e.life||e.mass?(e.systemID==viewingSystemID?($("#dialog-sigEdit #sigID").val(e.signatureID),$("#dialog-sigEdit #sigType").val("Wormhole").selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-sigEdit #whType").val(e.type),$("#dialog-sigEdit #connection").val(tripwire.systems[e.connectionID]?tripwire.systems[e.connectionID].name:e.connection),$("#dialog-sigEdit #whLife").val(e.life).selectmenu("refresh"),$("#dialog-sigEdit #whMass").val(e.mass).selectmenu("refresh"),$("#dialog-sigEdit [name=side]").val("parent")):($("#dialog-sigEdit #sigID").val(e.sig2ID),$("#dialog-sigEdit #sigType").val("Wormhole").selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-sigEdit #whType").val(e.sig2Type),$("#dialog-sigEdit #connection").val(tripwire.systems[e.systemID]?tripwire.systems[e.systemID].name:e.system),$("#dialog-sigEdit #whLife").val(e.life).selectmenu("refresh"),$("#dialog-sigEdit #whMass").val(e.mass).selectmenu("refresh"),$("#dialog-sigEdit [name=side]").val("child")),$("#dialog-sigEdit #sigLife").val(72).selectmenu("refresh"),$("#dialog-sigEdit #sigName").val("")):($("#dialog-sigEdit #sigID").val(e.signatureID),$("#dialog-sigEdit #sigType").val("???"==e.type?"Sites":e.type).selectmenu("refresh").trigger("selectmenuchange"),$("#dialog-sigEdit #sigLife").val(e.lifeLength).selectmenu("refresh"),$("#dialog-sigEdit #sigName").val(e.name),$("#dialog-sigEdit #whType").val(""),$("#dialog-sigEdit #connection").val(""),$("#dialog-sigEdit #whLife").val("Stable").selectmenu("refresh"),$("#dialog-sigEdit #whMass").val("Stable").selectmenu("refresh"),$("#dialog-sigEdit [name=side]").val("parent")),tripwire.client.EVE&&tripwire.client.EVE.systemName?$("#autoEdit").button("enable"):$("#autoEdit").button("disable"),$("#dialog-sigEdit #sigID").select()},close:function(i,e){delete tripwire.activity.editSig,tripwire.refresh("refresh"),$(this).data("id",""),$("th.critical").removeClass("critical"),ValidationTooltips.close(),$("#sigTable tr.selected").removeClass("selected")},create:function(){$("#autoEdit").button().click(function(){$("#sigEditForm #connection").val(tripwire.client.EVE.systemName)}),$("#sigEditForm #sigType, #sigEditForm #sigLife").selectmenu({width:100}),$("#sigEditForm #whLife, #sigEditForm #whMass").selectmenu({width:80}),$("#sigEditForm .sigSystemsAutocomplete").inlinecomplete({source:tripwire.aSigSystems,maxSize:10,delay:0}),$("#sigEditForm .typesAutocomplete").inlinecomplete({source:whList,maxSize:10,delay:0}),$("#sigEditForm #whType, #sigEditForm #sigID").blur(function(i){""==this.value&&(this.value="???")}),$("#sigEditForm #whType, #sigEditForm #sigID").focus(function(i){$(this).select()})}}))))}$("#sigTable").on("click",".sigEdit",openSigEdit),$("#sigTable tbody").on("dblclick","tr",openSigEdit),$("#sigEditForm").submit(function(i){if(i.preventDefault(),$("#sigEditForm #connection").val($("#sigEditForm #connection").val().trim()),$("th.critical").removeClass("critical"),ValidationTooltips.close(),""==$("#sigEditForm #sigID").val()||3!==$("#sigEditForm #sigID").val().length)return $("#sigEditForm #sigID").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigEditForm #sigID")}).setContent("Must be 3 letters in length!");if("???"!==$("#sigEditForm #sigID").val()){for(var e=$("#sigEditForm #sigID").val().length;e--;)if($("#sigEditForm #sigID").val()[e].toLowerCase()===$("#sigEditForm #sigID").val()[e].toUpperCase())return $("#sigEditForm #sigID").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigEditForm #sigID")}).setContent("Must be only letters!");if($("#sigEditForm #sigID").val().toUpperCase()!==(viewingSystemID==tripwire.client.signatures[$(this).data("id")].systemID?tripwire.client.signatures[$(this).data("id")].signatureID:tripwire.client.signatures[$(this).data("id")].sig2ID)&&-1!==$.map(tripwire.client.signatures,function(i){return"273.0"!=i.mask||(null==options.chain.active||options.chain.tabs[options.chain.active].evescout)&&null!=options.chain.active?viewingSystemID==i.systemID?i.signatureID:i.sig2ID:null}).indexOf($("#sigEditForm #sigID").val().toUpperCase()))return $("#sigEditForm #sigID").focus().parent().prev("th").addClass("critical"),ValidationTooltips.open({target:$("#sigEditForm #sigID")}).setContent("Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='"+$("#sigTable tr:has(td:first-child:contains("+$("#sigEditForm #sigID").val().toUpperCase()+"))").data("id")+"' />"),void $("#overwrite").focus()}if("Wormhole"==$("#sigEditForm #sigType").val()&&""==$("#sigEditForm #whType").val())return $("#sigEditForm #whType").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigEditForm #whType")}).setContent("Must specify a wormhole type!");if("Wormhole"==$("#sigEditForm #sigType").val()&&-1==whList.indexOf($("#sigEditForm #whType").val()))return $("#sigEditForm #whType").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigEditForm #whType")}).setContent("Not a valid wormhole type!");if("Wormhole"==$("#sigEditForm #sigType").val()&&$("#sigEditForm #connection").val()&&-1==tripwire.aSigSystems.indexOf($("#sigEditForm #connection").val()))return $("#sigEditForm #connection").focus().parent().prev("th").addClass("critical"),void ValidationTooltips.open({target:$("#sigEditForm #connection")}).setContent("Not a valid leads to system!");var t=$(this).serializeObject();t.id=$(this).data("id"),t.systemID=viewingSystemID,tripwire.wormholes[t.whType]?t.lifeLength=tripwire.wormholes[t.whType].life.split(" ")[0]:"parent"==t.side?t.lifeLength=tripwire.wormholes[tripwire.client.signatures[t.id].sig2Type]?tripwire.wormholes[tripwire.client.signatures[t.id].sig2Type].life.split(" ")[0]:t.lifeLength:t.lifeLength=tripwire.wormholes[tripwire.client.signatures[t.id].type]?tripwire.wormholes[tripwire.client.signatures[t.id].type].life.split(" ")[0]:t.lifeLength,t.connectionID=t.connectionName?Object.index(tripwire.systems,"name",t.connectionName)||null:null,t.connectionName=t.connectionID?"parent"==t.side?tripwire.client.signatures[t.id].connectionID>0?tripwire.client.signatures[t.id].connection:null:tripwire.client.signatures[t.id].systemID>0?tripwire.client.signatures[t.id].system:null:t.connectionName,t.whLife=tripwire.client.signatures[t.id].life!=t.whLife?t.whLife:null,t.whLife=tripwire.client.signatures[t.id].life?t.whLife:"New "+t.whLife,t.sig2ID="parent"==t.side?tripwire.client.signatures[t.id].sig2ID:tripwire.client.signatures[t.id].signatureID,t.sig2Type="parent"==t.side?tripwire.client.signatures[t.id].sig2Type:tripwire.client.signatures[t.id].type,t.class=sigClass(viewingSystem,t.sig2Type),t.class2=sigClass(t.connectionID?tripwire.systems[t.connectionID].name:null,t.whType);var s={request:{signatures:{update:t}}},a=[tripwire.client.signatures[t.id]];$("#sigEditForm input[type=submit]").attr("disabled",!0),$("#dialog-sigEdit").parent().find(":button:contains('Save')").button("disable");tripwire.refresh("refresh",s,function(i){1==i.result&&($("#dialog-sigEdit").dialog("close"),$("#undo").removeClass("disabled"),viewingSystemID in tripwire.signatures.undo?tripwire.signatures.undo[viewingSystemID].push({action:"update",signatures:a}):tripwire.signatures.undo[viewingSystemID]=[{action:"update",signatures:a}],sessionStorage.setItem("tripwire_undo",JSON.stringify(tripwire.signatures.undo)))},function(i){$("#sigEditForm input[type=submit]").removeAttr("disabled"),$("#dialog-sigEdit").parent().find(":button:contains('Save')").button("enable")})});
//# sourceMappingURL=app.min.js.map
