{"version":3,"sources":["helpers.js","init.js","options.js","layout.js","tripwire.js","global-hooks.js","systemAnalysis.js","guidance.js","chain-map-renderer-orgchart.js","chain-map-renderer-radial.js","chain-map.js","active.js","addSignature.js","api.js","automapper.js","comments.js","deleteSignature.js","editSignature.js","esi.js","eve.js","parse.js","paste.js","redo.js","serverStatus.js","sync.js","systemChange.js","tutorials.js","undo.js","activity-graph.js","ckeditor.js","dialogs/admin-dialog.js","dialogs/base-dialog.js","dialogs/options-dialog.js","dialogs/ping-dialog.js","dialogs/signature-delete-dialog.js","dialogs/signature-dialog.js","system-mutators/favourite.js","system-mutators/invasions.js"],"names":["Object","sort","obj","prop","swapped","prev","i","Number","tmp","index","val","cs","key","toLowerCase","find","maxTime","maxTimeString","Date","time","dates","push","length","getTime","$","fn","serializeObject","self","this","json","push_counters","patterns","validate","fixed","named","build","base","value","push_counter","undefined","each","serializeArray","test","name","k","keys","match","merge","reverse_key","pop","replace","RegExp","extend","jQuery","letterToNumbers","string","toUpperCase","letters","sum","Math","pow","indexOf","substr","sigFormat","input","type","alpha","numeric","format","options","chain","typeFormat","classFormat","x","l","positionRelativeTo","elem","ancestor","elemPos","getBoundingClientRect","ancestorPos","left","scrollLeft","top","scrollTop","lookupMultiple","map","propertyName","lookupString","suppress","values","split","results","v","r","join","getCookie","c_name","c_value","document","cookie","c_start","c_end","unescape","substring","setCookie","exdays","exdate","setDate","getDate","escape","toUTCString","location","protocol","originalAddClassMethod","addClass","originalRemoveClassMethod","removeClass","className","result","apply","arguments","trigger","viewingSystem","attr","viewingSystemID","server","app_name","version","html","saveTimer","localOverrides","localOptions","JSON","parse","localStorage","getItem","userID","init","character","id","characterID","characterName","background","uiscale","favorites","grid","tracking","active","masks","corporationID","gridlines","tabs","node-reference","zoom","sigNameLocation","routingLimit","routeSecurity","routeIgnore","enabled","systems","renderer","signatures","editType","copySeparator","pasteLife","alignment","sigID","sigType","sigAge","leadsTo","sigLife","sigMass","buttons","follow","chainWidget","viewing","signaturesWidget","autoMapper","saveDelay","delay","clearTimeout","setTimeout","save","stringify","window","get","setItem","ajax","url","data","mode","dataType","load","set","local","constructor","reset","defaults","hasOwnProperty","oog","data-col","col","data-row","row","data-sizex","size_x","data-sizey","size_y","css","width","height","favorite","parseInt","home","kspace","evescout","inArray","a","href","hostname","pathname","search","filter","$tab","clone","systemID","append","guidance","clearCache","redraw","gridster","widget_selector","avoid_overlapped_widgets","widget_base_dimensions","widget_margins","autogrow_cols","helper","draggable","start","e","ui","resize","handle_class","max_size","min_size","stop","$widget","serialize_params","$w","wgd","disable","disable_resize","visibility","click","hasClass","serialize","enable","enable_resize","tripwire","timer","xhr","client","wormholes","list","undo","sessionStorage","redo","serverSignatureCount","activity","esi","refreshRate","connected","ageFormat","instance","_this","sync","setAgeFormat","countdown","serverTime","chainMap","draw","pastEOL","since","layout","whTooltip","sig","item","tooltip","sig2Type","whType","life","Intl","NumberFormat","mass","jump","ageTooltip","date","lifeTime","getMonth","getHours","getMinutes","createdByName","modifiedTime","modifiedByName","refresh","successCallback","alwaysCallback","getSystemIDsByNames","systemNames","on","preventDefault","system","systemChange","parseFloat","originalEvent","wheelDelta","fadeIn","timeout","keydown","activeElement","is","metaKey","ctrlKey","keyCode","getSelection","toString","output","signature","signatureID","wormhole","initialID","secondaryID","otherSignature","aSigSystems","lifeLength","lifeLeft","text","focus","select","Notify","splice","toggle","EVE","systemName","show","hide","characters","removeAttr","remove","isArray","delete","esiDelete","display","stopPropagation","content","color","stick","jBox","offset","y","animation","autoClose","ValidationTooltips","fade","Tooltips","attach","getContent","position","outside","SystemActivityToolTips","appendTo","reposition","repositionOnOpen","createOnInit","onOpen","targetPos","target","getElementById","tooltipWidth","source","closest","container","parent","offsetHeight","WormholeRouteToolTips","WormholeTypeToolTips","adjustDistance","responsiveWidth","OccupiedToolTips","pointer","minWidth","repositionOnContent","offsetWidth","setContent","cache","done","occupants","chars","b","shipTypeName","linkSig","sigName","sortable","items","axis","tolerance","containment","update","newTabs","setActiveTab","dialog","Remove Tab","Cancel","resizable","minHeight","dialogClass","OK","submit","open","close","create","inlinecomplete","maxSize","thera","checked","eq","contextmenu","delegate","menu","event","my","at","of","children","colName","cmd","beforeOpen","effect","duration","nodeElem","showInfo","setDestination","collapsed","collapse","existingTabIndex","newTab","wormholeID","class","existingTab","autoOpen","Close","payload","totalMass","toID","shipType","moogle","prototype","setFlare","flare","flares","removeFlare","widget","autocomplete","_create","element","_selectInit","_super","_value","originalReturn","_superApply","change","_suggest","_initSource","request","response","matcher","escapeRegex","term","Array","_close","input_source","addToSelect","select_added_value","select_source","unshift","removeFromSelect","wrapper","trim","toArray","_createShowAllButton","that","wasOpen","button","icons","primary","_search","tablesorter","sortReset","widgets","textExtraction","2","node","toggleClass","shiftKey","nextUntil","addBack","add","Ok","easing","systemAnalysis","mutators","addMutator","m","analyse","assign","baseSecurity","security","pathSymbol","systemTypeModifiers","forEach","mutate","systemTypeClass","factionID","systemTypeName","extractKeys","call","sorter","adjustCostForOptions","mapCost","findPaths","end","infinity","Infinity","costs","0","predecessors","addToOpen","cost","vertex","bucket","shift","currentCost","adjacentNodes","totalCost","vertexCost","extractShortest","nodes","u","predecessor","reverse","Guidance","kSpaceCache","findShortestPath","cacheKey","cachedPath","shortest","path","concat","slice","ChainMapRendererOrgchart","owner","google","visualization","OrgChart","allowHtml","allowCollapse","size","nodeClass","events","addListener","collapseHandler","DataView","DataTable","cols","label","ready","drawing","switchTo","style","charts","setOnLoadCallback","switchFrom","lines","newView","s","nodeId","nodeVal","updateLines","drawNodeLine","addModes","jquerySelector","prefixes","doModeClasses","c","removeModes","classFunc","prefix","$node","nodeIndex","ceil","cellIndex","$connector","$parent","nodeCol","connectorCell","colSpan","parentIndex","newparentIndex","checkSystem","rows","$connecte","me","tempCol","breaker","skip","lastLineData","getCollapsedNodes","collapsedSystems","updateCollapsed","ChainMapRendererRadial","newDiv","createElement","appendChild","div","parentNode","removeChild","mapData","drawInner","CIRCLE_SIZE","first_ring_delta","ringX","ci","ringY","maps","nodesById","ri","inNode","mapNode","minArc","newMap","circles","arc","circle","connection","markup","f","mi","ni","mapDiv","innerHTML","innerContainer","firstChild","bounds","makeDivsForRing","PI","domNode","finalPositions","w","h","cx","cy","parentWidth","parentHeight","outerContainer","canvas","getElementsByTagName","ctx","getContext","scale","translate","maxCi","beginPath","ellipse","lineWidth","setLineDash","strokeStyle","propertyFromCssClass","stroke","reduce","moveTo","cp1","radToCartesian","radPosition","theta","cp2","bezierCurveTo","lineTo","dashed","minRad","maxRad","parentCollapsed","skipped","rads_per_arc","acc","rad_offset","alignment_delta","frag","createRange","createContextualFragment","dblclick","dr","rad_centre","excess","nextBounds","rad","sin","cos","property","cssText","body","getComputedStyle","getPropertyValue","view","thirdPartySuppliers","renderers","orgChart","radial","useRenderer","elements","querySelectorAll","getAttribute","shipJumps","podKills","shipKills","npcKills","getElementsByClassName","jumps","setAttribute","pods","ships","npcs","attachedElements","detach","occupied","count","next","max","frigTypes","connections","topLevel","tab","makeSystemNode","whId","inSigId","nodeTypeMarkup","additionalClasses","systemType","leadsToPointer","nodeSecurity","nodeFaction","getSystemType","effectClass","_","systemNameText","chainNode","statics","shortCodeMap","High-Sec","Low-Sec","Null-Sec","Triglavian","Class 1","Class 2","Class 3","Class 4","Class 5","Class 6","classMap","H","L","N","▼","formatStatics","makeCalcChildNode","childID","targetSystem","child","calcNode","calculated","nth","findLinks","parentID","chainList","connectedTo","addCalcChildNodes","chainLinks","regionID","chainData","usedLinks","sig1","sig2","sig1Type","parentType","childType","floor","random","typeBM","classBM","sigIndex","supplier","ids","nextChildID","supplierNodes","ti","supplierNode","thirdParty","nodeNameSuffix","systemsInChainMap","closestToViewing","sigText","renderPath","modifiers","parentModifiers","chainModifiers","cm","parentPathHome","pathHome","pathToViewed","pathLength","systemMarkup","newIndex","rawMap","drawRetryTimer","inChain","prefixText","pathHomeText","n","pathToChainText","expires","universeJumps","status","getResponseHeader","system_id","ship_jumps","then","universeKills","pod_kills","ship_kills","npc_kills","editSigs","editComments","editSig","editComment","animate","backgroundColor","fadeOut","addSig","option","disabled","returnLinkText","wh","leadsToText","tr","until","moment","utc","toDate","onExpiry","alwaysExpire","compact","serverSync","wrapInner","slideDown","$set","replaceWith","contents","setReturnSig","sigToRemoveId","sigToUpdate","returnSig","sigToRemove","sigDialog","overwriteSignature","API","indicator","APIrefresh","expire","periodsToSeconds","onTick","t","from","to","stationID","shipTypeID","initial","secondary","toClass","title","signature2","resultSet","empty","action","comments","modified","$comment","comment","err","message","sticky","commentID","before","created","deleteSig","slideUp","edit","locationTimer","shipTimer","onlineTimer","baseUrl","userAgent","navigator","oauth","subject","accessToken","isExpired","tokenExpire","subtract","isBefore","expired","param","token","user_agent","jqXHR","locationDate","solar_system_id","stationName","shipID","shipName","station_id","stationLookup","always","reference","fail","warn","console","ship","shipDate","ship_item_id","ship_name","ship_type_id","typeLookup","online","characterStatus","typeID","destinationID","clear_waypoints","beginning","destination_id","clear_other_waypoints","add_to_beginning","headers","Authorization","X-User-Agent","targetID","target_id","eveStatus","idLookup","eveIDs","contentType","processData","characterLookup","eveID","async","corporationLookup","allianceLookup","searchString","categories","strict","fullLookup","promise","Deferred","category","characterData","corporation_id","corporationData","corporation","alliance_id","allianceData","alliance","resolve","parseOauth","_data","$clone","characterChange","updateSignatureTable","newSigsInSystem","mask","column","editing","sigEditing","currentSystem","signatureCount","updateReturnStatus","wormholeId","returnSigId","needReturn","pasteSignatures","processing","rowParse","scanner","columns","validScanGroups","validTypes","Combat Site","Data Site","Gas Site","Ore Site","Relic Site","Wormhole","Site de combat","Site de données","Site de collecte de gaz","Site de minerai","Site de reliques","Trou de ver","Kampfgebiet","Datengebiet","Gasgebiet","Mineraliengebiet","Reliktgebiet","Wurmloch","戦闘サイト","データサイト","ガスサイト","鉱石サイト","遺物サイト","ワームホール","전투 사이트","데이터 사이트","가스 사이트","채광 사이트","유물 사이트","웜홀","Боевой район","Информационный район","Газовый район","Астероидный район","Археологический район","Червоточина","scanGroup","parsePaste","paste","pasteIDs","removes","scan","clipboardData","getData","blur","lastIndex","redoItem","serverStatus","players","times","updateServerTime","innerText","setInterval","log","signatureTime","flareCount","flareTime","last_modified","commentCount","commentTime","appData","aSystems","wormholeInitialIDs","wormholeSecondaryIDs","notify","discord_integration","history","replaceState","effects","bad","whClass","modifier","abs","securityText","HS","LS","NS","Trig","fi","toFixed","factions","regions","tutorial","introJs","setOptions","showStepNumbers","steps","querySelector","intro","exitOnEsc","exitOnOverlayClick","skipLabel","onchange","_currentStep","previousMask","stepFunc","_options","setOption","exiting","exit","goToStep","off","onexit","undoItem","graph","span","role","calc","d","getValue","sourceColumn","setColumns","selectHandler","selections","AreaChart","isStacked","hAxis","textStyle","fontName","fontSize","showTextEvery","vAxis","viewWindowMode","viewWindow","min","maxValue","gridlineColor","pointSize","chartArea","legend","showColorCode","annotations","domain","focusTarget","CKConfig","skin","allowedContent","extraPlugins","enterMode","CKEDITOR","ENTER_BR","removeDialogTabs","autoGrow_onStartup","autoGrow_minHeight","toolbar_minToolbar","toolbar_maxToolbar","toolbar","smallToolbar","maximizedToolbar","fontSize_style","styles","font-size","overrides","attributes","cke","editor","domEvent","altKey","selected_ranges","getRanges","startContainer","parents","getParents","getFirst","getNext","selectElement","selectRanges","ev","definition","getContents","commentSortHandler","sortOrder","sortElem","containerElem","nextSort","flexDirection","removeAllRanges","$this","instances","modifiedDate","createdDate","destroy","Delete","refreshTimer","$total","$ajax","refreshWindow","abort","$row","$col","modal","$menuItem","sortList","parentElement","Save","maskChange","slider","Reset","stats","system_visits","account","logins","lastLogin","username","admin","img","optional","accordion","heightStyle","collapsible","step","slide","error","direction","Add","Remove","send","Create","selectmenu","total","Send","systemText","fromSignature","sigDialogVM","openSignatureDialog","sigId","aSigWormholes","durationPicker","not","form","valid","signatureID_Alpha","signatureID_Numeric","existingSignature","findIndex","signatureType","wormholeName","signatureLength","wormholeType","signatureID2_Alpha","signatureID2_Numeric","wormholeName2","wormholeType2","wormholeLife","wormholeMass","signatureName","sigAlpha","completeFunction","delegateSave","mutator_favourite","_FavouriteMutator","invasions","_Invasions","pathSymbolMap","stellar_reconnaissance","triglavian_minor_victory","escalating_liminality","final_liminality","edencom_minor_victory","redoubt","bulwark","fortress","textMap","systemInvasion","derived_security_status","tip","isEqual","info","keyBy"],"mappings":"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","file":"app.min.js","sourcesContent":["Object.sort = function(obj, prop) {\r\n\tvar swapped, prev;\r\n\tdo {\r\n\t\tswapped = false, prev = null;\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (prev && Number(obj[i][prop]) < Number(obj[prev][prop])) {\r\n\t\t\t\tvar tmp = obj[i];\r\n\t\t\t\tobj[i] = obj[prev];\r\n\t\t\t\tobj[prev] = tmp;\r\n\t\t\t\tswapped = true;\r\n\t\t\t}\r\n\t\t\tprev = i;\r\n\t\t}\r\n\t} while (swapped);\r\n}\r\n\r\nObject.index = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn key;\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn key;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObject.find = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn obj[key];\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nObject.maxTime = function(obj, prop) {\r\n\tvar maxTimeString = \"\", maxTime;\r\n\r\n\tfor (var key in obj) {\r\n\t\tif (!maxTime || maxTime < new Date(obj[key][prop])) {\r\n\t\t\tmaxTime = new Date(obj[key][prop]);\r\n\t\t\tmaxTimeString = obj[key][prop];\r\n\t\t}\r\n\t}\r\n\treturn maxTimeString;\r\n}\r\n\r\nObject.time = function(obj) {\r\n\tvar dates = [], key;\r\n\tfor (key in obj) {\r\n\t\tdates.push(new Date(obj[key].time));\r\n\t}\r\n\r\n\treturn dates.length ? dates.sort()[dates.length -1].getTime() /1000 : 0;\r\n};\r\n\r\n(function($){\r\n    $.fn.serializeObject = function(){\r\n\r\n        var self = this,\r\n            json = {},\r\n            push_counters = {},\r\n            patterns = {\r\n                \"validate\": /^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,\r\n                \"key\":      /[a-zA-Z0-9_]+|(?=\\[\\])/g,\r\n                \"push\":     /^$/,\r\n                \"fixed\":    /^\\d+$/,\r\n                \"named\":    /^[a-zA-Z0-9_]+$/\r\n            };\r\n\r\n\r\n        this.build = function(base, key, value){\r\n            base[key] = value;\r\n            return base;\r\n        };\r\n\r\n        this.push_counter = function(key){\r\n            if(push_counters[key] === undefined){\r\n                push_counters[key] = 0;\r\n            }\r\n            return push_counters[key]++;\r\n        };\r\n\r\n        $.each($(this).serializeArray(), function(){\r\n\r\n            // skip invalid keys\r\n            if(!patterns.validate.test(this.name)){\r\n                return;\r\n            }\r\n\r\n            var k,\r\n                keys = this.name.match(patterns.key),\r\n                merge = this.value,\r\n                reverse_key = this.name;\r\n\r\n            while((k = keys.pop()) !== undefined){\r\n\r\n                // adjust reverse_key\r\n                reverse_key = reverse_key.replace(new RegExp(\"\\\\[\" + k + \"\\\\]$\"), '');\r\n\r\n                // push\r\n                if(k.match(patterns.push)){\r\n                    merge = self.build([], self.push_counter(reverse_key), merge);\r\n                }\r\n\r\n                // fixed\r\n                else if(k.match(patterns.fixed)){\r\n                    merge = self.build([], k, merge);\r\n                }\r\n\r\n                // named\r\n                else if(k.match(patterns.named)){\r\n                    merge = self.build({}, k, merge);\r\n                }\r\n            }\r\n\r\n            json = $.extend(true, json, merge);\r\n        });\r\n\r\n        return json;\r\n    };\r\n})(jQuery);\r\n\r\nvar letterToNumbers = function(string) {\r\n    string = string.toUpperCase();\r\n    var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', sum = 0, i;\r\n    for (i = 0; i < string.length; i++) {\r\n        sum += Math.pow(letters.length, i) * (letters.indexOf(string.substr(((i + 1) * -1), 1)) + 1);\r\n    }\r\n    return sum;\r\n};\r\n\r\nvar sigFormat = function(input, type) {\r\n\tif (!input) return \"\";\r\n\r\n\tvar alpha = /^[a-zA-Z]+$/;\r\n\tvar numeric = /^[0-9]+$/;\r\n\tvar format = type == \"type\" ? options.chain.typeFormat || \"\" : options.chain.classFormat || \"\";\r\n\r\n\tfor (var x = 0, l = format.length; x < l; x++) {\r\n\t\tif (format[x].match(alpha)) {\r\n\t\t\tif (format[x].toUpperCase() == \"B\" && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (format[x] == format[x].toUpperCase()) {\r\n\t\t\t\t\tformat = format.substr(0, x) + input.toUpperCase() + format.substr(x + 1, l);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformat = format.substr(0, x) + input + format.substr(x + 1, l);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (format[x].match(numeric)) {\r\n\t\t\tif (format[x] == 2 && input == \"a\") {\r\n\t\t\t\treturn \"\";\r\n\t\t\t} else {\r\n\t\t\t\tformat = format.substr(0, x) + letterToNumbers(input) + format.substr(x +1, l);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn format;\r\n};\r\n\r\n/** Find the relative position of one element within the hierarchy tree of another */\r\nfunction positionRelativeTo(elem, ancestor) {\r\n\tconst elemPos = elem.getBoundingClientRect(),\r\n\t\tancestorPos = ancestor.getBoundingClientRect();\r\n\treturn { \r\n\t\tleft: elemPos.left - ancestorPos.left + ancestor.scrollLeft,\r\n\t\ttop: elemPos.top - ancestorPos.top + ancestor.scrollTop\r\n\t};\r\n}\r\n\r\n/** Look up one or more values in a comma separated string as keys in a data map, and return a property from the results in a new comma separated string.\r\nConvenience function for UI mapping.\r\nWill throw a failure message, unless suppress=true in which case it will return undefined, if \r\nany of the lookups fail to resolve. */\r\nfunction lookupMultiple(map, propertyName, lookupString, suppress) {\r\n\tconst values = lookupString.split(',');\r\n\tconst results = [];\r\n\tfor(var i = 0; i < values.length; i++) {\r\n\t\tconst v = values[i];\r\n\t\tconst r = map[v];\r\n\t\tif(!r) { \r\n\t\t\tif(suppress) { return undefined;}\r\n\t\t\telse { throw 'Value ' + v + ' did not match anything in ' + map; }\r\n\t\t}\r\n\t\tresults.push(r[propertyName]);\r\n\t}\r\n\treturn results.join(',');\r\n}\r\n\r\nvar getCookie = function(c_name) {\r\n\tvar c_value = document.cookie;\r\n\r\n\tvar c_start = c_value.indexOf(\" \" + c_name + \"=\");\r\n\tif (c_start == -1) {\r\n\t\tc_start = c_value.indexOf(c_name + \"=\");\r\n\t}\r\n\r\n\tif (c_start == -1) {\r\n\t\tc_value = null;\r\n\t} else {\r\n\t\tc_start = c_value.indexOf(\"=\", c_start) + 1;\r\n\t\tvar c_end = c_value.indexOf(\";\", c_start);\r\n\r\n\t\tif (c_end == -1) {\r\n\t\t\tc_end = c_value.length;\r\n\t\t}\r\n\r\n\t\tc_value = unescape(c_value.substring(c_start, c_end));\r\n\t}\r\n\r\n\treturn c_value;\r\n};\r\n\r\nvar setCookie = function(c_name, value, exdays) {\r\n\tvar exdate = new Date();\r\n\texdate.setDate(exdate.getDate() + exdays);\r\n\tvar c_value = escape(value) + ((exdays == null) ? \"\" : \"; expires=\"+exdate.toUTCString());\r\n\r\n\tdocument.cookie = c_name + \"=\" + c_value + \";\" + (document.location.protocol == \"https:\" ? \"secure;\" : \"\");\r\n};\r\n\r\n// Global CSS class change event\r\n(function($) {\r\n    var originalAddClassMethod = $.fn.addClass;\r\n\tvar originalRemoveClassMethod = $.fn.removeClass;\r\n\r\n    $.fn.addClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalAddClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n\r\n\t$.fn.removeClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalRemoveClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n})(jQuery);\r\n\r\n","var viewingSystem = $(\"meta[name=system]\").attr(\"content\");\nvar viewingSystemID = $(\"meta[name=systemID]\").attr(\"content\");\nvar server = $(\"meta[name=server]\").attr(\"content\");\nvar app_name = $(\"meta[name=app_name]\").attr(\"content\");\nvar version = $(\"meta[name=version]\").attr(\"content\");\n\n// Page cache indicator\nif (getCookie(\"loadedFromBrowserCache\") == \"true\") {\n\t$(\"#pageTime\").html(\"Page is Cached\");\n}\n\n// setCookie('loadedFromBrowserCache', true);\n\n// Use this to test performance of javascript code lines\n// var startTime = window.performance.now();\n// console.log(\"stint: \"+ (window.performance.now() - startTime));\n","var options = new function() {\r\n\tvar localOverrides = [\"grid\"];\r\n\tvar localOptions = JSON.parse(localStorage.getItem(\"tripwire_options\"));\r\n\tvar saveTimer;\r\n\r\n\tthis.userID = init.userID;\r\n\tthis.character = {id: init.characterID, name: init.characterName};\r\n\tthis.background = null;\r\n\tthis.uiscale = 1.0;\r\n\tthis.favorites = [];\r\n\tthis.grid = {};\r\n\tthis.tracking = {active: \"new\"};\r\n\tthis.masks = {active: init.corporationID + \".2\"};\r\n\tthis.chain = {typeFormat: null, classFormat: null, gridlines: true, active: 0, tabs: [], \"node-reference\": \"type\", zoom: 1.0, sigNameLocation: 'name', routingLimit: 15, routeSecurity: 'shortest', routeIgnore: { enabled: false, systems: [ 'Tama', 'Rancer' ] }, renderer: 'orgChart' };\r\n\tthis.signatures = {editType: \"unknown\", copySeparator: \",\", pasteLife: 72, alignment: {sigID: \"centerAlign\", sigType: \"centerAlign\", sigAge: \"centerAlign\", leadsTo: \"centerAlign\", sigLife: \"centerAlign\", sigMass: \"centerAlign\"}};\r\n\tthis.buttons = {follow: false, chainWidget: {viewing: false, favorites: false}, signaturesWidget: {autoMapper: false}};\r\n\r\n\tthis.saveDelay = function(delay) {\r\n\t\tif (saveTimer) clearTimeout(saveTimer);\r\n\r\n\t\tsaveTimer = setTimeout(\"options.save()\", delay);\r\n\t};\r\n\r\n\t// Saves options in both cookie and database\r\n\tthis.save = function() {\r\n\t\tvar options = JSON.stringify(window.options.get());\r\n\r\n\t\tlocalStorage.setItem(\"tripwire_options\", options);\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"options.php\",\r\n\t\t\tdata: {mode: \"set\", options: options},\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t});\r\n\t};\r\n\r\n\t// Loads options via passed object else cookie\r\n\tthis.load = function(data) {\r\n\t\tif (data && typeof(data) != \"undefined\") {\r\n\t\t\tthis.set(this, data);\r\n\t\t} else if (localOptions) {\r\n\t\t\tthis.set(this, localOptions);\r\n\t\t}\r\n\r\n\t\tthis.apply();\r\n\t};\r\n\r\n\t// Gets options from this by exluding types == function\r\n\tthis.get = function() {\r\n\t\tvar data = {};\r\n\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tdata[x] = this[x];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t};\r\n\r\n\t// Sets this from passed object\r\n\tthis.set = function(local, data) {\r\n\t\tfor (var prop in data) {\r\n\t\t\tif (data[prop] && data[prop].constructor && data[prop].constructor === Object) {\r\n\t\t\t\tif (local) {\r\n\t\t\t\t\tthis.set(local[prop], data[prop]);\r\n\t\t\t\t}\r\n\t\t\t} else if (local && typeof(local[prop]) != \"undefined\") {\r\n\t\t\t\tlocal[prop] = data[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset = function() {\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tthis[x] = JSON.parse(JSON.stringify(this.reset.defaults[x]));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Applies settings\r\n\tthis.apply = function() {\r\n\t\t// Local browser overrides\r\n\t\tif (localOptions) {\r\n            for (key in localOverrides) {\r\n                this[localOverrides[key]] = localOptions[localOverrides[key]];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Grid layout (detect old IGB setting options)\r\n\t\tif (this.grid.hasOwnProperty(\"oog\") && Object.keys(this.grid.oog||{}).length) {\r\n\t\t\t$.each(this.grid.oog, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t} else if (Object.keys(this.grid||{}).length) {\r\n\t\t\t$.each(this.grid, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Make sure favorites are all ints and not strings\r\n\t\tthis.favorites = $.map(this.favorites, function(favorite) {\r\n\t\t\treturn parseInt(favorite);\r\n\t\t});\r\n\r\n\t\t// Buttons\r\n\t\tif (this.buttons.follow) $(\"#follow\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.home) $(\"#home\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.kspace) $(\"#k-space\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.viewing) $(\"#show-viewing\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.favorites) $(\"#show-favorite\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.evescout) $(\"#eve-scout\").addClass(\"active\");\r\n\t\tif ($.inArray(parseInt(viewingSystemID), this.favorites) !== -1) $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\t\tif (this.buttons.signaturesWidget.autoMapper) $(\"#toggle-automapper\").addClass(\"active\");\r\n\r\n\t\t// UI Scale\r\n\t\tif (this.uiscale) {\r\n\t\t\t$(\"body\").css(\"zoom\", this.uiscale);\r\n\t\t}\r\n\r\n\t\t// Chain zoom\r\n\t\tif (this.chain.zoom) {\r\n\t\t\t$(\"#chainParent\").css(\"zoom\", this.chain.zoom);\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tif (this.background) {\r\n\t\t\tvar a = $('<a>', { href:this.background } )[0];\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"background-image: url(https://\" + a.hostname + a.pathname + a.search + \");\");\r\n\t\t} else {\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"\");\r\n\t\t}\r\n\r\n\t\t// Characters in Options\r\n\t\t$(\"#dialog-options #characters\").html(\"<img src='https://image.eveonline.com/Character/\"+init.characterID+\"_64.jpg' />\");\r\n\r\n\t\t// Active mask\r\n\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+this.masks.active+\"']\").attr(\"checked\", true);\r\n\r\n\t\t// Chain tabs\r\n\t\t$(\"#chainTabs\").html(\"\");\r\n\t\tfor (var x in this.chain.tabs) {\r\n\t\t\tif (this.chain.tabs[x]) {\r\n\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\r\n\t\t\t\t$tab.attr(\"id\", x).find(\".name\").data(\"tab\", this.chain.tabs[x].systemID).html(this.chain.tabs[x].name);\r\n\t\t\t\tif (x == this.chain.active) { $tab.addClass(\"current\"); }\r\n\r\n\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Reset routing cache in case routing options changed\r\n\t\tif(guidance) { guidance.clearCache(); }\r\n\r\n\t\t// Draw chain if Tripwire is initialized\r\n\t\tif (typeof(tripwire) !== \"undefined\") {\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset.defaults = JSON.parse(JSON.stringify(this.get()));\r\n\tthis.load(init && init.options ? init.options : null);\r\n}\r\n","var grid = $(\".gridster ul\").gridster({\n\twidget_selector: \"li.gridWidget\",\n\tavoid_overlapped_widgets: false,\n\twidget_base_dimensions: [50, 50],\n\twidget_margins: [5, 5],\n\tautogrow_cols: true,\n\thelper: \"clone\",\n\tdraggable: {\n\t\tstart: function(e, ui) {\n\t\t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\n\t\t}\n\t},\n\tresize: {\n    \tenabled: true,\n    \thandle_class: \"grid-resize\",\n    \tmax_size: [30, 30],\n    \tmin_size: [4, 4],\n    \tstart: function(e) {\n    \t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\n    \t},\n    \tstop: function(e, ui, $widget) {\n    \t\t//var width = parseInt($(\".gridster\").css(\"margin-left\")) + this.container_width;\n    \t\t//$(\"#wrapper\").css({width: width + \"px\"})\n    \t\tswitch ($widget.attr(\"id\")) {\n    \t\t\tcase \"infoWidget\":\n    \t\t\t\tsetTimeout(\"activity.redraw();\", 300);\n    \t\t\t\tbreak;\n    \t\t}\n    \t}\n\t},\n\tserialize_params: function($w, wgd) {\n\t\treturn {\n\t\t\tid: $w.attr(\"id\"),\n\t\t\tcol: wgd.col,\n\t\t\trow: wgd.row,\n\t\t\tsize_x: wgd.size_x,\n\t\t\tsize_y: wgd.size_y,\n\t\t\twidth: $w.width(),\n\t\t\theight: $w.height()\n\t\t}\n\t}\n}).data(\"gridster\").disable();\n\ngrid.disable_resize();\n$(\".grid-resize\").addClass(\"hidden\").attr(\"data-icon\", \"resize\");\n\n$(\".gridster\").css({visibility: \"visible\"});\n$(\".gridster > *\").addClass(\"gridster-transition\");\n\n$(\"#layout\").click(function() {\n\tif (!$(this).hasClass(\"active\")) {\n\t\tgrid.enable();\n\t\tgrid.enable_resize();\n\t\t$(\".grid-resize\").removeClass(\"hidden\");\n\n\t\t$(this).addClass(\"active\");\n\t} else {\n\t\tgrid.disable();\n\t\tgrid.disable_resize();\n\t\t$(\".grid-resize\").addClass(\"hidden\");\n\n\t\t$(this).removeClass(\"active\");\n\n\t\toptions.grid = grid.serialize();\n\n\t\toptions.save();\n\t}\n});\n","var tripwire = new function() {\r\n    this.timer, this.xhr;\r\n\tthis.version = version;\r\n\tthis.client = {signatures: {}, wormholes: {}};\r\n\tthis.server = {signatures: {}, wormholes: {}};\r\n\tthis.signatures = {list: {}, undo: JSON.parse(sessionStorage.getItem(\"tripwire_undo\")) || {}, redo: JSON.parse(sessionStorage.getItem(\"tripwire_redo\")) || {}};\r\n\tthis.serverSignatureCount = 0;\r\n\tthis.activity = {};\r\n\tthis.data = {tracking: {}, esi: {}};\r\n\tthis.refreshRate = 5000;\r\n\tthis.connected = true;\r\n\tthis.ageFormat = \"HM\";\r\n\tthis.instance = window.name ? window.name : (new Date().getTime() / 1000, window.name = new Date().getTime() / 1000);\r\n\r\n\t// Reference to `this` that can be used inside of functions\r\n\tvar _this = this\r\n\r\n    // Command to start/stop tripwire updates\r\n\t// ToDo: Include API and Server timers\r\n\tthis.stop = function() {\r\n\t\tclearTimeout(this.timer);\r\n\t\treturn this.timer;\r\n\t};\r\n\r\n\tthis.start = function() {\r\n\t\treturn this.sync();\r\n\t}\r\n\r\n    // Command to change Age format\r\n\t// ToDo: Cookie change to keep\r\n\tthis.setAgeFormat = function(format) {\r\n\t\tvar format = typeof(format) !== 'undefined' ? format : this.ageFormat;\r\n\r\n\t\t$(\"span[data-age]\").each(function() {\r\n\t\t\t$(this).countdown(\"option\", {format: format});\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n    this.serverTime = function() {\r\n\t\tthis.time;\r\n\r\n\t\tthis.serverTime.getTime = function() {\r\n\t\t\treturn tripwire.serverTime.time;\r\n\t\t}\r\n\t}\r\n    this.serverTime();\r\n\r\n    // Handles putting chain together\r\n\tthis.chainMap = function() {\r\n\t\tthis.chainMap.parse = function(data) {\r\n\t\t\tchain.draw(data);\r\n\t\t}\r\n\t}\r\n    this.chainMap();\r\n\r\n    this.pastEOL = function() {\r\n\t\tvar options = {since: $(this).countdown('option', 'until'), format: \"HM\", layout: \"-{hnn}{sep}{mnn}&nbsp;\"};\r\n\t\t$(this).countdown(\"option\", options);\r\n\t}\r\n\r\n    // Handles WH Type hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.whTooltip = function(sig) {\r\n\t\tif (viewingSystemID == sig.systemID) {\r\n\t\t\tif ($.inArray(sig.type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($.inArray(sig.sig2Type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+type+\"<br/>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($.inArray(type, $.map(tripwire.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\tvar whType = true;\r\n\t\t} else {\r\n\t\t\tvar whType = false;\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Life:</b> \"+(whType?tripwire.wormholes[type].life:\"Unknown\")+\"<br/>\";\r\n\r\n\t\tif (whType) {\r\n\t\t\tswitch (tripwire.wormholes[type].leadsTo.split(\" \")[0]) {\r\n\t\t\t\tcase 'High-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='hisec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Low-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='lowsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Null-Sec':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='nullsec'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Class':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='wh'>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span>\"+tripwire.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttooltip += \"<b>Leads To:</b> <span>Unknown</span><br/>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Max Mass</b>: \"+(whType?Intl.NumberFormat().format(tripwire.wormholes[type].mass):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\ttooltip += \"<b>Max Jumpable</b>: \"+(whType?Intl.NumberFormat().format(tripwire.wormholes[type].jump):\"Unknown\")+\" Kg<br/>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\t// Handles Age hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.ageTooltip = function(sig) {\r\n\t\t// var date = new Date(sig.lifeTime);\r\n\t\t// var localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t// date = new Date(date.getTime() + localOffset);\r\n        var date = new Date(sig.lifeTime);\r\n\r\n\t\tvar tooltip = \"<table class=\\\"age-tooltip-table\\\"><tr>\"\r\n        + \"<th>Created:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n        + \"<td>\"+sig.createdByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n        + \"</tr>\";\r\n\r\n\t\tif (sig.lifeTime != sig.modifiedTime) {\r\n\t\t\tdate = new Date(sig.modifiedTime);\r\n\t\t\t// localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t\t// date = new Date(date.getTime() + localOffset);\r\n      \r\n\t\t\ttooltip += \"<tr><th>Last Modified:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n          + \"<td>\"+sig.modifiedByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n          + \"</tr>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"</table>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n    this.refresh = function(mode, data, successCallback, alwaysCallback) {\r\n\t\tvar mode = mode || 'refresh';\r\n\r\n\t\tthis.sync(mode, data, successCallback, alwaysCallback);\r\n\t}\r\n\r\n\t// getSystemIDsByNames performs a case-insensitive search of the internal\r\n\t// list of systems looking for matches on each system name in the given\r\n\t// comma-separated list of names. A comma-separated list of system IDs is\r\n\t// returned if all systems are found, otherwise the empty string is returned.\r\n\tthis.getSystemIDsByNames = function(systemNames) {\r\n\t\tif (!_this.systems) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tconst values = systemNames.split(\",\");\r\n\t\tconst systems = [];\r\n\t\tfor(var i = 0; i < values.length; i++) {\r\n\t\t\tfor (systemID in _this.systems) {\r\n\t\t\t\tconst system = _this.systems[systemID];\r\n\t\t\t\tif (system.name.toLowerCase() == values[i].toLowerCase()) {\r\n\t\t\t\t\tsystems.push(systemID);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (values.length != systems.length) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\treturn systems.join(\",\");\r\n\t}\r\n}\r\n","$(\"body\").on(\"click\", \"a[href^='.?system=']\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).attr(\"href\").replace(\".?system=\", \"\");\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system);\r\n\r\n\ttripwire.systemChange(systemID);\r\n});\r\n\r\n$(\"body\").on(\"submit\", \"#systemSearch\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).find(\"[name='system']\").val();\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system, true) || false;\r\n\r\n\tif (systemID !== false) {\r\n\t\ttripwire.systemChange(systemID);\r\n\t\t$(this).find(\"[name='system']\").val(\"\");\r\n\t\t$(\"#search\").click();\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#undo:not(.disabled)\", function() {\r\n\ttripwire.undo();\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#redo:not(.disabled)\", function() {\r\n\ttripwire.redo();\r\n});\r\n\r\n// Chain map zooming (Gets funky if you push things too far)\r\n$(\"#chainParent\").on(\"mousewheel\", function(e) {\r\n\te.preventDefault();\r\n\tvar zoom = parseFloat($(\"#chainParent\").css(\"zoom\")) || 1.0;\r\n\tvar min = 0.6;\r\n\tvar max = 2.0;\r\n\r\n    if (e.originalEvent.wheelDelta / 120 > 0 && zoom < max) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom + 0.1);\r\n    } else if (e.originalEvent.wheelDelta / 120 < 0 && zoom > min) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom - 0.1);\r\n    }\r\n\r\n\t// Show the reset zoom button for awhile\r\n\t$(\"#chain-zoom-reset\").fadeIn(200);\r\n\tif (this.timeout) clearTimeout(this.timeout);\r\n\tthis.timeout = setTimeout('$(\"#chain-zoom-reset\").fadeOut(200);', 3000);\r\n\r\n\t// Save options\r\n\toptions.chain.zoom = parseFloat($(\"#chainParent\").css(\"zoom\"));\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(\"#chain-zoom-reset\").on(\"click\", function() {\r\n\t$(\"#chainParent\").css(\"zoom\", 1);\r\n\toptions.chain.zoom = 1;\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(document).keydown(function(e)\t{\r\n\t//Abort - user is in input or textarea\r\n\tif ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n\t// Ctrl key hooks\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\r\n\t\tif (e.keyCode === 89 && !$(\"#redo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-y redo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#redo\").click();\r\n\t\t\tNotify.trigger(\"Redoing last undo\");\r\n\t\t} else if (e.keyCode === 90 && !$(\"#undo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-z undo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#undo\").click();\r\n\t\t\tNotify.trigger(\"Undoing last action\");\r\n\t\t} else if (e.keyCode === 65) {\r\n\t\t\t// Ctrl-a select all (signatures) hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#sigTable tbody tr\").addClass(\"selected\");\r\n\t\t\t$(\"#signaturesWidget #delete-signature\").trigger(\"delete:refresh\");\r\n\t\t} else if (e.keyCode === 67) {\r\n\t\t\t// Ctrl-c copy selected signatures hook\r\n\t\t\tif (window.getSelection().toString() === \"\") {\r\n\t\t\t\tvar output = \"\";\r\n\t\t\t\t$(\"#sigTable tbody tr.selected\").each(function(row) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[$(this).data(\"id\")];\r\n\t\t\t\t\tvar row = [];\r\n\r\n\t\t\t\t\tif (signature.signatureID) {\r\n\t\t\t\t\t\trow.push(signature.signatureID.substring(0, 3).toUpperCase() + \"-\" + (signature.signatureID.substring(3, 6) || \"###\"));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(\"null\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.type);\r\n\t\t\t\t\tif (signature.type === \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\trow.push(wormhole.type || \"null\" );\r\n\t\t\t\t\t\trow.push(tripwire.systems[signature.systemID] ? tripwire.systems[signature.systemID].name : tripwire.aSigSystems[signature.systemID]);\r\n\t\t\t\t\t\trow.push(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : tripwire.aSigSystems[otherSignature.systemID]);\r\n\t\t\t\t\t\trow.push(wormhole.life);\r\n\t\t\t\t\t\trow.push(wormhole.mass);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(signature.name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.createdByName);\r\n\t\t\t\t\trow.push(signature.lifeTime);\r\n\t\t\t\t\trow.push(signature.lifeLength);\r\n\t\t\t\t\trow.push(signature.lifeLeft);\r\n\t\t\t\t\trow.push(signature.modifiedByName);\r\n\t\t\t\t\trow.push(signature.modifiedTime);\r\n\t\t\t\t\toutput += row.join(options.signatures.copySeparator) + \"\\r\\n\";\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#clipboard\").text(output);\r\n\t\t\t\t$(\"#clipboard\").focus();\r\n\t\t\t\t$(\"#clipboard\").select();\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// delete key keyhooks\r\n\t\tif (e.keyCode == 46 && $(\"#sigTable tr.selected\").length > 0) {\r\n\t\t\t$(\"#delete-signature\").click();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// $(\"#APIclock\").knob({angleArc: 359.9, height: 20, width: 20, max: 60, readOnly: true, displayInput: false, fgColor: \"#CCC\", bgColor: \"#666\"});\r\n\r\n$(\"#follow\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.follow = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n})\r\n\r\n$(\"#show-viewing\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.viewing = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#show-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.favorites = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#system-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\").attr(\"data-icon\", \"star-empty\");\r\n\r\n\t\toptions.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)), 1);\r\n\t} else {\r\n\t\t$(this).attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\r\n\t\toptions.favorites.push(parseInt(viewingSystemID));\r\n\t}\r\n\r\n\tif ($(\"#show-favorite\").hasClass(\"active\"))\r\n\t\tchain.redraw();\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#search\").click(function(e) {\r\n\t$(\"#searchSpan\").toggle();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName)\r\n\t\t\t$(\"#currentSpan\").show();\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#currentSpan\").hide();\r\n\r\n\t\t$(\"#searchSpan input[name=system]\").focus().select();\r\n\t}\r\n});\r\n\r\n$(\"#toggle-automapper\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t}\r\n\r\n\toptions.buttons.signaturesWidget.autoMapper = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone\", function() {\r\n\tvar characterID =$(this).attr(\"data-characterid\");\r\n\t$(\"#tracking .tracking-clone\").removeClass(\"active\");\r\n\r\n\tif (options.tracking.active == characterID) {\r\n\t\toptions.tracking.active = null;\r\n\t\ttripwire.EVE(false, true);\r\n\t\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\t} else {\r\n\t\toptions.tracking.active = characterID;\r\n\r\n\t\tif (tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ options.tracking.active +\"']\").addClass(\"active\");\r\n\t\t\ttripwire.EVE(tripwire.esi.characters[options.tracking.active], true);\r\n\t\t}\r\n\r\n\t\t$(\"#removeESI\").removeAttr(\"disabled\");\r\n\t}\r\n\r\n\toptions.save();\r\n});\r\n\r\n$(\"#login\").on(\"click\", \"#removeESI\", function() {\r\n\tvar characterID = options.tracking.active;\r\n\r\n\toptions.tracking.active = null;\r\n\ttripwire.EVE(false, true);\r\n\toptions.save();\r\n\r\n\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n\r\n\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\r\n\tif ($.isArray(tripwire.data.esi.delete)) {\r\n\t\ttripwire.data.esiDelete.push(characterID);\r\n\t} else {\r\n\t\ttripwire.data.esiDelete = [characterID];\r\n\t}\r\n});\r\n\r\n$(\"#user\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\r\n\t\t//$(\"#wrapper\").unbind(\"click\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"inline\"});\r\n\t\t$(\"#loginForm input[name=username]\").focus().select();\r\n\r\n\t\t// Click outside closes\r\n\t\t$(\"#wrapper\").click(function(e) {\r\n\t\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\t\t\t$(\"#user\").removeClass(\"active\");\r\n\t\t});\r\n\r\n\t\t$(\"#login\").click(function(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t})\r\n\t}\r\n});\r\n\r\n$(\"#logout\").click(function() {\r\n\twindow.location = \"logout.php\";\r\n});\r\n\r\nvar Notify = new function() {\r\n\tthis.trigger = function(content, color, stick, id) {\r\n\t\tvar color = typeof(color) !== \"undefined\" ? color : \"blue\";\r\n\t\tvar stick = typeof(stick) !== \"undefined\" ? stick : 10000;\r\n\t\tvar id = typeof(id) !== \"undefined\" ? id : null;\r\n\r\n\t\tnew jBox(\"Notice\", {\r\n\t\t\tid: id,\r\n\t\t\tcontent: content,\r\n\t\t\toffset: {y: 35},\r\n\t\t\tanimation: \"flip\",\r\n\t\t\tcolor: color,\r\n\t\t\tautoClose: stick\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Init valdiation tooltips\r\nvar ValidationTooltips = new jBox(\"Tooltip\", {\r\n\ttrigger: null,\r\n\taddClass: \"validation-tooltip\",\r\n\tanimation: \"flip\",\r\n\tfade: 0\r\n});\r\n\r\nvar Tooltips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar SystemActivityToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar nodePos = this.source.closest(\"[data-nodeid]\").position();\r\n\t\tvar parentPos = this.source.closest(\".nodeActivity\").position();\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\r\n\t\tthis.options.position = {x: targetPos.left + 3 - tooltipWidth /2 , y: targetPos.top + this.target[0].offsetHeight};\r\n\t}\r\n});\r\n\r\nvar WormholeRouteToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\t\t\r\n\t\tthis.options.position = {x: targetPos.left + 3 - tooltipWidth /2 , y: targetPos.top + this.target[0].offsetHeight};\r\n\t}\r\n});\r\n\r\nvar WormholeTypeToolTips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"#chainMap .whEffect[data-icon]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"left\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\r\n\t\tthis.options.position = {x: targetPos.left - tooltipWidth - 10, y: targetPos.top - 3};\r\n\t}\r\n});\r\n\r\nvar OccupiedToolTips = new jBox(\"Tooltip\", {\r\n\tpointer: \"top:-3\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tminWidth: 100,\r\n\tanimation: \"move\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\trepositionOnContent: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar tooltip = this;\r\n\t\tconst nodeElemJ = this.source.closest(\"[data-nodeid]\");\r\n\t\tvar systemID = nodeElemJ.data(\"nodeid\");\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\r\n\t\tthis.options.position = {x: targetPos.left + this.target[0].offsetWidth, y: targetPos.top - 3};\r\n\r\n\t\ttooltip.setContent(\"&nbsp;\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"occupants.php\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tdata: \"systemID=\"+systemID,\r\n\t\t\tcache: false\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.occupants) {\r\n\t\t\t\tvar chars = \"<table>\";\r\n\r\n\t\t\t\t// Sort by characterName\r\n\t\t\t\tdata.occupants.sort(function(a, b) {\r\n\t\t\t\t\tif (a.characterName.toLowerCase() < b.characterName.toLowerCase()) return -1;\r\n\t\t\t\t\tif (a.characterName.toLowerCase() > b.characterName.toLowerCase()) return 1;\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (var x in data.occupants) {\r\n\t\t\t\t\tchars += \"<tr><td>\"+data.occupants[x].characterName+\"</td><td style='padding-left: 10px;'>\"+(data.occupants[x].shipTypeName?data.occupants[x].shipTypeName:\"\")+\"</td></tr>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchars += \"</table>\";\r\n\t\t\t\ttooltip.setContent(chars);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").sortable({\r\n\titems: \"> .tab\",\r\n\taxis: \"x\",\r\n\tdelay: 150,\r\n\ttolerance: \"pointer\",\r\n\tcontainment: \"parent\",\r\n\tupdate: function(e, ui) {\r\n\t\tvar result = $(\"#chainTabs\").sortable(\"toArray\");\r\n\t\tvar newTabs = [];\r\n\r\n\t\tfor (var x in result) {\r\n\t\t\tnewTabs.push(options.chain.tabs[result[x]]);\r\n\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t}\r\n\r\n\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\toptions.chain.tabs = newTabs;\r\n\t\toptions.save();\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".tab\", function(e) {\r\n\te.preventDefault();\r\n\tchain.setActiveTab($(this).hasClass(\"current\") ? null : $(this).index())\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".closeTab\", function(e) {\r\n\te.stopPropagation();\r\n\tvar $tab = $(this).closest(\".tab\");\r\n\r\n\t$(\"#dialog-confirm #msg\").html(\"This tab will be removed, are you sure?\");\r\n\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\tbuttons: {\r\n\t\t\t\"Remove Tab\": function() {\r\n\t\t\t\tvar i = $tab.index();\r\n\r\n\t\t\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\t\t\toptions.chain.tabs.splice(i, 1);\r\n\t\t\t\toptions.save();\r\n\r\n\t\t\t\t$tab.remove();\r\n\t\t\t\tif ($(\"#chainTabs .tab.current\").length == 0) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:last\").click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var x = 0, l = $(\"#chainTabs .tab\").length; x < l; x++) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t}\r\n\t}).dialog(\"open\");\r\n});\r\n\r\n$(\"#newTab\").on(\"click\", function() {\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-newTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-newTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#newTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-newTab .name\").val(viewingSystem).focus();\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").val(viewingSystem);\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#newTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tvar name = $(\"#dialog-newTab .name\").val();\r\n\t\t\t\t\tvar systemID = tripwire.getSystemIDsByNames($(\"#dialog-newTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#tabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#tabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .sigSystemsAutocomplete\")}).setContent(\"Must have valid systems (comma separated if multiple)!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#tabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: systemID, name: name, evescout: thera});\r\n\t\t\t\t\toptions.save();\r\n\r\n\t\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-newTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-newTab #tabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-newTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-newTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".editTab\", function(e) {\r\n\te.stopPropagation();\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-editTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-editTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#editTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-editTab .name\").val(options.chain.tabs[options.chain.active].name).focus();\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").val(options.chain.tabs[options.chain.active].systemID != 0 ? lookupMultiple(tripwire.systems, 'name', options.chain.tabs[options.chain.active].systemID) : \"\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].systemID != 0 ? $(\"#dialog-editTab #editTabType1\")[0].checked = true : $(\"#dialog-editTab #editTabType2\")[0].checked = true;\r\n\t\t\t\t$(\"#dialog-editTab #editTabThera\")[0].checked = options.chain.tabs[options.chain.active].evescout;\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#editTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTabs .tab\").eq([options.chain.active]);\r\n\t\t\t\t\tvar name = $(\"#dialog-editTab .name\").val();\r\n\t\t\t\t\tvar systemID = tripwire.getSystemIDsByNames($(\"#dialog-editTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#editTabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#editTabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .sigSystemsAutocomplete\")}).setContent(\"Must have valid systems (comma separated if multiple)!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#editTabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs[options.chain.active] = {systemID: systemID, name: name, evescout: thera};\r\n\t\t\t\t\toptions.save();\r\n\t\t\t\t\tchain.redraw();\r\n\r\n\t\t\t\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\r\n\t\t\t\t\t//$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-editTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-editTab #editTabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-editTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-editTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n// Signature column context menu\r\n$(\"#signaturesWidget #sigTable thead\").contextmenu({\r\n\tdelegate: \"th.sortable\",\r\n\tmenu: \"#signatureColumnMenu\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top\", at: \"center\", of: ui.target};\r\n    },\r\n\tselect: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"leftAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign rightAlign\").addClass(\"leftAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"leftAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"centerAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"leftAlign rightAlign\").addClass(\"centerAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"centerAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign leftAlign\").addClass(\"rightAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"rightAlign\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\toptions.save();\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", \"leftAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"centerAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"rightAlign\", true);\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", options.signatures.alignment[colName], false);\r\n\t}\r\n});\r\n\r\n// Chain Map Context Menu\r\n$(\"#chainParent\").contextmenu({\r\n\tappendTo: \"#chainParent\",\r\n\tdelegate: \".nodeSystem a\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top-1\", at: \"right top\", of: ui.target};\r\n    },\r\n\tmenu: \"#chainMenu\",\r\n\tshow: {effect: \"slideDown\", duration: 150},\r\n\tselect: function(e, ui) {\r\n\t\tconst nodeElem = $(ui.target[0]).closest(\"[data-nodeid]\");\r\n\t\tvar id = nodeElem.data(\"nodeid\");\r\n\t\tvar row = nodeElem.attr(\"id\").replace(\"node\", \"\") -1;\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"showInfo\":\r\n\t\t\t\ttripwire.esi.showInfo(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setDest\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, true);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addWay\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showMap\":\r\n\t\t\t\t// CCPEVE.showMap(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"red\":\r\n\t\t\t\tnodeElem.hasClass(\"redNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yellow\":\r\n\t\t\t\tnodeElem.hasClass(\"yellowNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"green\":\r\n\t\t\t\tnodeElem.hasClass(\"greenNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"mass\":\r\n\t\t\t\t$(\"#dialog-mass\").data(\"id\", nodeElem.data(\"sigid\")).data(\"systemID\", id).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ping\":\r\n\t\t\t\t$(\"#dialog-ping\").data(\"id\", nodeElem.data(\"sigid\") || null).data(\"systemID\", id).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"collapse\":\r\n\t\t\t\tvar toggle = options.chain.tabs[options.chain.active] ? ($.inArray(id, options.chain.tabs[options.chain.active].collapsed) == -1 ? true : false) : true;\r\n\t\t\t\tchain.renderer.collapse(id, toggle);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"makeTab\":\r\n\t\t\t\tconst existingTabIndex = Object.index(options.chain.tabs, 'systemID', '' + id, false);\r\n\t\t\t\tif(undefined !== existingTabIndex) {\r\n\t\t\t\t\tchain.setActiveTab(existingTabIndex);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst systemName = tripwire.systems[id].name;\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: '' + id, name: systemName});\r\n\t\t\t\t\tvar newTab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tnewTab.attr('id', options.chain.tabs.length - 1).find(\".name\").data(\"tab\", id).html(systemName);\r\n\t\t\t\t\t$(\"#chainTabs\").append(newTab);\r\n\t\t\t\t\tchain.setActiveTab(options.chain.tabs.length - 1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar wormholeID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\") || null;\r\n\t\tvar systemID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\t// Add check for k-space\r\n\t\tif (tripwire.systems[systemID].class || !tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t}\r\n\t\t\r\n\t\t// Add check for in-sig\r\n\t\tif (wormholeID) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", true);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", false);\r\n\t\t}\r\n\t\t\r\n\t\t// Add check for tab validity\r\n\t\tconst existingTab = Object.find(options.chain.tabs, 'systemID', '' + systemID, false);\r\n\t\t$('#makeTabMenuItem').text(existingTab ? 'View Tab' : 'Make Tab' );\r\n\t},\r\n\tcreate: function(e, ui) {\r\n\t\t// Fix some bad CSS from jQuery Position\r\n\t\t$(this).find(\".ui-front\").css(\"width\", \"10em\");\r\n\t\t$(this).find(\".ui-front\").css(\"position\", \"\");\r\n\r\n\t\t$(\"#dialog-mass\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\twidth: \"auto\",\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar wormholeID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar wormhole = tripwire.client.wormholes[wormholeID];\r\n\t\t\t\tvar signature = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\tvar otherSignature = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n\t\t\t\t$(\"#dialog-mass\").dialog(\"option\", \"title\", \"From \"+tripwire.systems[signature.systemID].name+\" to \"+tripwire.systems[otherSignature.systemID].name);\r\n\r\n\t\t\t\t$(\"#dialog-mass #massTable tbody tr\").remove();\r\n\r\n\t\t\t\tvar payload = {wormholeID: wormhole.id};\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"mass.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: payload,\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\tif (data && data.mass) {\r\n                        var totalMass = 0;\r\n\t\t\t\t\t\tfor (x in data.mass) {\r\n                            totalMass += parseFloat(data.mass[x].mass);\r\n\t\t\t\t\t\t\t$(\"#dialog-mass #massTable tbody\").append(\"<tr><td>\"+data.mass[x].characterName+\"</td><td>\"+(data.mass[x].toID == systemID ? \"In\" : \"Out\")+\"</td><td>\"+data.mass[x].shipType+\"</td><td>\"+Intl.NumberFormat().format(data.mass[x].mass)+\"Kg</td><td>\"+data.mass[x].time+\"</td></tr>\");\r\n\t\t\t\t\t\t}\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr><td></td><td></td><td></td><th>\"+ Intl.NumberFormat().format(totalMass) +\"Kg</th><td></td></tr>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$.moogle.contextmenu.prototype.setFlare = function(systemID, flare, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID, \"flare\": flare};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\").addClass(flare+\"Node\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.push({systemID: systemID, flare: flare, time: null});\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$.moogle.contextmenu.prototype.removeFlare = function(systemID, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.splice(Object.index(chain.data.flares.flares, \"systemID\", systemID), 1);\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// Used to generate eve-survival guide link\r\nfunction linkSig(sigName) {\r\n\tvar wormholeSignatures = [\r\n\t\t// Ore sites\r\n\t\t\"Average Frontier Deposit\",\r\n\t\t\"Unexceptional Frontier Deposit\",\r\n\t\t\"Common Perimeter Deposit\",\r\n\t\t\"Exceptional Core Deposit\",\r\n\t\t\"Infrequent Core Deposit\",\r\n\t\t\"Unusual Core Deposit\",\r\n\t\t\"Rarified Core Deposit\",\r\n\t\t\"Isolated Core Deposit\",\r\n\t\t\"Ordinary Permiter Deposit\",\r\n\t\t\"Uncommon Core Deposit\",\r\n\r\n\t\t// Gas Sites\r\n\t\t\"Barren Perimeter Reservoir\",\r\n\t\t\"Minor Perimeter Reservoir\",\r\n\t\t\"Ordinary Perimeter Reservoir\",\r\n\t\t\"Sizeable Perimeter Reservoir\",\r\n\t\t\"Token Perimeter Reservoir\",\r\n\t\t\"Bountiful Frontier Reservoir\",\r\n\t\t\"Vast Frontier Reservoir\",\r\n\t\t\"Instrumental Core Reservoir\",\r\n\t\t\"Vital Core Reservoir\",\r\n\r\n\t\t// Class 1\r\n\t\t\"Perimeter Ambush Point\",\r\n\t\t\"Perimeter Camp\",\r\n\t\t\"Phase Catalyst Node\",\r\n\t\t\"The Line\",\r\n\t\t\"Forgotten Perimeter Coronation Platform\",\r\n\t\t\"Forgotten Perimeter Power Array\",\r\n\t\t\"Unsecured Perimeter Amplifier\",\r\n\t\t\"Unsecured Perimeter Information Center\",\r\n\r\n\t\t// Class 2\r\n\t\t\"Perimeter Checkpoint\",\r\n\t\t\"Perimeter Hangar\",\r\n\t\t\"The Ruins of Enclave Cohort 27\",\r\n\t\t\"Sleeper Data Sanctuary\",\r\n\t\t\"Forgotten Perimeter Gateway\",\r\n\t\t\"Forgotten Perimeter Habitation Coils\",\r\n\t\t\"Unsecured Perimeter Comms Relay\",\r\n\t\t\"Unsecured Perimeter Transponder Farm\",\r\n\r\n\t\t// Class 3\r\n\t\t\"Fortification Frontier Stronghold\",\r\n\t\t\"Outpost Frontier Stronghold\",\r\n\t\t\"Solar Cell\",\r\n\t\t\"The Oruze Construct\",\r\n\t\t\"Forgotten Frontier Quarantine Outpost\",\r\n\t\t\"Forgotten Frontier Recursive Depot\",\r\n\t\t\"Unsecured Frontier Database\",\r\n\t\t\"Unsecured Frontier Receiver\",\r\n\r\n\t\t// Class 4\r\n\t\t\"Frontier Barracks\",\r\n\t\t\"Frontier Command Post\",\r\n\t\t\"Integrated Terminus\",\r\n\t\t\"Sleeper Information Sanctum\",\r\n\t\t\"Forgotten Frontier Conversion Module\",\r\n\t\t\"Forgotten Frontier Evacuation Center\",\r\n\t\t\"Unsecured Frontier Digital Nexus\",\r\n\t\t\"Unsecured Frontier Trinary Hub\",\r\n\r\n\t\t// Class 5\r\n\t\t\"Core Garrison\",\r\n\t\t\"Core Stronghold\",\r\n\t\t\"Oruze Osobnyk\",\r\n\t\t\"Quarantine Area\",\r\n\t\t\"Forgotten Core Data Field\",\r\n\t\t\"Forgotten Core Information Pen\",\r\n\t\t\"Unsecured Frontier Enclave Relay\",\r\n\t\t\"Unsecured Frontier Server Bank\",\r\n\r\n\t\t// Class 6\r\n\t\t\"Core Citadel\",\r\n\t\t\"Core Bastion\",\r\n\t\t\"Strange Energy Readings\",\r\n\t\t\"The Mirror\",\r\n\t\t\"Forgotten Core Assembly Hall\",\r\n\t\t\"Forgotten Core Circuitry Disassembler\",\r\n\t\t\"Unsecured Core Backup Array\",\r\n\t\t\"Unsecured Core Emergence\"\r\n\t];\r\n\r\n\tif (wormholeSignatures.indexOf(sigName) > -1) {\r\n\t\treturn '<a href=\"http://eve-survival.org/wikka.php?wakka='+sigName.replace(/ /g, '')+'\" target=\"_blank\" class=\"siteLink\">'+sigName+'</a>';\r\n\t}\r\n\r\n\treturn sigName;\r\n}\r\n\r\n// Custom inlinecomplete + dropdown input\r\n$.widget(\"custom.inlinecomplete\", $.ui.autocomplete, {\r\n\t_create: function() {\r\n\t\tif (!this.element.is(\"input\")) {\r\n\t\t\tthis._selectInit();\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super();\r\n\t},\r\n\t_value: function() {\r\n\t\t// Invoke the parent function\r\n\t\tvar originalReturn = this._superApply(arguments);\r\n\r\n\t\tthis.element.change();\r\n\r\n\t\treturn originalReturn;\r\n\t},\r\n\t_suggest: function(items) {\r\n\t\t// if (this.element.val() != items[0].value) {\r\n\t\t\t// this.element.val(items[0].value.substr(0, this.element.val().length));\r\n\t\t// }\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(items);\r\n\t},\r\n\t_initSource: function() {\r\n\t\tif ($.isArray(this.options.source)) {\r\n\t\t\tthis.source = function(request, response) {\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + $.ui.autocomplete.escapeRegex(request.term), \"i\");\r\n\t\t\t\tvar results = new Array(); // results array\r\n\t\t\t\tvar data = this.options.source;\r\n\t\t\t\tvar maxSize = this.options.maxSize || 25; // maximum result size\r\n\t\t\t\t// simple loop for the options\r\n\t\t\t\tfor (var i = 0, l = data.length; i < l; i++) {\r\n\t\t\t\t\tif (matcher.test(data[i])) {\r\n\t\t\t\t\t\tresults.push(data[i]);\r\n\r\n\t\t\t\t\t\tif (maxSize && results.length > maxSize) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t // send response\r\n\t\t\t\t response(results);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Invoke the parent function\r\n\t\t\treturn this._super();\r\n\t\t}\r\n\t},\r\n\t_close: function(event) {\r\n\t\tthis.options.source = this.options.input_source ? this.options.input_source : this.options.source;\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(event);\r\n\t},\r\n\taddToSelect: function(value) {\r\n\t\tthis.options.select_added_value = value;\r\n\t\tthis.options.select_source.unshift(value);\r\n\t},\r\n\tremoveFromSelect: function(value) {\r\n\t\tif (value) {\r\n\t\t\tthis.options.select_source.splice(value, 1);\r\n\t\t} else if (this.options.select_added_value) {\r\n\t\t\tthis.options.select_source.splice(this.options.select_added_value, 1);\r\n\t\t}\r\n\t\tthis.options.select_added_value = null;\r\n\t},\r\n\t_selectInit: function() {\r\n\t\tthis.element.addClass(\"custom-combobox\");\r\n\t\tthis.wrapper = this.element;\r\n\t\tthis.element = this.wrapper.find(\"input:first\");\r\n\t\tthis.select = this.wrapper.find(\"select:first\").remove();\r\n\r\n\t\tthis.options.input_source = this.options.source;\r\n\t\tthis.options.select_source = this.select.children(\"option[value!='']\").map(function() {\r\n            return $.trim(this.text);\r\n        }).toArray();\r\n\r\n\t\tthis._createShowAllButton();\r\n\t},\r\n\t_createShowAllButton: function() {\r\n        var that = this,\r\n          wasOpen = false;\r\n\r\n        $(\"<a>\")\r\n\t\t\t.attr(\"tabIndex\", that.element.prop(\"tabindex\"))\r\n\t\t\t.attr(\"title\", \"\")\r\n\t\t\t.appendTo(that.wrapper)\r\n\t\t\t.button({icons: {primary: \"ui-icon-triangle-1-s\"}, text: false})\r\n\t\t\t.removeClass(\"ui-corner-all\")\r\n\t\t\t.addClass(\"custom-combobox-toggle ui-corner-right\")\r\n\t\t\t.on(\"mousedown\", function() {\r\n\t\t\t\twasOpen = that.widget().is(\":visible\");\r\n\t\t\t})\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\tthat.element.trigger(\"focus\");\r\n\r\n\t\t\t\t// Close if already visible\r\n\t\t\t\tif (wasOpen) {\r\n\t\t\t\t  return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass empty string as value to search for, displaying all results\r\n\t\t\t\tthat.options.source = that.options.select_source;\r\n\t\t\t\tthat._search(\"\");\r\n\t\t\t});\r\n\t},\r\n});\r\n\r\n// Initialize tablesorter plugin on signaturesWidget table\r\n$(\"#sigTable\").tablesorter({\r\n\tsortReset: true,\r\n\twidgets: ['saveSort'],\r\n\ttextExtraction: {\r\n\t\t2: function(node) { return $(node).find(\"span\").data(\"age\"); }\r\n\t}\r\n});\r\n\r\n// Highlight signaturesWidget tr on click\r\n$(\"#sigTable tbody\").on(\"click\", \"tr\", function(e) {\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\t\t// ctrl or cmd key\r\n\t\t$(this).toggleClass(\"selected\");\r\n\t} else if (e.shiftKey) {\r\n\t\t// shift key\r\n\t\t$(this).addClass(\"selected\");\r\n\t\t$(\"#sigTable tbody tr.selected:first\").nextUntil(\"#sigTable tbody tr.selected:last\").addBack().add(\"#sigTable tbody tr.selected:last\").addClass(\"selected\");\r\n\t} else {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n\t\t$(this).addClass(\"selected\");\r\n\t}\r\n});\r\n\r\n// Un-Highlight signaturesWidget tr on clicking outside\r\n$(document).click(function(e) {\r\n    if(!$(e.target).closest('#sigTable tbody').length && !$(e.target).closest('#edit-signature').length && !$(e.target).closest('#delete-signature').length) {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n    }\r\n});\r\n\r\n// Monitor custom 'classchange' event\r\n$(\"#sigTable tbody\").on(\"classchange\", \"tr\", function(e, className) {\r\n\t// Trigger signaturesWidget selected row change custom event\r\n\tif (className === \"selected\") {\r\n\t\t$(\"#signaturesWidget\").trigger(\"selected:change\");\r\n\t}\r\n});\r\n\r\n// Update signaturesWidget based on .selected rows change\r\n$(\"#signaturesWidget\").on(\"selected:change\", function() {\r\n\t// Enable/Disable delete icon\r\n\tif ($(\"#sigTable tr.selected\").length === 0) {\r\n\t\t$(\"#signaturesWidget #delete-signature\").addClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n\t}\r\n\r\n\t// Enable/Disable edit icon\r\n\tif ($(\"#sigTable tr.selected\").length === 1) {\r\n\t\t$(\"#signaturesWidget #edit-signature\").removeClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #edit-signature\").addClass(\"disabled\");\r\n\t}\r\n})\r\n\r\n$(\"#dialog-error\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t},\r\n\tcreate: function() {\r\n\t\t$(this).dialog(\"option\", \"show\", {effect: \"shake\", duration: 150, easing: \"easeOutElastic\"});\r\n\t}\r\n});\r\n\r\n$(\"#dialog-msg\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#dialog-confirm\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tCancel: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\nif (window.location.href.indexOf(\"galileo\") != -1) {\r\n\tNotify.trigger(\"This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>\")\r\n}\r\n","const systemAnalysis = new function() {\r\n\tconst mutators = [];\r\n\tthis.addMutator = function(m) { mutators.push(m); }\r\n\t\r\n\t/** Extract attributes of the system, and allow mutators to add/modify them.\r\n\t\tOptionally, pass in a system object */\r\n\tthis.analyse = function(systemID, system) {\r\n\t\tif(!system) { system = tripwire.systems[systemID]; }\r\n\t\tif(!system) { return system; }\r\n\t\tconst r = Object.assign({}, system);\r\n\t\t\r\n\t\t// Defaults or saved original values\r\n\t\tr.baseSecurity = 1 * system.security;\r\n\t\tr.pathSymbol = '■';\r\n\t\tr.systemTypeModifiers = [];\t\t\r\n\t\t\r\n\t\tmutators.forEach(function(m) { m.mutate(r, systemID); });\r\n\t\t\r\n\t\t// Calculated final values\r\n\t\tr.systemTypeClass = r.class ? 'wh class-' + r.class :\r\n\t\t\tr.factionID == 500026 ? 'triglavian' :\r\n\t\t\tr.security >= 0.45 ? 'hisec' :\r\n\t\t\tr.security > 0.0 ? 'lowsec' :\r\n\t\t\tr.security <= 0.0 ? 'nullsec' :\r\n\t\t\t'unknown';\r\n\t\tr.systemTypeName = r.class ? 'C' + r.class :\r\n\t\t\tr.factionID == 500026 ? 'Trig' :\r\n\t\t\tr.baseSecurity >= 0.45 ? 'HS' :\r\n\t\t\tr.baseSecurity > 0.0 ? 'LS' :\r\n\t\t\tr.baseSecurity <= 0.0 ? 'NS' :\r\n\t\t\t' ';\r\n\t\t\t\r\n\t\treturn r;\r\n\t};\r\n\r\n}","var guidance = (function (undefined) {\r\n\r\n\tvar extractKeys = function (obj) {\r\n\t\tvar keys = [];\r\n\r\n\t\tfor (var key in obj) {\r\n\t\t    Object.prototype.hasOwnProperty.call(obj,key) && keys.push(key);\r\n\t\t}\r\n\r\n\t\treturn keys;\r\n\t}\r\n\r\n\tvar sorter = function (a, b) {\r\n\t\treturn parseFloat (a) - parseFloat (b);\r\n\t}\r\n\r\n\tfunction adjustCostForOptions(mapCost, system) {\r\n\t\tvar system = systemAnalysis.analyse(30000000 + 1 * system);\r\n\t\tif(!system) { return mapCost; }\r\n\t\tif(options.chain.routeIgnore.enabled && options.chain.routeIgnore.systems.indexOf(system.name) >= 0) {\r\n\t\t\tmapCost += 100;\t// Penalty for an avoided system\r\n\t\t}\r\n\t\tswitch(options.chain.routeSecurity) {\r\n\t\t\tcase 'highsec': return mapCost + (system.security < 0.45 ? 100 : 0);\r\n\t\t\tcase 'avoid-high': return mapCost + (system.security >= 0.45 ? 100 : 0);\r\n\t\t\tcase 'avoid-null': return mapCost + (system.security <= 0.0 ? 100 : 0);\r\n\t\t\tdefault: return mapCost;\t// in case of some invalid option, default to shortest\r\n\t\t}\r\n\t}\r\n\r\n\tvar findPaths = function (map, start, end, infinity) {\r\n\t\tif(!(map[start] && map[end])) { return null; }\t// both ends of path must be in network somewhere\r\n\t\t\r\n\t\tinfinity = infinity || Infinity;\r\n\r\n\t\tvar costs = {},\r\n\t\t    open = {'0': [start]},\r\n\t\t    predecessors = {},\r\n\t\t    keys;\r\n\r\n\t\tvar addToOpen = function (cost, vertex) {\r\n\t\t\tvar key = \"\" + cost;\r\n\t\t\tif (!open[key]) open[key] = [];\r\n\t\t\topen[key].push(vertex);\r\n\t\t}\r\n\r\n\t\tcosts[start] = 0;\r\n\r\n\t\twhile (open && !costs[end]) {\r\n\t\t\tif(!(keys = extractKeys(open)).length) break;\r\n\r\n\t\t\tkeys.sort(sorter);\r\n\r\n\t\t\tvar key = keys[0],\r\n\t\t\t    bucket = open[key],\r\n\t\t\t    node = bucket.shift(),\r\n\t\t\t    currentCost = parseFloat(key),\r\n\t\t\t    adjacentNodes = map[node] || {};\r\n\r\n\t\t\tif (!bucket.length) delete open[key];\r\n\r\n\t\t\tfor (var vertex in adjacentNodes) {\r\n\t\t\t    if (Object.prototype.hasOwnProperty.call(adjacentNodes, vertex)) {\r\n\t\t\t\t\tvar cost = adjustCostForOptions(adjacentNodes[vertex], vertex),\r\n\t\t\t\t\t    totalCost = cost + currentCost,\r\n\t\t\t\t\t    vertexCost = costs[vertex];\r\n\r\n\t\t\t\t\tif ((vertexCost === undefined) || (vertexCost > totalCost)) {\r\n\t\t\t\t\t\tcosts[vertex] = totalCost;\r\n\t\t\t\t\t\taddToOpen(totalCost, vertex);\r\n\t\t\t\t\t\tpredecessors[vertex] = node;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (costs[end] === undefined) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn predecessors;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar extractShortest = function (predecessors, end) {\r\n\t\tvar nodes = [],\r\n\t\t    u = end;\r\n\r\n\t\twhile (u) {\r\n\t\t\tnodes.push(u);\r\n\t\t\tpredecessor = predecessors[u];\r\n\t\t\tu = predecessors[u];\r\n\t\t}\r\n\r\n\t\tnodes.reverse();\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tvar findShortestPath = function (map, nodes) {\r\n\t\tvar start = nodes.shift(),\r\n\t\t    end,\r\n\t\t    predecessors,\r\n\t\t    path = [],\r\n\t\t    shortest;\r\n\r\n\t\twhile (nodes.length) {\r\n\t\t\tend = nodes.shift();\r\n\t\t\tpredecessors = findPaths(map, start, end);\r\n\r\n\t\t\tif (predecessors) {\r\n\t\t\t\tshortest = extractShortest(predecessors, end);\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tpath.push.apply(path, shortest.slice(0, -1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn path.concat(shortest);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar Guidance = { kSpaceCache: {} };\r\n\tGuidance.clearCache = function() { Guidance.kSpaceCache = {}; }\r\n\t\r\n\tGuidance.findShortestPath = function (map, start, end) {\r\n\t\tconst nodes = [start, end];\r\n\r\n\t\tconst cacheKey = nodes.join(',');\r\n\t\tconst cachedPath = Guidance.kSpaceCache[cacheKey];\r\n\t\tif(cachedPath === undefined) {\r\n\t\t\treturn Guidance.kSpaceCache[cacheKey] = findShortestPath(map, nodes);\r\n\t\t} else {\r\n\t\t\treturn cachedPath;\r\n\t\t}\r\n\t}\r\n\r\n\treturn Guidance;\r\n})();\r\n","const ChainMapRendererOrgchart = function(owner) {\r\n\tconst _this = this;\r\n\t\r\n\t/** Initialiser - callback from chart onload */\r\n\tthis.init = function() {\r\n\t\t_this.map = new google.visualization.OrgChart(document.getElementById(\"chainMap\"));\r\n\t\t_this.options = {allowHtml: true, allowCollapse: true, size: \"medium\", nodeClass: \"node\"};\r\n\r\n\t\tgoogle.visualization.events.addListener(_this.map, \"collapse\", _this.collapseHandler);\r\n\r\n\t\t_this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), _this.options);\r\n\t}\r\n\t\r\n\t/** Is this renderer ready to accept draw calls? */\r\n\tthis.ready = function() { return !this.drawing && !!this.map; }\r\n\t\r\n\t/** Switch to this renderer. The renderer can be in a blank state; draw() will be called after */\r\n\tthis.switchTo = function() {\r\n\t\tdocument.getElementById('chainGrid').style.display = '';\r\n\t\tif(!_this.map) { google.charts.setOnLoadCallback(this.init); }\r\n\t}\r\n\t\r\n\t/** Switch away from this renderer. All node divs should be removed from the DOM */\r\n\tthis.switchFrom = function() {\r\n\t\tdocument.getElementById('chainGrid').style.display = 'none';\r\n\t\t_this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), _this.options);\t\t\r\n\t}\r\n\t\r\n\t/** Redraw the map, based on the given node set, line overrides and list of collapsed systems */\r\n\tthis.draw = function(map, lines, collapsed) {\r\n\t\tthis.drawing = true;\r\n\t\tthis.map.draw(newView(map), this.options); \r\n\t\t\r\n\t\tfor (var x in collapsed) {\r\n\t\t\tconst s = collapsed[x];\r\n\t\t\tconst nodeId = $(\"#chainMap [data-nodeid='\"+s+\"']\").attr(\"id\");\r\n\t\t\tif (nodeId) {\r\n\t\t\t\tconst nodeVal = nodeId.split(\"node\")[1];\r\n\t\t\t\tthis.map.collapse(nodeVal - 1, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tupdateLines(map, lines);\r\n\t\tthis.drawing = false;\r\n\t};\r\n\t\r\n\tconst newView = function(json) {\r\n\t\tconst view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\treturn view;\r\n\t};\r\n\t\r\n\tconst updateLines = function(map, lines) {\r\n\t\t_this.lastLineData = { map: map, lines: lines };\r\n\t\tfunction drawNodeLine(system, parent, mode, signatureID) {\r\n\t\t\t/*\tfunction for drawing colored lines  */\r\n\t\t\tif(typeof mode == 'string') { mode = [mode]; }\r\n\r\n\t\t\tfunction addModes(jquerySelector, prefixes) { return doModeClasses(jquerySelector, prefixes, function(s, c) { s.addClass(c); }); }\r\n\t\t\tfunction removeModes(jquerySelector, prefixes) { return doModeClasses(jquerySelector, prefixes, function(s, c) { s.removeClass(c); }); }\r\n\t\t\tfunction doModeClasses(jquerySelector, prefixes, classFunc) {\r\n\t\t\t\tprefixes = prefixes || [];\r\n\t\t\t\tprefixes.push('');\r\n\t\t\t\tprefixes.forEach(function(prefix) { \r\n\t\t\t\t\tmode.forEach( function(mode) { classFunc(jquerySelector, (prefix.length ? prefix + '-' : '') + mode); });\r\n\t\t\t\t});\r\n\t\t\t\treturn jquerySelector;\r\n\t\t\t}\r\n\r\n\t\t\t// Find node in chainmap\r\n\t\t\t//var $node = $(\"#chainMap [data-nodeid='\"+system+\"']\").parent();\r\n\t\t\tvar $node = $(\"#chainMap #node\"+system).parent();\r\n\r\n\t\t\tif ($node.length == 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar nodeIndex = Math.ceil(($node[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// applly to my top line\r\n\t\t\tvar $connector = addModes($($node.parent().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[nodeIndex]), [ 'left', 'right' ]);\r\n\r\n\t\t\t// Find parent node\r\n\t\t\t//var $parent = $(\"#chainMap [data-nodeid='\"+parent+\"']\").parent();\r\n\t\t\tvar $parent = $(\"#chainMap #node\"+parent).parent();\r\n\r\n\t\t\tif ($parent.length == 0 || $connector.length == 0)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Find the col of my top line\r\n\t\t\tvar nodeCol = 0, connectorCell = $connector[0].cellIndex;\r\n\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\tnodeCol += this.colSpan;\r\n\r\n\t\t\t\tif (index == connectorCell) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar parentIndex = Math.ceil(($parent[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// Compensate for non-parent nodes (slight performance hit ~10ms)\r\n\t\t\tvar newparentIndex = parentIndex;\r\n\t\t\tfor (var i = 0; i <= parentIndex; i++) {\r\n\t\t\t\tvar checkSystem = 0;//$node.parent().prev().prev().prev().find(\"td:has([data-nodeid]):eq(\"+i+\")\").find(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\t\t\t$node.parent().prev().prev().prev().find(\"td > [data-nodeid]\").each(function(index) {\r\n\t\t\t\t\tif (index == i) {\r\n\t\t\t\t\t\tcheckSystem = $(this).attr(\"id\").replace(\"node\", \"\");//$(this).data(\"nodeid\");\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ($.map(map.rows, function(node) { return node.c[1].v == checkSystem ? node : null; }).length <= 0) {\r\n\t\t\t\t\tnewparentIndex--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex = newparentIndex;\r\n\r\n\t\t\t// Apply to parent bottom line\r\n\t\t\tvar $connecte = addModes($($node.parent().prev().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[parentIndex]), [ 'left', 'right'] );\r\n\r\n\t\t\t// the beans\r\n\t\t\tvar col = 0, parent = false, me = false;\r\n\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index, value) {\r\n\t\t\t\tcol += this.colSpan;\r\n\r\n\t\t\t\tif (me && parent) {\r\n\t\t\t\t\t// All done - get outta here\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else if (typeof($connecte[0]) != \"undefined\" && $connecte[0].cellIndex == index) {\r\n\t\t\t\t\tparent = true;\r\n\r\n\t\t\t\t\taddModes($(this), ['left']);\r\n\r\n\t\t\t\t\t// remove bottom border that points to the right\r\n\t\t\t\t\tif (!me && col != nodeCol) {\r\n\t\t\t\t\t\taddModes($(this), ['bottom']);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// parent and node are same - we are done\r\n\t\t\t\t\tif (nodeCol == col) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (col == nodeCol) {\r\n\t\t\t\t\tme = true;\r\n\r\n\t\t\t\t\taddModes($(this), [ 'bottom' ]);\r\n\t\t\t\t} else if (me || parent) {\r\n\t\t\t\t\tvar tempCol = 0, breaker = false, skip = false;\r\n\r\n\t\t\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\ttempCol += this.colSpan;\r\n\r\n\t\t\t\t\t\tif (tempCol == col && ($(this).hasClass(\"google-visualization-orgchart-lineleft\") || $(this).hasClass(\"google-visualization-orgchart-lineright\"))) {\r\n\t\t\t\t\t\t\tif (parent == false) {\r\n\t\t\t\t\t\t\t\t// Stop looking cuz there is another node between us and parent\r\n\t\t\t\t\t\t\t\tbreaker = true;\r\n\t\t\t\t\t\t\t\tremoveModes($connecte, [ 'left', 'right' ]);\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t} else if (parent == true) {\r\n\t\t\t\t\t\t\t\t// Lets make sure there isnt a node between the parent and me\r\n\t\t\t\t\t\t\t\tremoveModes($connecte, [ 'left', 'right' ]);\r\n\r\n\t\t\t\t\t\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\t\t\t\tif (index >= $connecte[0].cellIndex) {\r\n\t\t\t\t\t\t\t\t\t\t// there is a node after parent but before me\r\n\t\t\t\t\t\t\t\t\t\tremoveModes($(this), [ 'bottom' ]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tskip = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (breaker) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!skip) {\r\n\t\t\t\t\t\taddModes($(this), ['bottom'] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var x in lines) {\r\n\t\t\tdrawNodeLine(lines[x][0], lines[x][1], lines[x][2], lines[x][3]);\r\n\t\t}\r\n\t};\r\n\r\n\tthis.collapseHandler = function() {\t\t\r\n\t\tif(_this.drawing) { return; }\r\n\t\t\r\n\t\tconst collapsed = _this.map.getCollapsedNodes();\r\n\t\tconst collapsedSystems = [];\r\n\t\tfor (x in collapsed) {\r\n\t\t\tvar systemID = $(\"#chainMap #node\"+(collapsed[x] +1)).data(\"nodeid\");\r\n\t\t\tcollapsedSystems.push(systemID);\r\n\t\t}\r\n\t\towner.updateCollapsed(collapsedSystems);\r\n\t\t\r\n\t\tif(_this.lastLineData) { updateLines(_this.lastLineData.map, _this.lastLineData.lines); }\r\n\t}\r\n\r\n\r\n};","const ChainMapRendererRadial = function(owner) {\r\n\t/** Is this renderer ready to accept draw calls? */\r\n\tthis.ready = function() { return !this.drawing; }\r\n\t\r\n\t/** Switch to this renderer. The renderer can be in a blank state; draw() will be called after */\r\n\tthis.switchTo = function() {\r\n\t\tif(!document.getElementById('map-container')) {\r\n\t\t\tconst newDiv = document.createElement('div');\r\n\t\t\tnewDiv.id = 'map-container';\r\n\t\t\tnewDiv.className = 'radial-map';\r\n\t\t\tdocument.getElementById('chainMap').appendChild(newDiv);\r\n\t\t}\r\n\t\tthis.container = document.getElementById('map-container');\r\n\t\tthis.container.style.display = '';\r\n\t}\r\n\t\r\n\t/** Switch away from this renderer. All node divs should be removed from the DOM */\r\n\tthis.switchFrom = function() {\r\n\t\tconst div = document.getElementById('map-container');\r\n\t\tif(div) { div.parentNode.removeChild(div); }\r\n\t\tthis.container = null;\r\n\t}\r\n\t\r\n\tthis.collapse = function(systemID, collapse) {\r\n\t\tif(collapse) { this.mapData.collapsed.push(systemID); }\r\n\t\telse {  this.mapData.collapsed = this.mapData.collapsed.filter(x => x != systemID); }\r\n\t\towner.updateCollapsed(this.mapData.collapsed);\r\n\t\tdrawInner(this.mapData.map, this.mapData.lines, this.mapData.collapsed);\r\n\t}\r\n\t\r\n\t/** Redraw the map, based on the given node set, line overrides and list of collapsed systems */\r\n\tthis.draw = function(map, lines, collapsed) {\r\n\t\tthis.drawing = true;\r\n\t\tthis.mapData = {map: map, lines: lines, collapsed: collapsed};\r\n\t\t\r\n\t\t// Clear the map for a new one\r\n\t\t//this.switchFrom(); this.switchTo();\r\n\r\n\t\ttry { drawInner(map, lines, collapsed); }\r\n\t\tfinally { this.drawing = false; }\r\n\t}\r\n\t\r\n\tconst CIRCLE_SIZE = { x: 70, y: 60, first_ring_delta: 0.3,\r\n\t\tringX: function(ci) { return ci == 0 ? 0 : (ci + this.first_ring_delta) * this.x},\r\n\t\tringY: function(ci) { return ci == 0 ? 0 : (ci + this.first_ring_delta) * this.y},\r\n\t };\r\n\r\n\tconst _this = this;\r\n\tconst drawInner = function(map, lines, collapsed) {\r\n\t\tconst maps = [];\r\n\t\tconst nodesById = {};\r\n\t\t\r\n\t\t// First pass: arrange nodes into rings\r\n\t\tfor(var ri = 0; ri < map.rows.length; ri++) {\r\n\t\t\tconst item = map.rows[ri];\r\n\t\t\tconst inNode = item.c[0], id = inNode.v, parent = item.c[1].v;\r\n\t\t\t\r\n\t\t\tconst mapNode = { id: id, children: [], systemID: inNode.systemID, minArc: 0 };\r\n\t\t\t\r\n\t\t\tif(parent == null) {\r\n\t\t\t\tconst newMap =  { circles: [ { arc: 0, nodes: [ mapNode ] } ] };\r\n\t\t\t\tmapNode.map = newMap;\r\n\t\t\t\tmapNode.circle = 0;\r\n\t\t\t\tmaps.push(newMap);\r\n\t\t\t} else {\r\n\t\t\t\tconst parentNode = nodesById[parent];\r\n\t\t\t\tif(!parentNode) { throw 'Parent id ' + parent + ' not on map yet'; }\r\n\t\t\t\tparentNode.children.push(mapNode);\r\n\t\t\t\tmapNode.parent = parentNode;\r\n\t\t\t\tmapNode.connection = lines.filter(function(l) { return l[0] == id; })[0] || [id, parent, [], '?'];\r\n\t\t\t\tmapNode.connection[2].unshift('connection');\r\n\t\t\t\tmapNode.map = parentNode.map;\r\n\t\t\t\tmapNode.circle = parentNode.circle + 1;\r\n\t\t\t\tif(mapNode.map.circles.length <= mapNode.circle) {\r\n\t\t\t\t\tmapNode.map.circles.push({ arc: 0, nodes:[mapNode] });\r\n\t\t\t\t} else { mapNode.map.circles[mapNode.circle].nodes.push(mapNode); }\r\n\t\t\t}\r\n\t\t\tnodesById[id] = mapNode;\r\n\t\t\tmapNode.markup = inNode.f;\r\n\t\t}\r\n\r\n\t\t// Second pass - for each map, find the allocation of arc needed for each node\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tfor(var ci = map.circles.length - 1; ci >= 1; ci--) {\t// don't need to calculate ring 0\r\n\t\t\t\tfor(var ni = 0; ni < map.circles[ci].nodes.length; ni++) {\r\n\t\t\t\t\tconst node = map.circles[ci].nodes[ni];\r\n\t\t\t\t\tnode.minArc *= ci / (ci + 1.0);\r\n\t\t\t\t\tif(node.minArc < 1 || collapsed.indexOf(node.systemID * 1) >= 0) { node.minArc = 1; }\r\n\t\t\t\t\tnode.parent.minArc += node.minArc;\r\n\t\t\t\t\tmap.circles[ci].arc += node.minArc;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Third pass - lay out each ring based on the arc values\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tvar mapDiv = document.getElementById(\"map\" + mi);\r\n\t\t\tif(!mapDiv) {\r\n\t\t\t\tmapDiv = document.createElement('div');\r\n\t\t\t\tmapDiv.id = \"map\" + mi;\r\n\t\t\t\tmapDiv.className = \"map-chain-wrapper\";\r\n\t\t\t}\r\n\t\t\tmapDiv.innerHTML = '<div class=\"map-outer-container\"><div class=\"map-inner-container\"><canvas class=\"map-drawing\" id=\"map-canvas-' + mi + '\"/></div></div>';\r\n\t\t\tconst innerContainer = mapDiv.firstChild.firstChild;\r\n\t\t\tdocument.getElementById('map-container').appendChild(mapDiv);\r\n\r\n\t\t\tmap.bounds = makeDivsForRing(innerContainer, 0, map.circles[0].nodes, 0, Math.PI * 2, collapsed);\r\n\t\t\tmap.domNode = mapDiv;\r\n\t\t\tmap.innerContainer = innerContainer;\r\n\t\t}\r\n\r\n\t\t// Fourth pass: update div and canvas bounds, and draw rings/links\r\n\t\tconst CANVAS_SCALE = 1;\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tconst finalPositions = {\r\n\t\t\t\tw: 200 + map.bounds.x[1] - map.bounds.x[0],\r\n\t\t\t\th: 100 + map.bounds.y[1] - map.bounds.y[0],\r\n\t\t\t\tcx: 100 - map.bounds.x[0],\r\n\t\t\t\tcy: 50 - map.bounds.y[0]\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Fill the space available, if we didn't already\r\n\t\t\tif(maps.length == 1) {\r\n\t\t\t\tconst parentWidth = -38 + _this.container.offsetWidth;\t// 20px for map margins, 18 for scrollbar\r\n\t\t\t\tif(finalPositions.w < parentWidth) {\r\n\t\t\t\t\tfinalPositions.cx += 0.5 * (parentWidth - finalPositions.w);\r\n\t\t\t\t\tfinalPositions.w = parentWidth;\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t\tconst parentHeight = document.getElementById('chainParent').offsetHeight;\r\n\t\t\tif(finalPositions.h < parentHeight) {\r\n\t\t\t\tfinalPositions.cy += 0.5 * (parentHeight - finalPositions.h);\r\n\t\t\t\tfinalPositions.h = parentHeight;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// If there's enough space to centre the top level node now, do it\r\n\t\t\tif(finalPositions.h >= 2 * (map.bounds.y[1] > -map.bounds.y[0] ? map.bounds.y[1] : -map.bounds.y[0])) {\r\n\t\t\t\tfinalPositions.cy = finalPositions.h / 2;\r\n\t\t\t}\r\n\t\t\tif(finalPositions.w >= 2 * (map.bounds.x[1] > -map.bounds.x[0] ? map.bounds.x[1] : -map.bounds.x[0])) {\r\n\t\t\t\tfinalPositions.cx = finalPositions.w / 2;\r\n\t\t\t}\t\t\t\r\n\t\t\tmap.domNode.style.width = finalPositions.w + 'px';\r\n\t\t\tmap.domNode.style.height = finalPositions.h + 'px';\r\n\t\t\tconst outerContainer = map.domNode.firstChild;\r\n\t\t\touterContainer.style.left = finalPositions.cx + 'px';\r\n\t\t\touterContainer.style.top = finalPositions.cy + 'px';\r\n\t\t\tconst canvas = outerContainer.getElementsByTagName('canvas')[0];\r\n\t\t\tcanvas.width = CANVAS_SCALE * finalPositions.w;\r\n\t\t\tcanvas.style.width = finalPositions.w + 'px';\r\n\t\t\tcanvas.height = CANVAS_SCALE * finalPositions.h;\r\n\t\t\tcanvas.style.height = finalPositions.h + 'px';\r\n\t\t\tcanvas.style.left = -finalPositions.cx + 'px';\r\n\t\t\tcanvas.style.top = -finalPositions.cy + 'px';\r\n\t\t\tconst ctx = canvas.getContext('2d');\r\n\t\t\tctx.scale(CANVAS_SCALE, CANVAS_SCALE);\r\n\t\t\tctx.translate(finalPositions.cx, finalPositions.cy);\r\n\t\t\t\t\r\n\t\t\tfor(var ci = map.bounds.maxCi; ci >= 1; ci--) {\t// don't need to draw ring 0\r\n\t\t\t\tif(options.chain.gridlines) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tif(ctx.ellipse) {\r\n\t\t\t\t\t\tctx.lineWidth = 0.5;\r\n\t\t\t\t\t\tctx.setLineDash([]);\r\n\t\t\t\t\t\tctx.ellipse(0, 0, CIRCLE_SIZE.ringX(ci), CIRCLE_SIZE.ringY(ci), 0, 0, Math.PI * 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tctx.strokeStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\t\t\t\tctx.stroke();\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif(ci >= map.circles.length) { continue; }\r\n\t\t\t\t\r\n\t\t\t\tfor(var ni = 0; ni < map.circles[ci].nodes.length; ni++) {\r\n\t\t\t\t\tconst node = map.circles[ci].nodes[ni];\r\n\t\t\t\t\tif(!node.position) { continue; }\t// not drawn on map\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.lineWidth = node.connection[2].reduce(function(w, c) { return c == 'frig' ? 1 : w; }, 3);\r\n\t\t\t\t\tctx.moveTo(node.position.x, node.position.y);\r\n\t\t\t\t\tconst cp1 = radToCartesian({ r: node.radPosition.r - 0.5, theta: (node.radPosition.theta + 2 * node.parent.radPosition.theta) / 3.0 });\r\n\t\t\t\t\tconst cp2 = radToCartesian({ r: node.radPosition.r - 0.5, theta: (2 * node.radPosition.theta + node.parent.radPosition.theta) / 3.0 });\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(ci > 1) {\t\t\t\t\r\n\t\t\t\t\t\tctx.bezierCurveTo(cp2.x, cp2.y, cp1.x, cp1.y, node.parent.position.x, node.parent.position.y);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctx.lineTo(node.parent.position.x, node.parent.position.y);\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst dist2 = (node.position.y - node.parent.position);\r\n\t\t\t\t\tctx.strokeStyle = propertyFromCssClass(node.connection[2], 'border-top-color');\r\n\t\t\t\t\tctx.setLineDash ({ dashed: [3, 2] }[propertyFromCssClass(node.connection[2], 'border-top-style')] || []);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t}\r\n\t\t\r\n\t\t// Remove any maps which aren't in use any more\r\n\t\tfor(var mi = maps.length; ; mi++) {\r\n\t\t\tconst div = document.getElementById('map' + mi);\r\n\t\t\tif(div) { div.parentNode.removeChild(div); }\r\n\t\t\telse { break; }\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction makeDivsForRing(innerContainer, ci, nodes, minRad, maxRad, collapsed) {\r\n\t\tconst bounds = { x: [0, 0], y: [0, 0], maxCi: ci };\r\n\t\tif(!nodes.length) { return bounds; }\r\n\t\tconst parentCollapsed = collapsed.indexOf(1 * (nodes[0].parent || {}).systemID) >= 0;\r\n\t\tconst max_nodes_per_rad = 1.4;\r\n\t\tif(ci > 0 && !parentCollapsed) {\r\n\t\t\tvar skipped = 0;\r\n\t\t\twhile(++skipped < 2 && nodes.length > max_nodes_per_rad * ci * (maxRad - minRad)) { ci++; }\r\n\t\t}\r\n\t\tconst totalArc = parentCollapsed ? nodes.length : nodes.reduce(function(acc, x) { return acc + x.minArc; }, 0);\r\n\t\tconst rads_per_arc = (maxRad - minRad) / totalArc;\r\n\t\tvar rad_offset = minRad;\r\n\t\tvar alignment_delta = 0;\r\n\t\t\r\n\t\tfor(var ni = 0; ni < nodes.length; ni++) {\r\n\t\t\tconst node = nodes[ni];\t\r\n\t\t\t\r\n\t\t\t// Make the node\r\n\t\t\tconst frag = document.createRange().createContextualFragment('<div class=\"node-wrapper\">' + node.markup + '</div>');\r\n\t\t\tnode.domNode = frag.firstChild;\r\n\t\t\tinnerContainer.appendChild(node.domNode);\r\n\t\t\tconst systemID = 1 * node.systemID;\r\n\t\t\t$(node.domNode).dblclick(() => _this.collapse(systemID, collapsed.indexOf(systemID) < 0));\r\n\t\t\t\r\n\t\t\t// Position the node\r\n\t\t\tconst dr = (parentCollapsed ? 1 : node.minArc) * rads_per_arc;\r\n\t\t\tconst rad_centre = rad_offset + (dr / 2);\r\n\t\t\t\r\n\t\t\tif(ci == 1 && ni == 0) { // First node on first ring should be axis aligned\r\n\t\t\t\talignment_delta -= rad_centre;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnode.radPosition = { r: ci, theta: rad_centre + alignment_delta };\r\n\t\t\tnode.position = radToCartesian(node.radPosition);\r\n\t\t\t\r\n\t\t\tif(node.position.x < bounds.x[0]) { bounds.x[0] = node.position.x; }\r\n\t\t\tif(node.position.x > bounds.x[1]) { bounds.x[1] = node.position.x; }\r\n\t\t\tif(node.position.y < bounds.y[0]) { bounds.y[0] = node.position.y; }\r\n\t\t\tif(node.position.y > bounds.y[1]) { bounds.y[1] = node.position.y; }\r\n\t\t\t\r\n\t\t\tnode.domNode.style.left = node.position.x + 'px';\r\n\t\t\tnode.domNode.style.top = node.position.y + 'px';\r\n\t\t\t\r\n\t\t\tif(parentCollapsed) {\r\n\t\t\t\tnode.domNode.style.display = 'none';\r\n\t\t\t} else {\t\t\t\t\r\n\t\t\t\t// Do the segment of the next circle\r\n\t\t\t\tconst excess = (ci > 0 && dr > node.minArc * ci) ? dr - node.minArc * ci : 0;\r\n\t\t\t\tif(node.children.length) {\r\n\t\t\t\t\tconst nextBounds = makeDivsForRing(innerContainer, ci + 1, node.children, rad_offset + (0.5 * excess) + alignment_delta, rad_offset - (0.5 * excess) + alignment_delta + dr, collapsed);\r\n\t\t\t\t\tif(nextBounds.x[0] < bounds.x[0]) { bounds.x[0] = nextBounds.x[0]; }\r\n\t\t\t\t\tif(nextBounds.x[1] > bounds.x[1]) { bounds.x[1] = nextBounds.x[1]; }\r\n\t\t\t\t\tif(nextBounds.y[0] < bounds.y[0]) { bounds.y[0] = nextBounds.y[0]; }\r\n\t\t\t\t\tif(nextBounds.y[1] > bounds.y[1]) { bounds.y[1] = nextBounds.y[1]; }\r\n\t\t\t\t\tif(nextBounds.maxCi > bounds.maxCi) { bounds.maxCi = nextBounds.maxCi; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trad_offset += dr;\r\n\t\t}\r\n\t\t\r\n\t\treturn bounds;\r\n\t}\r\n\r\n\tfunction radToCartesian(rad) {\r\n\t\treturn { \r\n\t\t\tx: CIRCLE_SIZE.ringX(rad.r) * Math.sin(rad.theta), \r\n\t\t\ty: CIRCLE_SIZE.ringY(rad.r) * Math.cos(rad.theta)\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/** https://stackoverflow.com/questions/40978050 */\r\n\tfunction propertyFromCssClass(className, property) {\r\n\t\tif(Array.isArray(className)) { className = className.join(' '); }\r\n\t\tvar elem = document.getElementById('temp-div-' + className);\r\n\t\tif(!elem) {\r\n\t\t  elem = document.createElement(\"div\");\r\n\t\t  elem.id = 'temp-div-' + className;\r\n\t\t  elem.style.cssText = \"position:fixed;left:-100px;top:-100px;width:1px;height:1px\";\r\n\t\t  elem.className = className + ' temp';\r\n\t\t  document.body.appendChild(elem);  // required in some browsers\r\n\t\t  }\r\n\t  const color = getComputedStyle(elem).getPropertyValue(property);\r\n\t  //document.body.removeChild(tmp);\r\n\t  return color;\r\n\t}\t\r\n};","var chain = new function() {\r\n\tvar chain = this;\r\n\tthis.map, this.view, this.drawing, this.data = {};\r\n\t\r\n\tthirdPartySuppliers = [ /*thera*/ ];\r\n\r\n\t// Renderer should have:\r\n\t//  ready() - Whether the renderer is initialised and can accept draw calls\r\n\t// switchTo() - Make this renderer active. The renderer can be in a blank state; draw() will be called after\r\n\t// switchFrom() - Switch away from this renderer. All node divs should be removed from the DOM, other items can be removed or made invisible\r\n\t// draw(map, lines, collapsedSystems) - Redraw the map, based on the given node set, line overrides and list of collapsed systems \r\n\t// collapse(systemID, toggle) - marks the system as collapsed/not collapsed\r\n\t// If the renderer allows collapsing of nodes then it will call updateCollapsed on the owner (the chain) with a list of collapsed systems in the current tab\r\n\t\r\n\tconst renderers = { \r\n\t\torgChart: new ChainMapRendererOrgchart(this),\r\n\t\tradial: new ChainMapRendererRadial(this)\r\n\t};\r\n\t\r\n\tthis.renderer = renderers[options.chain.renderer];\r\n\tthis.renderer.switchTo();\r\n\t\r\n\tthis.useRenderer = function(name) {\r\n\t\tif(!renderers[name]) { throw 'Unknown renderer ' + name; }\r\n\t\tif(this.renderer != renderers[name]) {\r\n\t\t\tthis.renderer.switchFrom();\r\n\t\t\tthis.renderer = renderers[name];\r\n\t\t\tthis.renderer.switchTo();\r\n\t\t\tthis.redraw();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.activity = function(data) {\r\n\t\t/*\tfunction for adding recent activity to chain map nodes\t*/\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.activity;\r\n\r\n\t\t// Hide all activity colored dots instead of checking each one\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap .nodeActivity span\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   elements[i].className = elements[i].className + \" invisible\";\r\n\t\t}\r\n\r\n\t\t// Loop through passed data and show dots by system\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap [data-nodeid]\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   var systemID = elements[i].getAttribute(\"data-nodeid\");\r\n\t\t   if (data[systemID]) {\r\n\t\t\t   var shipJumps = data[systemID].shipJumps;\r\n\t\t\t   var podKills = data[systemID].podKills;\r\n\t\t\t   var shipKills = data[systemID].shipKills;\r\n\t\t\t   var npcKills = data[systemID].npcKills;\r\n\t\t\t   var node = elements[i].getElementsByClassName(\"nodeActivity\")[0];\r\n\r\n\t\t\t   if (shipJumps > 0) {\r\n\t\t\t\t   var jumps = node.getElementsByClassName(\"jumps\")[0];\r\n\t\t\t\t   jumps.className = jumps.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   jumps.setAttribute(\"data-tooltip\", shipJumps + \" Jumps\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (podKills > 0) {\r\n\t\t\t\t   var pods = node.getElementsByClassName(\"pods\")[0];\r\n\t\t\t\t   pods.className = pods.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   pods.setAttribute(\"data-tooltip\", podKills + \" Pod Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (shipKills > 0) {\r\n\t\t\t\t   var ships = node.getElementsByClassName(\"ships\")[0];\r\n\t\t\t\t   ships.className = ships.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   ships.setAttribute(\"data-tooltip\", shipKills + \" Ship Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (npcKills > 0) {\r\n\t\t\t\t   var npcs = node.getElementsByClassName(\"npcs\")[0];\r\n\t\t\t\t   npcs.className = npcs.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   npcs.setAttribute(\"data-tooltip\", npcKills + \" NPC Kills\");\r\n\t\t\t   }\r\n\t\t   }\r\n\t\t}\r\n\r\n\t\tif (SystemActivityToolTips.attachedElements && SystemActivityToolTips.attachedElements.length > 0) {\r\n\t\t\tSystemActivityToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tSystemActivityToolTips.attach($(\"#chainMap .nodeActivity > span[data-tooltip]:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.occupied = function(data) {\r\n\t\t/*\tfunction for showing occupied icon  */\r\n\r\n\t\t// Hide all icons instead of checking each one\r\n\t\t$(\"#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show icons\r\n\t\tfor (var x in data) {\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user']\").removeClass(\"invisible\");\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user'] + .badge\").removeClass(\"invisible\").html(data[x].count);\r\n\t\t}\r\n\r\n\t\tOccupiedToolTips.attach($(\"#chainMap [data-icon='user']:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.flares = function(data) {\r\n\t\t/*\tfunction for coloring chain map nodes via flares  */\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.flares;\r\n\r\n\t\t// Remove all current node coloring instead of checking each one\r\n\t\t$(\"#chainMap div.node\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t// Remove all coloring from chain grid\r\n\t\t$(\"#chainGrid tr\").removeClass(\"red yellow green\");\r\n\r\n\t\t// Loop through passed data and add classes by system\r\n\t\tif (data) {\r\n\t\t\tfor (var x in data.flares) {\r\n\t\t\t\tvar systemID = data.flares[x].systemID;\r\n\t\t\t\tvar flare = data.flares[x].flare;\r\n\r\n\t\t\t\tvar row = ($(\"#chainMap [data-nodeid=\"+systemID+\"]\").addClass(flare+\"Node\").parent().index() - 1) / 3 * 2;\r\n\r\n\t\t\t\tif (row > 0) {\r\n\t\t\t\t\t$(\"#chainGrid tr:eq(\"+row+\")\").addClass(flare).next().addClass(flare);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.grid = function() {\r\n\t\t/*  function for showing/hiding grid lines  */\r\n\t\t// This is an optional feature\r\n\t\tif (options.chain.gridlines == false) {\r\n\t\t\t$(\"#chainGrid tr\").addClass(\"hidden\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$(\"#chainGrid tr\").removeClass(\"hidden\");\r\n\t\t//$(\"#chainGrid\").css(\"width\", \"100%\");\r\n\r\n\t\t// Calculate how many rows have systems, max 0 hack to prevent negative numbers, and rows above this number get hidden\r\n\t\tvar rows = Math.max(0, $(\".google-visualization-orgchart-table tr:has(.node)\").length * 2 - 1);\r\n\t\t$(\"#chainGrid tr:gt(\"+rows+\")\").addClass(\"hidden\");\r\n\t}\r\n\r\n\tthis.nodes = function(map) {\r\n\t\tvar chain = {cols: [{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}], rows: []};\r\n\t\tvar frigTypes = [\"Q003\", \"E004\", \"L005\", \"Z006\", \"M001\", \"C008\", \"G008\", \"A009\", \"SML\" ];\r\n\t\tvar connections = [];\r\n\t\tvar chainMap = this;\r\n\r\n\t\tfunction formatStatics(statics) {\r\n\t\t\tif(!statics) { return ''; }\r\n\t\t\tconst shortCodeMap = { 'High-Sec': 'H', 'Low-Sec': 'L', 'Null-Sec': 'N', 'Triglavian':'▼',\r\n\t\t\t\t'Class 1': '1', 'Class 2': '2', 'Class 3': '3', 'Class 4': '4', 'Class 5' : 5, 'Class 6': 6\r\n\t\t\t};\r\n\t\t\tconst classMap = { H: 'hisec', L: 'lowsec', N: 'nullsec', '▼': 'triglavian' };\r\n\t\t\treturn statics.map(function(s) {\r\n\t\t\t\tconst text = shortCodeMap[tripwire.wormholes[s].leadsTo];\r\n\t\t\t\tconst className = classMap[text] || 'class-' +  text;\r\n\t\t\t\tconst tip = tripwire.wormholes[s].leadsTo + ' via ' + s;\r\n\t\t\t\treturn '<span class=\"' + className + '\" data-tooltip=\"' + tip + '\">' + text + '</span>';\r\n\t\t\t}).join('');\r\n\t\t}\r\n\r\n\t\tfunction topLevel(systemID, id) {\r\n\t\t\tif (!systemID || !tripwire.systems[systemID])\r\n\t\t\t\treturn false;\r\n\t\t\tconst tab = options.chain.tabs[options.chain.active];\r\n\t\t\tconst tabName = tab && tab.systemID != 0 && 0 > tab.systemID.indexOf(',') ? options.chain.tabs[options.chain.active].name : undefined;\r\n\t\t\treturn makeSystemNode(systemID, id, null, null, tabName, '&nbsp;', ['top-level']);\r\n\t\t}\r\n\r\n\t\tfunction makeSystemNode(systemID, id, whId, inSigId, systemName, nodeTypeMarkup, additionalClasses) {\r\n\t\t\t// System type switch\r\n\t\t\tvar systemType = getSystemType(systemID);\r\n\t\t\tconst system = tripwire.systems[systemID];\r\n\r\n\t\t\tvar effectClass = null, effect = null;\r\n\t\t\tif (system && system.effect) {\r\n\t\t\t\tswitch(system.effect) {\r\n\t\t\t\t\tcase \"Black Hole\":\r\n\t\t\t\t\t\teffectClass = \"blackhole\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Cataclysmic Variable\":\r\n\t\t\t\t\t\teffectClass = \"cataclysmic-variable\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Magnetar\":\r\n\t\t\t\t\t\teffectClass = \"magnetar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Pulsar\":\r\n\t\t\t\t\t\teffectClass = \"pulsar\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Red Giant\":\r\n\t\t\t\t\t\teffectClass = \"red-giant\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Wolf-Rayet Star\":\r\n\t\t\t\t\t\teffectClass = \"wolf-rayet\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\teffect = system.effect;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsystemName = _.escape(systemName);\r\n\t\t\tconst systemNameText = \r\n\t\t\t\toptions.chain.sigNameLocation == 'name' ? (systemName ? systemName : system ? system.name : '&nbsp;') :\r\n\t\t\t\toptions.chain.sigNameLocation == 'name_prefix' ?\r\n\t\t\t\t\t(systemName ? systemName + (system ? ' - ' + system.name : '') : (system ? system.name : '&nbsp;')) :\r\n\t\t\t\t(system ? system.name : '&nbsp;');\t\r\n\r\n\t\t\tvar node = {v: id, systemID: systemID };\r\n\t\t\tvar chainNode = \"<div id='node\"+id+\"' data-nodeid='\"+systemID+\"'\"\r\n\t\t\t\t+(whId ? \" data-sigid='\"+whId+\"'\" : '')\r\n\t\t\t\t+(inSigId ? \" data-inSigid='\"+inSigId+\"'\" : '')\r\n\t\t\t\t+\" class='node \" + ((additionalClasses || []).join(' ')) + \"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i class='whEffect' \"+(effectClass ? \"data-icon='\"+effectClass+\"' data-tooltip='\"+effect+\"'\" : null)+\"></i>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+systemType+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+\t\t(system ? \"<a href='.?system=\"+system.name+\"'>\"+systemNameText+\"</a>\" : systemNameText)\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>\" + nodeTypeMarkup + \"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='statics'>\"\r\n\t\t\t\t\t\t\t+ formatStatics(system ? system.statics : [])\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\";\r\n\r\n\t\t\tnode.f = chainNode;\r\n\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\t\r\n\t\tfunction makeCalcChildNode(childID, node, targetSystem) {\r\n\t\t\tvar path = guidance.findShortestPath(tripwire.map.shortest, targetSystem - 30000000, node.child.systemID - 30000000);\r\n\t\t\tif(!path) { return null; }\r\n\t\t\t\r\n\t\t\tvar calcNode = { calculated: true};\r\n\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\tcalcNode.parent = {};\r\n\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\tcalcNode.child = {};\r\n\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\tcalcNode.child.systemID = targetSystem;\r\n\t\t\tcalcNode.child.name = tripwire.systems[targetSystem].name;\r\n\t\t\tcalcNode.child.path = path;\r\n\t\t\tcalcNode.child.jumps = path.length - 1;\r\n\t\t\tcalcNode.child.nth = null;\t\t\t\r\n\t\t\t\r\n\t\t\treturn { childID, calcNode };\r\n\t\t}\r\n\t\t\r\n\t\tfunction getSystemType(systemID) {\r\n\t\t\tvar system = systemAnalysis.analyse(systemID);\r\n\t\t\tif(!system) { \r\n\t\t\t\tvar leadsToPointer = typeof(systemID) === \"string\" && systemID.indexOf(\"|\") >= 0 ? tripwire.aSigSystems[systemID.substring(0, systemID.indexOf(\"|\"))] : null;\r\n\t\t\t\tconst nodeClass = \r\n\t\t\t\t\tleadsToPointer && leadsToPointer.substring(0, 6) == 'Class-' ? 1 * leadsToPointer.substring(6) :\r\n\t\t\t\t\tundefined;\r\n\t\t\t\tconst nodeSecurity = \r\n\t\t\t\t\tleadsToPointer == \"High-Sec\" ? 0.8 :\r\n\t\t\t\t\tleadsToPointer == \"Low-Sec\" ? 0.4 :\r\n\t\t\t\t\tleadsToPointer == \"Null-Sec\" ? -0.1 :\r\n\t\t\t\t\tundefined;\r\n\t\t\t\tconst nodeFaction = \r\n\t\t\t\t\tleadsToPointer == \"Triglavian\" ? 500026 :\r\n\t\t\t\t\tundefined;\r\n\t\t\t\t\r\n\t\t\t\tsystem = systemAnalysis.analyse(systemID, { security: nodeSecurity, class: nodeClass, factionID: nodeFaction } );\r\n\t\t\t}\r\n\t\t\treturn \"<span class='\" + system.systemTypeClass + \"'>\" + system.systemTypeName + system.systemTypeModifiers.join('') + \"</span>\";\r\n\t\t}\t\t\r\n\r\n\t\tfunction findLinks(system) {\r\n\t\t\tif (system[0] <= 0) return false;\r\n\r\n\t\t\tvar parentID = parseInt(system[1]), childID = chainList.length;\r\n\t\t\tconst connectedTo = [];\t// Local cache, in addition to usedLinks, for extra link sources\r\n\r\n\t\t\t/** Add the 'current' and 'favourite' calculated nodes if appropriate */\r\n\t\t\tconst addCalcChildNodes = function(node) {\r\n\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class && viewingSystemID != node.child.systemID ) {\r\n\t\t\t\t\tvar calcNode = makeCalcChildNode(childID, node, viewingSystemID);\r\n\t\t\t\t\tif(calcNode) {\r\n\t\t\t\t\t\tchildID = calcNode.childID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(calcNode.calcNode);\r\n\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\tfor (var x in options.favorites) {\r\n\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000 || options.favorites[x] == node.child.systemID)\r\n\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\tvar calcNode = makeCalcChildNode(childID, node, options.favorites[x]);\r\n\t\t\t\t\t\tif(calcNode) {\r\n\t\t\t\t\t\t\tchildID = calcNode.childID;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode.calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t};\r\n\r\n\t\t\tfor (var x in chainData) {\r\n\t\t\t\tvar wormhole = chainData[x];\t\t\t\t\r\n\t\t\t\tif ($.inArray(wormhole.id, usedLinks) == -1) {\r\n\t\t\t\t\tvar sig1, sig2, sig1Type, sig2Type,\r\n\t\t\t\t\t\tparent, child, parentType, childType;\r\n\t\t\t\t\tif (wormhole.parent == \"secondary\") {\r\n\t\t\t\t\t\tsig1 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\t\tsig2 = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsig1 = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\tsig2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsig1Type = wormhole.type; sig2Type = 'K162';\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (sig1 && sig1.systemID == system[0]) {\r\n\t\t\t\t\t\tparent = sig1; child = sig2;\r\n\t\t\t\t\t\tparentType = sig2Type; childType = sig1Type;\r\n\t\t\t\t\t} else if(sig2 && sig2.systemID == system[0]) {\r\n\t\t\t\t\t\tparent = sig2; child = sig1;\r\n\t\t\t\t\t\tchildType = sig2Type; parentType = sig1Type;\r\n\t\t\t\t\t} else { continue; }\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar node = {};\r\n\t\t\t\t\tnode.id = wormhole.id;\r\n\t\t\t\t\tnode.life = wormhole.life;\r\n\t\t\t\t\tnode.mass = wormhole.mass;\r\n\t\t\t\t\tnode.time = parent.modifiedTime;\r\n\r\n\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\tnode.parent.systemID = tripwire.systems[parent.systemID] ? parent.systemID : parent.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\tnode.parent.name = child.name;\r\n\t\t\t\t\tnode.parent.type = parentType;\r\n\t\t\t\t\tnode.parent.typeBM = null;\r\n\t\t\t\t\tnode.parent.classBM = null;\r\n\t\t\t\t\tnode.parent.nth = null;\r\n\t\t\t\t\tnode.parent.signatureID = child.signatureID;\r\n\t\t\t\t\tnode.parent.sigIndex = child.id;\r\n\r\n\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\tnode.child.systemID = tripwire.systems[child.systemID] ? child.systemID : child.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\tnode.child.name = parent.name;\r\n\t\t\t\t\tnode.child.type = childType;\r\n\t\t\t\t\tnode.child.typeBM = null;\r\n\t\t\t\t\tnode.child.classBM = null;\r\n\t\t\t\t\tnode.child.nth = null;\r\n\t\t\t\t\tnode.child.signatureID = parent.signatureID;\r\n\t\t\t\t\tnode.child.sigIndex = parent.id;\r\n\r\n\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\tif(tripwire.systems[child.systemID]) { connectedTo.push(1 * child.systemID); }\t// cast to number - sigs have the system as a string\r\n\t\t\t\t\t// usedLinks[system[2]].push(node.id);\r\n\t\t\t\t\t\r\n\t\t\t\t\taddCalcChildNodes(node);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthirdPartySuppliers.forEach(function(supplier) {\t\t\t\t\r\n\t\t\t\tconst ids = { parentID: parentID, nextChildID: ++childID };\r\n\t\t\t\tconst supplierNodes = supplier.findLinks(1 * system[0], ids);\r\n\t\t\t\tif(!supplierNodes) { return; }\r\n\t\t\t\tchildID = ids.nextChildID - 1;\r\n\r\n\t\t\t\tfor(var ti = 0; ti < supplierNodes.length; ti++) {\r\n\t\t\t\t\tvar supplierNode = supplierNodes[ti];\r\n\t\t\t\t\tif(0 > usedLinks.indexOf(supplierNode.id)) {\r\n\t\t\t\t\t\tif(0 > connectedTo.indexOf(supplierNode.child.systemID)) { // not in our map already\r\n\t\t\t\t\t\t\tsupplierNode.thirdParty = supplier.nodeNameSuffix;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tchainLinks.push(supplierNode);\r\n\t\t\t\t\t\t\tchainList.push([supplierNode.child.systemID, supplierNode.child.id, system[2]]);\r\n\t\t\t\t\t\t\tconnectedTo.push(supplierNode.child.systemID);\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\taddCalcChildNodes(supplierNode);\t\t\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Always want to do this, even if we didn't add it, because in that case the link is overridden by one on this mask, so it is 'used' even if not made visible\r\n\t\t\t\t\t\tusedLinks.push(supplierNode.id);\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tif ($(\"#chainTabs .current\").length > 0) {\r\n\t\t\tvar systems = $(\"#chainTabs .current .name\").data(\"tab\").toString().split(\",\");\r\n\t\t\tvar chainList = [];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tif (systems == 0) {\r\n                                let i = 0;\r\n                                Object.keys(map).slice()/*.reverse()*/.forEach(x => {\r\n\t\t\t\t        const parent = tripwire.client.signatures[map[x].initialID];\r\n\t\t\t\t        const child = tripwire.client.signatures[map[x].secondaryID];\r\n                                        if (parent && tripwire.systems[parent.systemID] && typeof(tripwire.systems[parent.systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t// usedLinks[parent.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(parent.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([parent.systemID, i, parent.systemID]);\r\n                                        } else if (child && tripwire.systems[child.systemID] && typeof(tripwire.systems[child.systemID].class) == \"undefined\") {\r\n\t\t\t\t  \t        i++;\r\n\t\t\t\t  \t\t// usedLinks[child.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(child.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([child.systemID, i, child.systemID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfor (var x in systems) {\r\n\t\t\t\t\t// usedLinks[systems[x]] = [];\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(systems[x], parseInt(x) + 1), {v: null}]});\r\n\t\t\t\t\tchainList.push([systems[x], parseInt(x) + 1, systems[x]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; i++) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = viewingSystemID;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst systemsInChainMap = {};\r\n\t\tvar closestToViewing = null;\r\n\t\t\r\n\t\tfor (var x in chainLinks) {\r\n\t\t\tvar node = chainLinks[x];\r\n\t\t\tvar row = {c: []};\r\n\t\t\t\r\n\t\t\tconst sigText = options.chain[\"node-reference\"] == \"id\" ? (node.child.signatureID ? node.child.signatureID.substring(0, 3) : \"???\") :\r\n\t\t\t\t\t(node.child.type || \"(?)\") + sigFormat(node.child.typeBM, \"type\");\r\n\t\t\tconst nodeTypeMarkup = node.child.path ? \r\n\t\t\t\tchainMap.renderPath(node.child.path) :\r\n\t\t\t\t\"<a href='#' onclick='sigDialog.openSignatureDialog({data: { signature: \" + node.child.sigIndex + \", mode: \\\"update\\\" }}); return false;'>\" + _.escape(\r\n\t\t\t\t\tnode.child.name && options.chain.sigNameLocation == 'ref' ? node.child.name :\r\n\t\t\t\t\tnode.child.name && options.chain.sigNameLocation == 'ref_prefix' ? node.child.name + ' - ' + sigText :\r\n\t\t\t\t\tsigText\r\n\t\t\t\t) + '</a>';\r\n\t\t\tconst additionalClasses = node.calculated ? ['calc'] : systemsInChainMap[node.child.systemID] ? [ 'loop' ] : [];\r\n\t\t\tif(node.thirdParty) { additionalClasses.push('third-party', 'third-party-' + node.thirdParty); }\r\n\r\n\t\t\tvar modifiers = [];\t\t\t\r\n\t\t\tif (node.life == \"critical\") { modifiers.push('eol'); }\r\n\t\t\tif (node.mass == \"critical\") { modifiers.push('critical'); }\r\n\t\t\telse if (node.mass == \"destab\") { modifiers.push('destab'); }\r\n\t\t\t\r\n\t\t\tif($.inArray(node.parent.type, frigTypes) != -1 || $.inArray(node.child.type, frigTypes) != -1) { modifiers.push('frig'); }\r\n\t\t\t\r\n\t\t\tconst parentModifiers = (systemsInChainMap[node.parent.systemID] || { chainModifiers:[]}).chainModifiers;\r\n\t\t\trow.chainModifiers = modifiers.concat(parentModifiers);\r\n\t\t\t\r\n\t\t\trow.chainModifiers.forEach(function(cm) { modifiers.push(cm + '-chain')});\r\n\t\t\t\r\n\t\t\t// Update result set (rows/connections)\r\n\t\t\tconst child = makeSystemNode(node.child.systemID, node.child.id, node.id, node.child.sigIndex, node.child.name, nodeTypeMarkup, additionalClasses.concat(modifiers));\r\n\r\n\t\t\tvar parent = {v: node.parent.id};\r\n\r\n\t\t\trow.c.push(child, parent);\r\n\t\t\tchain.rows.push(row);\r\n\t\t\tif(modifiers.length) { connections.push(Array(child.v, parent.v, modifiers, node.id)); }\r\n\t\t\t\r\n\t\t\tconst parentPathHome = (systemsInChainMap[node.parent.systemID] || { pathHome:[]}).pathHome;\r\n\t\t\trow.pathHome = parentPathHome.concat(node.child);\r\n\t\t\t\r\n\t\t\tif(!node.calculated) { \r\n\t\t\t\tsystemsInChainMap[node.child.systemID] = row; // store for loops/chain modifiers\r\n\t\t\t\t\r\n\t\t\t\t// check for closest entrance/way home\r\n\t\t\t\tconst pathToViewed = guidance.findShortestPath(tripwire.map.shortest, viewingSystemID - 30000000, node.child.systemID - 30000000);\r\n\t\t\t\tif(pathToViewed && (\r\n\t\t\t\t\t(viewingSystemID == node.child.systemID) || \r\n\t\t\t\t\t(pathToViewed && (!closestToViewing || pathToViewed.length < closestToViewing.pathLength))\r\n\t\t\t\t)) {\r\n\t\t\t\t\tclosestToViewing = { systemID: node.child.systemID, pathLength: pathToViewed.length, pathHome: row.pathHome };\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t}\r\n\r\n\t\t// Apply critical/destab line colors\r\n\t\tconnections.reverse(); // so we apply to outer systems first\r\n\r\n\t\t//this.data.map = chain;\r\n\t\t//this.data.lines = connections;\r\n\t\treturn {\"map\": chain, \"lines\": connections, \"closestToViewing\": closestToViewing};\r\n\t}\r\n\r\n\tthis.renderPath = function(path) {\r\n\t\tif(path.length <= 1 || path.length > options.chain.routingLimit) { return '' + path.length - 1; }\r\n\t\telse {\r\n\t\t\tvar systemMarkup = path\r\n\t\t\t.slice(0, path.length - 1).reverse()\r\n\t\t\t.map(function(s) {\r\n\t\t\t\tconst systemID = 30000000 + 1 * s;\r\n\t\t\t\tconst system = systemAnalysis.analyse(systemID);\r\n\t\t\t\tconst securityClass = system.systemTypeClass;\r\n\t\t\t\treturn '<span class=\"' + securityClass + '\" data-tooltip=\"' + system.name + ' (' + system.security + ')\" onclick=\"tripwire.systemChange(' + systemID + ')\">' + system.pathSymbol + '</span>';\r\n\t\t\t});\r\n\t\t\tvar r = '<span class=\"path\">';\r\n\t\t\tfor(var i = 0; i < systemMarkup.length; i++) {\r\n\t\t\t\tif(i > 0 && 0 == i % 5) { r += '|'; }\r\n\t\t\t\t\r\n\t\t\t\tr += systemMarkup[i];\t\t\t\t \r\n\t\t\t}\r\n\t\t\treturn r + '</span>';\r\n\t\t}\r\n\t}\r\n\r\n\tthis.setActiveTab = function(newIndex) {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\toptions.chain.active = newIndex;\r\n\t\tif(newIndex != null) {\r\n\t\t\t$(\"#chainTabs .tab\").eq(newIndex).addClass('current');\r\n\t\t}\r\n\t\t\r\n\t\toptions.save();\r\n\t\tchain.redraw();\r\n\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.useRenderer(options.chain.renderer);\r\n\t\t\r\n\t\tvar data = $.extend(true, {}, this.data);\r\n\t\tdata.map = $.extend(true, {}, data.rawMap);\r\n\r\n\t\tthis.draw(data);\r\n\t}\r\n\t\r\n\tvar drawRetryTimer = null;\r\n\r\n\tthis.draw = function(data) {\r\n\t\tvar data = typeof(data) !== \"undefined\" ? data : {};\r\n\t\tclearTimeout(drawRetryTimer);\r\n\r\n\t\t// We need to make sure Google chart is ready and we have signature data for this system before we begin, otherwise delay\r\n\t\tif (!this.renderer.ready() || (Object.keys(data.map||{}).length && !tripwire.client.signatures)) {\r\n\t\t\tdrawRetryTimer = setTimeout(function() { chain.draw(data) }, 100);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.map) {\r\n\t\t\tthis.drawing = true;\r\n\r\n\t\t\tthis.data.rawMap = $.extend(true, {}, data.map);\r\n\r\n\t\t\t// if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout == false)) {\r\n\t\t\t// \tif (options.masks.active != \"273.0\") {\r\n\t\t\t// \t\tfor (var i in data.map) {\r\n\t\t\t// \t\t\tif (data.map[i].mask == \"273.0\") {\r\n\t\t\t// \t\t\t\tdelete data.map[i];\r\n\t\t\t// \t\t\t}\r\n\t\t\t// \t\t}\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\r\n\t\t\t// Sort so we keep the chain map order the same\r\n\t\t\tObject.sort(data.map, \"id\");\r\n\r\n\t\t\t$.extend(data, this.nodes(data.map)); // 250ms -> <100ms\r\n\t\t\t$.extend(this.data, data);\r\n\t\t\t\r\n\t\t\tconst collapsedSystems = options.chain.tabs[options.chain.active] ? (options.chain.tabs[options.chain.active].collapsed || []) : [];\r\n\r\n\t\t\tthis.renderer.draw(data.map, data.lines, collapsedSystems); // 150ms\r\n\t\t\t//this.map.draw(this.newView(data.map), this.options); // 150ms\r\n\r\n//\t\t\tthis.renderer.lines(data); // 300ms\r\n\t\t\tthis.grid(); // 4ms\r\n\r\n\t\t\t// Apply current system style\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\"); // 0.1ms\r\n\r\n\t\t\t// Remove old system effect tooltips and add current ones\r\n\t\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t\t}\r\n\t\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\")); // 0.30ms\r\n\t\t\tWormholeRouteToolTips.attach($(\"#chainMap .path span[data-tooltip]\"));\r\n\t\t\tSystemActivityToolTips.attach($(\"#chainMap .nodeClass span[data-tooltip]\"));\r\n\t\t\t\r\n\t\t\t// Update dependent controls: Path to chain/home\r\n\t\t\tif(data.closestToViewing) {\r\n\t\t\t\tconst inChain = data.closestToViewing.pathLength <= 1;\r\n\t\t\t\tconst prefixText = inChain ? 'In chain: ' : (data.closestToViewing.pathLength - 1) + 'j from ' ;\r\n\t\t\t\tconst pathHomeText = data.closestToViewing.pathHome.slice().reverse()\r\n\t\t\t\t\t.map(function(n) { return '<a href=\".?system=' + tripwire.systems[n.systemID].name + '\">' + (n.name || n.signatureID || '???') + '</a>'; })\r\n\t\t\t\t\t.join(' &gt; ');\r\n\t\t\t\tconst pathToChainText = inChain ? '' : '<br/>' + this.renderPath(guidance.findShortestPath(tripwire.map.shortest, data.closestToViewing.systemID - 30000000, viewingSystemID - 30000000));\r\n\t\t\t\t$(\"#infoExtra\").html(prefixText + pathHomeText + pathToChainText);\r\n\t\t\t\tTooltips.attach($(\"#infoExtra [data-tooltip]\"));\r\n\t\t\t} else { $(\"#infoExtra\").text(''); }\r\n\t\t\t\r\n\t\t\tthis.drawing = false;\r\n\t\t}\r\n\r\n\t\t// Gather latest system activity\r\n\t\tif (!this.data.activity || new Date() > this.data.activity.expires) {\r\n\t\t\tdata.activity = {};\r\n\t\t\ttripwire.esi.universeJumps()\r\n\t\t\t\t.done(function(results, status, request) {\r\n\t\t\t\t\tdata.activity.expires = new Date(request.getResponseHeader(\"expires\"));\r\n\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\tshipJumps: results[x].ship_jumps\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\t return tripwire.esi.universeKills()\r\n\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\t\t\tif (data.activity[results[x].system_id]) {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].podKills = results[x].pod_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].shipKills = results[x].ship_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].npcKills = results[x].npc_kills;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\t\t\t\tpodKills: results[x].pod_kills,\r\n\t\t\t\t\t\t\t\t\t\tshipKills: results[x].ship_kills,\r\n\t\t\t\t\t\t\t\t\t\tnpcKills: results[x].npc_kills,\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\tchain.data.activity = chain.activity(data.activity);\r\n\t\t\t\t});\r\n\t\t} else if (data.map) {\r\n\t\t\tchain.activity(this.data.activity);\r\n\t\t}\r\n\r\n\t\tif (data.occupied) { // 3ms\r\n\t\t\tthis.data.occupied = this.occupied(data.occupied);\r\n\t\t}\r\n\r\n\t\tif (data.flares) { // 20ms\r\n\t\t\tthis.data.flares = this.flares(data.flares);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.updateCollapsed = function(collapsedSystems) {\r\n\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\toptions.chain.tabs[options.chain.active].collapsed = collapsedSystems;\r\n\t\t}\r\n\t\t\r\n\t\t// Apply current system style\r\n\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\");\r\n\r\n\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\"));\r\n\r\n\t\tchain.activity(chain.data.activity);\r\n\r\n\t\tchain.occupied(chain.data.occupied);\r\n\r\n\t\tchain.flares(chain.data.flares);\r\n\r\n\t\tchain.grid();\r\n\r\n\t\toptions.save();\r\n\t}\r\n\r\n}\r\n","tripwire.active = function(data) {\n    var editSigs = [];\n    var editComments = [];\n\n    for (var x in data) {\n        var activity = JSON.parse(data[x].activity);\n        editSigs.push(parseInt(activity.editSig));\n        editComments.push(parseInt(activity.editComment));\n\n        if (activity.editSig) {\n            $(\"#sigTable tr[data-id='\"+activity.editSig+\"']\")\n                //.attr('data-tooltip', sig.editing)\n                //.attr(\"title\", sig.editing)\n                .addClass(\"editing\")\n                .find(\"td\")\n                .animate({backgroundColor: \"#001b47\"}, 1000); //35240A - Yellow\n        }\n\n        if (activity.editComment && $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"'] .cke\").length > 0) {\n            $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"']\")\n                .addClass(\"editing\")\n                .find(\".commentStatus\").html(data[x].characterName + \" is editing\").fadeIn();\n        }\n    }\n\n    $(\"#sigTable tr.editing\").each(function() {\n        if ($.inArray($(this).data(\"id\"), editSigs) == -1) {\n            $(\"#sigTable tr[data-id='\"+$(this).data(\"id\")+\"']\")\n                //.attr('data-tooltip', '')\n                //.removeAttr(\"title\")\n                .removeClass(\"editing\")\n                .find(\"td\")\n                .animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\n        }\n    });\n\n    $(\"#commentWrapper .editing\").each(function() {\n        if ($.inArray($(this).data(\"id\"), editComments) == -1) {\n            $(\"#commentWrapper .editing[data-id='\"+$(this).data(\"id\")+\"']\")\n                .removeClass(\"editing\")\n                .find(\".commentStatus\").fadeOut(function() {$(this).html(\"\")});\n        }\n    });\n}\n","// Hanldes adding to Signatures section\r\n// ToDo: Use native JS\r\ntripwire.addSig = function(add, option, disabled) {\r\n    var option = option || {};\r\n    var animate = typeof(option.animate) !== 'undefined' ? option.animate : true;\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n\tconst returnLinkText = add.signatureID ? '<a class=\"return-link\" href=\"#\" onclick=\"tripwire.setReturnSig(event, ' + add.id + ')\">&gt;&gt; Set ' + \r\n\t\t\t\tadd.signatureID.substring(0, 3).toUpperCase() + '-' + add.signatureID.substring(3) +\r\n\t\t\t\t' as return</a>'\r\n\t\t\t\t: '';\r\n\r\n    if (add.type == \"wormhole\") {\r\n        var wormhole = Object.values(tripwire.client.wormholes).find(function (wh) { return wh.initialID == add.id || wh.secondaryID == add.id});\r\n        if (!wormhole) return false;\r\n        var otherSignature = add.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n        if (!otherSignature) return false;\r\n\r\n        if (add.name) {\r\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+add.name+\"</a>\" : add.name;\r\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\r\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\r\n        } else if (tripwire.systems[otherSignature.systemID]) {\r\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\r\n        } else {\r\n            leadsTo = \"\";\r\n        }\r\n\r\n\t\tconst leadsToText = leadsTo ? leadsTo : \r\n\t\t\tadd.signatureID && add.signatureID.length && add.signatureID[0] != '?' ? returnLinkText\r\n\t\t\t: '';\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole[wormhole.parent+\"ID\"] == add.id ? wormhole.type || \"\" : (wormhole.parent ? \"K162\" : \"\"))+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+leadsToText+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n\t\tconst leadsToText = add.type === 'unknown' ? returnLinkText : \r\n\t\t\t(add.name ? linkSig(add.name) : '');\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(add.signatureID ? add.signatureID.substring(0, 3)+\"-\"+(add.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+add.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+leadsToText+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    $(\"#sigTable\").append(tr);\r\n\r\n    // Add counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(add.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            // .countdown('pause')\r\n            .addClass('critical')\r\n            // .countdown('resume');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(add.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    if (animate) {\r\n        $(tr)\r\n            .find('td')\r\n            .wrapInner('<div class=\"hidden\" />')\r\n            .parent()\r\n            .find('td > div')\r\n            .slideDown(700, function(){\r\n                $set = $(this);\r\n                $set.replaceWith($set.contents());\r\n            });\r\n\r\n        $(tr).find(\"td\").animate({backgroundColor: \"#004D16\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n    }\r\n}\r\n\r\ntripwire.setReturnSig = function(event, sigToRemoveId) {\r\n\tevent.preventDefault();\r\n\tconst sigToUpdate = tripwire.signatures.returnSig;\r\n\tconst sigToRemove = tripwire.client.signatures[sigToRemoveId];\r\n\t\r\n\tif(!(sigToUpdate && sigToRemove)) { return; }\r\n\t\r\n\tsigDialog.overwriteSignature(sigToRemoveId, function(data) {\r\n\t\tsigToUpdate.signatureID = sigToRemove.signatureID;\r\n\t\t// we need the wormhole part to make refresh.php not think the sig isn't a wormhole any more\r\n\t\tconst payload = {\"signatures\": {\"update\": [ { wormhole: 'dummy', signatures: [ sigToUpdate ] } ] }};\r\n\t\ttripwire.refresh('refresh', payload);\r\n\t});\r\n}","// Handles API updates\ntripwire.API = function() {\n    this.indicator;\n    this.APIrefresh;\n\n    this.API.expire = function() {\n        var options = {since: tripwire.API.APIrefresh, until: null, format: \"MS\", layout: \"-{mnn}{sep}{snn}\"};\n        $(\"#APItimer\").countdown(\"option\", options);\n    }\n\n    this.API.refresh = function() {\n        $.ajax({\n            url: \"api_update.php\",\n            cache: false,\n            dataType: \"JSON\",\n            data: \"indicator=\"+tripwire.API.indicator\n        }).done(function(data) {\n            if (data && data.APIrefresh) {\n                tripwire.API.indicator = data.indicator;\n                tripwire.API.APIrefresh = new Date(data.APIrefresh);\n                activity.refresh(); //Refresh graph\n\n                var options = {until: tripwire.API.APIrefresh, since: null, layout: \"{mnn}{sep}{snn}\"};\n                $(\"#APItimer\").countdown(\"option\", options);\n                setTimeout(\"tripwire.API.refresh();\", $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30);\n            } else if ($(\"#APItimer\").countdown(\"option\", \"layout\") !== \"-{mnn}{sep}{snn}\" && $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) > 120) {\n                setTimeout(\"tripwire.API.refresh();\", ($.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30) * 1000);\n            } else {\n                setTimeout(\"tripwire.API.refresh();\", 15000);\n            }\n        });\n    }\n\n    this.API.init = function() {\n        $.ajax({\n            url: \"api_update.php\",\n            cache: true,\n            dataType: \"JSON\",\n            data: \"init=true\"\n        }).done(function(data) {\n            tripwire.API.indicator = data.indicator;\n            tripwire.API.APIrefresh = new Date(data.APIrefresh);\n\n            $(\"#APItimer\").countdown({until: tripwire.API.APIrefresh, onExpiry: tripwire.API.expire, alwaysExpire: true, compact: true, format: \"MS\", serverSync: tripwire.serverTime.getTime, onTick: function(t) { $(\"#APIclock\").val(t[5] + 1).trigger(\"change\"); }})\n            var timer = $(\"#APItimer\").countdown(\"option\", \"layout\") === \"-{mnn}{sep}{snn}\" ? 15 : $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30;\n            setTimeout(\"tripwire.API.refresh();\", timer * 1000);\n        });\n    }\n\n    this.API.init();\n}\n// tripwire.API();\n","tripwire.autoMapper = function(from, to) {\r\n    var pods = [33328, 670];\r\n    var undo = [];\r\n\r\n    // Convert from & to from system name to system ID for diagnostic testing\r\n    // from = viewingSystemID;\r\n    // to = Object.index(tripwire.systems, 'name', to);\r\n\r\n    // Make sure the automapper is turned on & not disabled\r\n    if (!$(\"#toggle-automapper\").hasClass(\"active\") || $(\"#toggle-automapper\").hasClass(\"disabled\"))\r\n        return false;\r\n\r\n    // Make sure from and to are valid systems\r\n    if (!tripwire.systems[from] || !tripwire.systems[to])\r\n        return false;\r\n\r\n    // Make sure from and to are not the same system\r\n    if (from == to)\r\n        return false;\r\n\r\n    // Is pilot in a station?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.stationID)\r\n        return false;\r\n\r\n    // Is pilot in a pod?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.shipTypeID && $.inArray(parseInt(tripwire.client.EVE.shipTypeID), pods) >= 0)\r\n         return false;\r\n\r\n    // Is this a gate?\r\n    if (typeof(tripwire.map.shortest[from - 30000000]) != \"undefined\" && typeof(tripwire.map.shortest[from - 30000000][to - 30000000]) != \"undefined\")\r\n        return false;\r\n\r\n     // Is this an existing connection?\r\n     if ($.map(tripwire.client.wormholes,\r\n               function(wormhole) {\r\n                 const initial = tripwire.client.signatures[wormhole.initialID];\r\n                 const secondary = tripwire.client.signatures[wormhole.secondaryID];\r\n                 return initial && secondary &&\r\n                   ((initial.systemID == from && secondary.systemID == to) ||\r\n                    (initial.systemID == to && secondary.systemID == from))  ? wormhole : null;\r\n               }).length > 0) {\r\n       return false;\r\n     }\r\n\r\n    var payload = {\"signatures\": {\"add\": [], \"update\": []}};\r\n    var sig, toClass;\r\n\r\n    if (tripwire.systems[to].class)\r\n        toClass = \"Class-\" + tripwire.systems[to].class;\r\n    else if (tripwire.systems[to].security >= 0.45)\r\n        toClass = \"High-Sec\";\r\n    else if (tripwire.systems[to].security > 0)\r\n        toClass = \"Low-Sec\";\r\n    else\r\n        toClass = \"Null-Sec\";\r\n\r\n    var wormholes = $.map(tripwire.client.wormholes, function(wormhole) {\r\n        if ( ( tripwire.client.signatures[wormhole.initialID] !== undefined ) && ( tripwire.client.signatures[wormhole.secondaryID] !== undefined ) ) {\r\n            // Find wormholes that have no set Leads To system, and their initial system is from the wormhole we just jumped from\r\n            if (tripwire.client.signatures[wormhole.initialID].systemID == from && !tripwire.systems[tripwire.client.signatures[wormhole.secondaryID].systemID]) {\r\n                if (tripwire.aSigSystems[tripwire.client.signatures[wormhole.secondaryID].systemID] == toClass) {\r\n                    // Find wormholes that Leads To is generically set to the class we just jumped into\r\n                    return wormhole;\r\n                } else if (wormhole.type && tripwire.wormholes[wormhole.type] && tripwire.wormholes[wormhole.type].leadsTo.replace(' ', '-') == toClass) {\r\n                    // Find wormholes that Type is known to lead to the class we just jumped into\r\n                    return wormhole;\r\n                } else if (tripwire.client.signatures[wormhole.secondaryID].systemID === null && (!wormhole.type || !tripwire.wormholes[wormhole.type])) {\r\n                    // Find wormholes that don't have a Type or any kind of Leads To entered\r\n                    return wormhole;\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    if (wormholes.length) {\r\n        if (wormholes.length > 1) {\r\n            $(\"#dialog-select-signature\").dialog({\r\n                autoOpen: true,\r\n                title: \"Which Signature?\",\r\n                width: 390,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var i = $(\"#dialog-select-signature [name=sig]:checked\").val();\r\n                        var wormhole = wormholes[i];\r\n                        var signature = tripwire.client.signatures[wormhole.initialID];\r\n                        var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id\r\n                                },\r\n                                {\r\n                                    \"id\": signature2.id,\r\n                                    \"systemID\": to\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        var success = function(data) {\r\n                            if (data.resultSet && data.resultSet[0].result == true) {\r\n                                undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n                                $(\"#dialog-select-signature\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', payload, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n                    $(\"#dialog-select-signature .optionsTable tbody\").empty();\r\n\r\n                    $.each(wormholes, function(i) {\r\n                        var signature = tripwire.client.signatures[wormholes[i].initialID];\r\n                        var signatureRow = $(\"#sigTable tr[data-id='\"+signature.id+\"']\").html();\r\n                        var tr = \"<tr>\"\r\n                          + \"<td><input type='radio' name='sig' value='\"+i+\"' id='sig\"+i+\"' /></td>\"\r\n                          + signatureRow\r\n                          + \"</tr>\";\r\n\r\n                        $(\"#dialog-select-signature .optionsTable tbody\").append(tr);\r\n                        $(\"#dialog-select-signature .optionsTable tbody td\").wrapInner(\"<label for='sig\"+i+\"' />\");\r\n                    });\r\n                }\r\n            });\r\n        } else {\r\n            var wormhole = wormholes[0];\r\n            var signature = tripwire.client.signatures[wormhole.initialID];\r\n            var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n            payload.signatures.update.push({\r\n                \"wormhole\": {\r\n                    \"id\": wormhole.id\r\n                },\r\n                \"signatures\": [\r\n                    {\r\n                        \"id\": signature.id\r\n                    },\r\n                    {\r\n                        \"id\": signature2.id,\r\n                        \"systemID\": to\r\n                    }\r\n                ]\r\n            });\r\n            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n        }\r\n    } else {\r\n        // Nothing matches, create a new wormhole\r\n        payload.signatures.add.push({\r\n            \"wormhole\": {\r\n                \"type\": null,\r\n                \"parent\": \"initial\",\r\n                \"life\": \"stable\",\r\n                \"mass\": \"stable\"\r\n            },\r\n            \"signatures\": [\r\n                {\r\n                    \"systemID\": from,\r\n                    \"type\": \"wormhole\"\r\n                },\r\n                {\r\n                    \"systemID\": to,\r\n                    \"type\": \"wormhole\"\r\n                }\r\n            ]\r\n        });\r\n    }\r\n\r\n    if (payload.signatures.add.length || payload.signatures.update.length) {\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                if (data.results) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                    }\r\n                }\r\n\r\n                if (undo.length) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', payload, success);\r\n    }\r\n}\r\n","$(\"body\").on(\"dblclick\", \".comment\", function(e) {\r\n\te.preventDefault();\r\n\tdocument.getSelection().removeAllRanges();\r\n\t$(this).find(\".commentEdit\").click();\r\n})\r\n\r\n$(\"body\").on(\"click\", \".commentEdit\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t$comment.find(\".commentToolbar\").hide();\r\n\r\n\tCKEDITOR.replace($comment.find(\".commentBody\").attr(\"id\"), CKConfig).on(\"instanceReady\", function() {\r\n\t\t$comment.find(\".commentStatus\").html(\"\");\r\n\t\t$comment.find(\".commentFooter\").show();\r\n\t\t$comment.find(\".commentFooter .commentControls\").show();\r\n\t});\r\n\r\n\ttripwire.activity.editComment = $comment.data(\"id\");\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSave, .commentCancel\", function(e) {\r\n\te.preventDefault();\r\n\tvar $this = $(this);\r\n\tif ($this.attr(\"disabled\")) return false;\r\n\r\n\tvar $comment = $this.closest(\".comment\");\r\n\t$this.attr(\"disabled\", \"true\");\r\n\r\n\tif ($this.hasClass(\"commentSave\")) {\r\n\t\tvar data = {\"mode\": \"save\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? 0 : viewingSystemID, \"comment\": CKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].getData()};\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"comments.php\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: data,\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.result == true) {\r\n\t\t\t\t$comment.find(\".commentModified\").html(\"Edited by \" + data.comment.modifiedByName + \" at \" + data.comment.modifiedDate);\r\n\t\t\t\t$comment.find(\".commentCreated\").html(\"Posted by \" + data.comment.createdByName + \" at \" + data.comment.createdDate);\r\n\t\t\t\tTooltips.attach($comment.find(\"[data-tooltip]\"));\r\n\r\n\t\t\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(false);\r\n\t\t\t\t$comment.attr(\"data-id\", data.comment.id);\r\n\t\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(true);\r\n\r\n\t\tif (!$comment.attr(\"data-id\")) {\r\n\t\t\t$comment.remove();\r\n\t\t} else {\r\n\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t}\r\n\t}\r\n\r\n\t$comment.find(\".commentStatus\").html(\"\");\r\n\r\n\tdelete tripwire.activity.editComment;\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentDelete\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteComment\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#notesWidget\")},\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar $comment = $(this).data(\"comment\");\r\n\t\t\t\t\tvar data = {\"mode\": \"delete\", \"commentID\": $comment.data(\"id\")};\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"comments.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteComment\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$comment.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteComment\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#add-comment\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(\".comment:last\").clone();\r\n\tvar commentID = $(\".comment:visible:last .commentBody\").attr(\"id\") ? $(\".comment:visible:last .commentBody\").attr(\"id\").replace(\"comment\", \"\") + 1 : 0;\r\n\t$(\".comment:last\").before($comment);\r\n\r\n\t$comment.find(\".commentBody\").attr(\"id\", \"comment\" + commentID);\r\n\t$comment.removeClass(\"hidden\").find(\".commentEdit\").click();\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSticky\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\tvar data = {\"mode\": \"sticky\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? viewingSystemID : 0};\r\n\r\n\t$.ajax({\r\n\t\turl: \"comments.php\",\r\n\t\ttype: \"POST\",\r\n\t\tdata: data,\r\n\t\tdataType: \"JSON\"\r\n\t}).done(function(data) {\r\n\t\tif (data && data.result == true) {\r\n\t\t\t$comment.find(\".commentSticky\").hasClass(\"active\") ? $comment.find(\".commentSticky\").removeClass(\"active\") : $comment.find(\".commentSticky\").addClass(\"active\");\r\n\t\t}\r\n\t});\r\n});\r\n\r\nfunction commentSortHandler(sortOrder) {\r\n\tconst sortElem = document.getElementById('comment-sort');\r\n\tconst containerElem = document.getElementById('comment-container');\r\n\tsortOrder = sortOrder || sortElem.nextSort || getCookie('commentSort') || 'asc';\r\n\t\r\n\tswitch(sortOrder) {\r\n\t\tcase 'asc':\r\n\t\t\tsortElem.nextSort = 'desc';\r\n\t\t\tsortElem.setAttribute('data-icon', 'sort-asc');\r\n\t\t\tcontainerElem.style.flexDirection = 'column';\r\n\t\t\tbreak;\r\n\t\tcase 'desc':\r\n\t\t\tsortElem.nextSort = 'asc';\r\n\t\t\tsortElem.setAttribute('data-icon', 'sort-desc');\r\n\t\t\tcontainerElem.style.flexDirection = 'column-reverse';\r\n\t\t\tbreak;\r\n\t\tdefault: throw 'sort order somehow wrong';\r\n\t}\r\n\t\r\n\tsetCookie('commentSort', sortOrder, 3650);\r\n}\r\n\r\n$(\"body\").on(\"click\", \"#comment-sort\", function(e) {\r\n\tcommentSortHandler(undefined);\r\n});\r\n\r\ncommentSortHandler();","// Handles removing from Signatures section\ntripwire.deleteSig = function(key) {\n    var tr = $(\"#sigTable tr[data-id='\"+key+\"']\");\n\n    //Append empty space to prevent non-coloring\n    $(tr).find('td:empty, a:empty').append(\"&nbsp;\");\n\n    $(tr)\n        .find('td')\n        .wrapInner('<div />')\n        .parent()\n        .find('td > div').animate({backgroundColor: \"#4D0000\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000)\n        .slideUp(700, function(){\n            // Remove countdown reference\n            $(tr).find('span[data-age]').countdown(\"destroy\");\n\n            $(this).parent().parent().remove();\n            $(\"#sigTable\").trigger(\"update\");\n        });\n}\n","// Handles changing Signatures section\n// ToDo: Use native JS\ntripwire.editSig = function(edit, disabled) {\n    var disabled = disabled || false;\n    var wormhole = {};\n\n    if (edit.type == \"wormhole\") {\n        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == edit.id || wormhole.secondaryID == edit.id) return wormhole; })[0];\n        if (!wormhole) return false;\n        var otherSignature = edit.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\n        if (!otherSignature) return false;\n\n        if (edit.name) {\n          leadsTo = tripwire.systems[otherSignature.systemID] ? \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+edit.name+\"</a>\" : edit.name;\n        } else if (tripwire.aSigSystems[otherSignature.systemID]) {\n            leadsTo = tripwire.aSigSystems[otherSignature.systemID];\n        } else if (tripwire.systems[otherSignature.systemID]) {\n            leadsTo = \"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+tripwire.systems[otherSignature.systemID].name+\"</a>\";\n        } else {\n            leadsTo = \"\";\n        }\n\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+(wormhole[wormhole.parent+\"ID\"] == edit.id ? wormhole.type || \"\" : (wormhole.parent ? \"K162\" : \"\"))+\"</td>\"\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(leadsTo || \"\")+\"</td>\"\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+wormhole.life+\"</td>\"\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\n            + \"</tr>\";\n\n        var tr = $(row);\n    } else {\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+(edit.signatureID ? edit.signatureID.substring(0, 3)+\"-\"+(edit.signatureID.substring(3, 6) || \"###\") : \"???-###\")+\"</td>\"\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+edit.type+\"</td>\"\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(edit.name?linkSig(edit.name):'')+\"</td>\"\n            + \"</tr>\";\n\n        var tr = $(row);\n    }\n\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\n\n    // Destroy the pervious countdown to prevent errors on a non-existant DOM element\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").find('span[data-age]').countdown(\"destroy\");\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").replaceWith(tr);\n\n    $(\"#sigTable\").trigger(\"update\");\n    // Update counter\n    if (wormhole.life == \"critical\") {\n        $(tr).find('span[data-age]').countdown({until: moment.utc(edit.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\n            .addClass('critical');\n    } else {\n        $(tr).find('span[data-age]').countdown({since: moment.utc(edit.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\n    }\n\n    $(tr).effect(\"pulsate\");\n}\n","tripwire.esi = function() {\r\n    var baseUrl = \"https://esi.evetech.net\";\r\n    var userAgent = \"Tripwire Client \" + tripwire.version + \" (\" + window.location.hostname + \") - \" + window.navigator.userAgent;\r\n    var locationTimer, shipTimer, onlineTimer;\r\n    this.esi.connection = true;\r\n    this.esi.characters = {};\r\n    this.esi.oauth = { subject: \"\", accessToken: \"\"};\r\n\r\n    var scopeError = function(characterID) {\r\n        $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").find(\".alert\").show();\r\n    }\r\n\r\n\tvar isExpired = function(tokenExpire) {\r\n\t\treturn moment.utc(tokenExpire).subtract(5, \"minutes\").isBefore(moment());\r\n\t}\r\n\r\n    this.esi.location = function() {\r\n        clearTimeout(locationTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (isExpired(character.tokenExpire)) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            const xhr = $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/location/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, jqXHR) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.locationDate = moment(jqXHR.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.systemID != data.solar_system_id) {\r\n                        character.systemID = data.solar_system_id || null;\r\n                        character.systemName = tripwire.systems[data.solar_system_id] ? tripwire.systems[data.solar_system_id].name : null;\r\n\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".system\").html(character.systemName || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.stationID != data.station_id) {\r\n                        character.stationID = data.station_id || null;\r\n\r\n                        if (data.station_id) {\r\n                            tripwire.esi.stationLookup(data.station_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.stationName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".station\").html(data.name.substring(0, 17) + \"...\" || \"&nbsp;\").attr(\"data-tooltip\", data.name);\r\n                                    Tooltips.attach($(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"'] .station[data-tooltip]\"));\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.reference] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.stationName = null;\r\n                            // $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".station\").html(\"&nbsp;\").attr(\"data-tooltip\", \"&nbsp;\");\r\n                            Tooltips.detach($(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"'] .station[data-tooltip]\"));\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n\r\n                    if (options.tracking.active == this.characterID) {\r\n                        tripwire.EVE(tripwire.esi.characters[options.tracking.active]);\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status, jqXHR) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n            xhr.always(function(){\r\n                const warn = xhr.getResponseHeader('warning');\r\n                if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n            });\r\n        }\r\n\r\n        locationTimer = setTimeout(\"tripwire.esi.location()\", 5000);\r\n    }\r\n\r\n    this.esi.ship = function() {\r\n        clearTimeout(shipTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (isExpired(character.tokenExpire)) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            const xhr = $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/ship/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, jqXHR) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.shipDate = moment(jqXHR.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.shipID != data.ship_item_id) {\r\n                        character.shipID = data.ship_item_id || null;\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipName != data.ship_name) {\r\n                        character.shipName = data.ship_name || null;\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".shipname\").html(data.ship_name || \"&nbsp;\");\r\n\r\n                        // Send to Tripwire server on next refresh call\r\n                        tripwire.data.tracking[this.characterID] = {\r\n                            characterID: character.characterID,\r\n                            characterName: character.characterName,\r\n                            systemID: character.systemID,\r\n                            systemName: character.systemName,\r\n                            stationID: character.stationID,\r\n                            stationName: character.stationName,\r\n                            shipID: character.shipID,\r\n                            shipName: character.shipName,\r\n                            shipTypeID: character.shipTypeID,\r\n                            shipTypeName: character.shipTypeName};\r\n                    }\r\n\r\n                    if (character.shipTypeID != data.ship_type_id) {\r\n                        character.shipTypeID = data.ship_type_id || null;\r\n\r\n                        if (data.ship_type_id) {\r\n                            tripwire.esi.typeLookup(data.ship_type_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.shipTypeName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".ship\").html(data.name || \"&nbsp;\");\r\n\r\n                                    // Send to Tripwire server on next refresh call\r\n                                    tripwire.data.tracking[this.reference] = {\r\n                                        characterID: character.characterID,\r\n                                        characterName: character.characterName,\r\n                                        systemID: character.systemID,\r\n                                        systemName: character.systemName,\r\n                                        stationID: character.stationID,\r\n                                        stationName: character.stationName,\r\n                                        shipID: character.shipID,\r\n                                        shipName: character.shipName,\r\n                                        shipTypeID: character.shipTypeID,\r\n                                        shipTypeName: character.shipTypeName};\r\n                                });\r\n                        } else {\r\n                            character.shipTypeName = null;\r\n                            $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".ship\").html(\"&nbsp;\");\r\n\r\n                            // Send to Tripwire server on next refresh call\r\n                            tripwire.data.tracking[this.characterID] = {\r\n                                characterID: character.characterID,\r\n                                characterName: character.characterName,\r\n                                systemID: character.systemID,\r\n                                systemName: character.systemName,\r\n                                stationID: character.stationID,\r\n                                stationName: character.stationName,\r\n                                shipID: character.shipID,\r\n                                shipName: character.shipName,\r\n                                shipTypeID: character.shipTypeID,\r\n                                shipTypeName: character.shipTypeName};\r\n                        }\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status, jqXHR) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n            xhr.always(function(){\r\n                const warn = xhr.getResponseHeader('warning');\r\n                if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n            });\r\n\r\n        }\r\n\r\n        shipTimer = setTimeout(\"tripwire.esi.ship()\", 5000);\r\n    }\r\n\r\n    this.esi.online = function() {\r\n        clearTimeout(onlineTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            tripwire.esi.characterStatus(character.characterID, character)\r\n                .done(function(data) {\r\n                    if (data.online) {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"critical\").addClass(\"stable\");\r\n                    } else {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                    }\r\n                }).fail(function(data) {\r\n                    if (data && data.status == 403) {\r\n                        scopeError(this.reference.characterID);\r\n                    }\r\n                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                });\r\n        }\r\n\r\n        onlineTimer = setTimeout(\"tripwire.esi.online()\", 60000);\r\n    }\r\n\r\n    this.esi.typeLookup = function(typeID, reference) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v3/universe/types/\"+ typeID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.stationLookup = function(stationID, reference) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/universe/stations/\"+ stationID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.setDestination = function(destinationID, characterID, clear_waypoints, beginning) {\r\n        clear_waypoints = clear_waypoints ? clear_waypoints : false;\r\n        beginning = beginning ? beginning : false;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/ui/autopilot/waypoint/?\" + $.param({destination_id: destinationID, clear_other_waypoints: clear_waypoints, add_to_beginning: beginning}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.showInfo = function(targetID, characterID) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v1/ui/openwindow/information/?\" + $.param({target_id: targetID}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.characterStatus = function(characterID, reference) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/characters/\" + characterID + \"/online/?\" + $.param({\"token\": tripwire.esi.characters[characterID].accessToken, \"user_agent\": userAgent}),\r\n            // headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.eveStatus = function() {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v1/status/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.idLookup = function(eveIDs) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/universe/names/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"POST\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            processData: false,\r\n            data: JSON.stringify(eveIDs)\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.characterLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/latest/characters/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.corporationLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v4/corporations/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.allianceLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v3/alliances/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.search = function(searchString, categories, strict) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/latest/characters/\" + tripwire.esi.oauth.subject + \"/search/?\" + $.param({\"user_agent\": userAgent}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.oauth.accessToken},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            data: {\"search\": searchString, \"categories\": categories, \"strict\": strict}\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.universeJumps = function() {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v1/universe/system_jumps/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.universeKills = function() {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/universe/system_kills/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    // Wrapper to make lookups easier\r\n    this.esi.fullLookup = function(eveIDs) {\r\n        var promise = $.Deferred();\r\n\r\n        tripwire.esi.idLookup(eveIDs)\r\n            .done(function(data) {\r\n                for (item in data) {\r\n                    if (data[item].category == \"character\") {\r\n                        tripwire.esi.characterLookup(data[item].id, data[item], false)\r\n                            .done(function(characterData) {\r\n                                $.extend(data[item], characterData);\r\n                                tripwire.esi.corporationLookup(characterData.corporation_id, this.reference, false)\r\n                                    .done(function(corporationData) {\r\n                                        data[item].corporation = corporationData;\r\n                                        if (corporationData.alliance_id) {\r\n                                            tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                                .done(function(allianceData) {\r\n                                                    data[item].alliance = allianceData;\r\n                                                });\r\n                                        }\r\n                                    });\r\n                            });\r\n                    } else if (data[item].category == \"corporation\") {\r\n                        tripwire.esi.corporationLookup(data[item].id, data[item], false)\r\n                            .done(function(corporationData) {\r\n                                $.extend(data[item], corporationData);\r\n                                if (corporationData.alliance_id) {\r\n                                    tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                        .done(function(allianceData) {\r\n                                            data[item].alliance = allianceData;\r\n                                        });\r\n                                }\r\n                            })\r\n                    }\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise;\r\n    }\r\n\r\n    // Parse main account oauth information out of refresh data. This is used\r\n    // to make authenticated ESI requests for enpoints that are not specific to\r\n    // tracking characters, e.g., mask access management.\r\n    this.esi.parseOauth = function(data) {\r\n        const _data = data || {}\r\n        tripwire.esi.oauth = {\r\n            subject: _data.subject,\r\n            accessToken: _data.accessToken\r\n        };\r\n    }\r\n\r\n    this.esi.parse = function(characters) {\r\n        for (characterID in tripwire.esi.characters) {\r\n            if (!(characterID in characters)) {\r\n                delete tripwire.esi.characters[characterID];\r\n                $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n                if (options.tracking.active == characterID) {\r\n                    tripwire.EVE(false, true);\r\n                    $(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n                }\r\n            }\r\n        }\r\n\r\n        for (characterID in characters) {\r\n            if (options.tracking.active == \"new\") {\r\n                options.tracking.active = characterID;\r\n            }\r\n\r\n            if (!(characterID in tripwire.esi.characters)) {\r\n                var $clone = $(\"#tracking-clone\").clone();\r\n                $clone.attr(\"data-characterid\", characterID);\r\n                $clone.find(\".avatar img\").attr(\"src\", \"https://image.eveonline.com/Character/\"+ characterID +\"_32.jpg\");\r\n                $clone.find(\".name\").html(characters[characterID].characterName);\r\n                $clone.removeAttr(\"id\");\r\n                $clone.removeClass(\"hidden\");\r\n                $clone.addClass(\"tracking-clone\");\r\n\r\n                if (options.tracking.active == characterID) {\r\n                    $clone.addClass(\"active\");\r\n                    $(\"#removeESI\").removeAttr(\"disabled\");\t\t\t\t}\r\n\r\n                $(\"#tracking\").append($clone);\r\n                // Tooltips.attach($clone.find(\"[data-tooltip]\"));\r\n            }\r\n\r\n            tripwire.esi.characters[characterID] = characters[characterID];\r\n        }\r\n\r\n        tripwire.esi.ship();\r\n        tripwire.esi.location();\r\n        tripwire.esi.online();\r\n    }\r\n}\r\ntripwire.esi();\r\n","// Handles data from EVE in-game data\ntripwire.EVE = function(EVE, characterChange) {\n    var systemChange = this.client.EVE && this.client.EVE.systemChange || false;\n\n    if (EVE) {\n        // Automapper\n        if (!characterChange) {\n            // Did the system change or did it previously and we have yet to try an autoMapper call?\n            if ((this.client.EVE && this.client.EVE.systemID != EVE.systemID) || systemChange == true) {\n                systemChange = true;\n\n                // Check if location was updated after the last ship update\n                // if (moment(EVE.locationDate).isAfter(moment(this.client.EVE.shipDate))) {\n                    systemChange = false;\n                    tripwire.autoMapper(this.client.EVE.systemID, EVE.systemID);\n                // }\n            }\n        }\n\n        // System follower\n        if (!characterChange && options.buttons.follow && (this.client.EVE && this.client.EVE.systemID != EVE.systemID) && $(\".ui-dialog:visible\").length == 0) {\n            tripwire.systemChange(EVE.systemID);\n        }\n\n        if (!$(\"#search\").hasClass(\"active\")) {\n            $(\"#currentSpan\").show();\n        }\n\n        // Enable auto-mapper\n        $(\"#toggle-automapper\").removeClass(\"disabled\");\n\n        // Update current system\n        if (EVE.systemID) {\n            // add system to Leads To dropdown\n            if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"addToSelect\", tripwire.systems[EVE.systemID].name);\n            }\n            $(\"#EVEsystem\").html(tripwire.systems[EVE.systemID].name).attr(\"href\", \".?system=\"+ tripwire.systems[EVE.systemID].name);\n        }\n    } else {\n        // Update current system\n        $(\"#EVEsystem\").html(\"\");\n        $(\"#currentSpan\").hide();\n        // Disable automapper\n        $(\"#toggle-automapper\").addClass(\"disabled\");\n        // remove system from Leads To dropdown\n        if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\n            $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\n        }\n    }\n\n    this.client.EVE = {\n        characterID: EVE.characterID,\n        characterName: EVE.characterName,\n        systemID: EVE.systemID,\n        systemName: EVE.systemName,\n        shipTypeID: EVE.shipTypeID,\n        shipTypeName: EVE.shipTypeName,\n        stationID: EVE.stationID,\n        stationName: EVE.stationName,\n        locationDate: EVE.locationDate,\n        shipDate: EVE.shipDate,\n        systemChange: systemChange\n    };\n}\n","tripwire.parse = function(server, mode) {\r\n    var data = $.extend(true, {}, server);\r\n\r\n    var updateSignatureTable = false;\r\n\tconst newSigsInSystem = { };\r\n\r\n    if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout != true)) {\r\n        if (options.masks.active != \"273.0\") {\r\n            for (var key in data.signatures) {\r\n                if (data.signatures[key].mask == \"273.0\") {\r\n                    delete data.signatures[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (mode == 'refresh') {\r\n        // preserve client.EVE across refresh otherwise tracking/automapper will be confused\r\n        var EVE = this.client.EVE;\r\n        this.client = server;\r\n        this.client.EVE = EVE;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n\t\t\tnewSigsInSystem[key] = data.signatures[key];\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            // Check for differences\r\n            if (!tripwire.signatures.list[key]) {\r\n\t\t\t\ttripwire.signatures.list[key] = data.signatures[key];\t// To reduce race condition chance\r\n                this.addSig(data.signatures[key], {animate: true}, disabled);\r\n                updateSignatureTable = true;\r\n            } else if (tripwire.signatures.list[key].modifiedTime !== data.signatures[key].modifiedTime) {\r\n                var edit = false;\r\n                for (column in data.signatures[key]) {\r\n                    if (data.signatures[key][column] != tripwire.signatures.list[key][column] && column != \"editing\") {\r\n                        edit = true;\r\n                    }\r\n                }\r\n\r\n                if (edit) {\r\n                    this.editSig(data.signatures[key], disabled);\r\n                } else {\r\n                    // this.sigEditing(data.signatures[key]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sigs needing removal\r\n        for (var key in tripwire.signatures.list) {\r\n            if (!data.signatures[key]) {\r\n                this.deleteSig(key);\r\n            }\r\n        }\r\n    } else if (mode == 'init' || mode == 'change') {\r\n        this.client = server;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n\t\t\tnewSigsInSystem[key] = data.signatures[key];\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\t\t\t\r\n\t\t\tif(!tripwire.signatures.list[key]) {\r\n\t\t\t\tthis.addSig(data.signatures[key], {animate: false}, disabled);\r\n\t\t\t\tupdateSignatureTable = true;\r\n\t\t\t}\r\n            if (data.signatures[key].editing) {\r\n                this.sigEditing(data.signatures[key]);\r\n            }\r\n        }\r\n    } else { return; }\t// unknown type of parse request so do nothing\r\n\r\n    if (updateSignatureTable) {\r\n        $(\"#sigTable\").trigger(\"update\");\r\n    }\r\n    tripwire.signatures.list = data.signatures;\r\n\ttripwire.signatures.currentSystem = newSigsInSystem;\r\n\t\t\r\n    // set the sig count in the UI\r\n    var signatureCount = 0;\r\n    $.map(data.signatures, function(signature) {signature.systemID == viewingSystemID ? signatureCount++ : null;});\r\n    $(\"#signature-count\").html(signatureCount);\r\n}\r\n\r\n/** Find if there is an unknown return sig. The markup is always generated (in addSignature.js) */\r\ntripwire.updateReturnStatus = function() {\r\n\tconst inSigId = $(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']:not(.calc)\").attr('data-insigid');\r\n\tconst wormholeId = $(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']:not(.calc)\").attr('data-sigid');\r\n\tconst wormhole = tripwire.client.wormholes[wormholeId] || {};\r\n\t// One of the two ends should be in this system, In sig will be the wrong end, so find the other end\r\n\tconst returnSigId = wormhole.initialID == inSigId ? wormhole.secondaryID : wormhole.initialID;\r\n\ttripwire.signatures.returnSig = tripwire.signatures.list[returnSigId];\r\n\tconst needReturn = tripwire.signatures.returnSig && (tripwire.signatures.returnSig.signatureID == '???' || tripwire.signatures.returnSig.signatureID == '' || tripwire.signatures.returnSig.signatureID === null || tripwire.signatures.returnSig.signatureID === undefined);\r\n\tdocument.getElementById('sigTableWrapper').className = needReturn ? 'return-visible' : 'return-invisible';\t\r\n}","// Handles pasting sigs from EVE\r\ntripwire.pasteSignatures = function() {\r\n    var processing = false;\r\n\r\n    var rowParse = function(row) {\r\n        var scanner = {};\r\n        var columns = row.split(\"\t\"); // Split by tab\r\n        var validScanGroups = [\r\n            // English (en-us)\r\n            \"Cosmic Signature\",\r\n            \"Cosmic Anomaly\",\r\n\r\n            // French (fr)\r\n            \"Signature cosmique\",\r\n            \"Anomalie cosmique\",\r\n\r\n            // German (de)\r\n            \"Kosmische Anomalie\",\r\n            \"Kosmische Signatur\",\r\n\r\n            // Japanese (ja)\r\n            \"宇宙の特異点\",\r\n            \"宇宙のシグネチャ\",\r\n\r\n            // Korean (ko)\r\n            \"코즈믹 시그니처\",\r\n            \"코즈믹 어노말리\",\r\n\r\n            // Russian (ru)\r\n            \"Скрытый сигнал\",\r\n            \"Космическая аномалия\",\r\n        ];\r\n\r\n        var validTypes = {\r\n            // English (en-us)\r\n            \"Combat Site\": \"Combat\",\r\n            \"Data Site\": \"Data\",\r\n            \"Gas Site\": \"Gas\",\r\n            \"Ore Site\": \"Ore\",\r\n            \"Relic Site\": \"Relic\",\r\n            \"Wormhole\": \"Wormhole\",\r\n\r\n            // French (fr)\r\n            \"Site de combat\": \"Combat\",\r\n            \"Site de données\": \"Data\",\r\n            \"Site de collecte de gaz\": \"Gas\",\r\n            \"Site de minerai\": \"Ore\",\r\n            \"Site de reliques\": \"Relic\",\r\n            \"Trou de ver\": \"Wormhole\",\r\n\r\n            // German (de)\r\n            \"Kampfgebiet\": \"Combat\",\r\n            \"Datengebiet\": \"Data\",\r\n            \"Gasgebiet\": \"Gas\",\r\n            \"Mineraliengebiet\": \"Ore\",\r\n            \"Reliktgebiet\": \"Relic\",\r\n            \"Wurmloch\": \"Wormhole\",\r\n\r\n            // Japanese (ja)\r\n            \"戦闘サイト\": \"Combat\",\r\n            \"データサイト\": \"Data\",\r\n            \"ガスサイト\": \"Gas\",\r\n            \"鉱石サイト\": \"Ore\",\r\n            \"遺物サイト\": \"Relic\",\r\n            \"ワームホール\": \"Wormhole\",\r\n\r\n            // Korean (ko)\r\n            \"전투 사이트\": \"Combat\",\r\n            \"데이터 사이트\": \"Data\",\r\n            \"가스 사이트\": \"Gas\",\r\n            \"채광 사이트\": \"Ore\",\r\n            \"유물 사이트\": \"Relic\",\r\n            \"웜홀\": \"Wormhole\",\r\n\r\n            // Russian (ru)\r\n            \"Боевой район\": \"Combat\",\r\n            \"Информационный район\": \"Data\",\r\n            \"Газовый район\": \"Gas\",\r\n            \"Астероидный район\": \"Ore\",\r\n            \"Археологический район\": \"Relic\",\r\n            \"Червоточина\": \"Wormhole\",\r\n        };\r\n\r\n        for (var x in columns) {\r\n            if (columns[x].match(/^([A-Z]{3}[-]\\d{3})$/)) {\r\n                scanner.id = columns[x].split(\"-\");\r\n                continue;\r\n            }\r\n\r\n            if (columns[x].match(/(\\d([.|,]\\d)?[ ]?(%))/) || columns[x].match(/(\\d[.|,]?\\d+\\s?(UA|AU|AE|km|m|а.е.|км|м))/i)) { // Exclude scan % || AU\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validScanGroups) != -1) {\r\n                scanner.scanGroup = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if (validTypes[columns[x]]) {\r\n                scanner.type = validTypes[columns[x]];\r\n                continue;\r\n            }\r\n\r\n            if (columns[x] != \"\") {\r\n                scanner.name = columns[x].trim();\r\n            }\r\n        }\r\n\r\n        if (!scanner.id || scanner.id.length !== 2) {\r\n            return false;\r\n        }\r\n\r\n        return scanner;\r\n    }\r\n\r\n    this.pasteSignatures.parsePaste = function(paste) {\r\n        var paste = paste.split(\"\\n\");\r\n        var payload = {\"signatures\": {\"add\": [], \"update\": []}, \"systemID\": viewingSystemID};\r\n        var undo = [];\r\n        processing = true;\r\n\r\n        for (var i in paste) {\r\n            var scanner = rowParse(paste[i]);\r\n\r\n            if (scanner.id) {\r\n                var signature = $.map(tripwire.client.signatures, function(signature) { if (signature.signatureID && signature.signatureID.toUpperCase() == scanner.id[0] + scanner.id[1]) return signature; })[0];\r\n                if (signature) {\r\n                    // Update signature (only non-wormholes can be updated to a wormhole)\r\n                    if (scanner.type == \"Wormhole\" && signature.type != \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id || null,\r\n                                \"type\": wormhole.type || null,\r\n                                \"life\": wormhole.life || \"stable\",\r\n                                \"mass\": wormhole.mass || \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id,\r\n                                    \"signatureID\": signature.signatureID,\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": signature.name\r\n                                },\r\n                                {\r\n                                    \"id\": otherSignature.id || null,\r\n                                    \"signatureID\": otherSignature.signatureID || null,\r\n                                    \"systemID\": otherSignature.systemID || null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": otherSignature.name\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        if (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[otherSignature.id]]});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t}\r\n                    // Make sure we are only updating when we have new info (we never turn wormholes into regular signatures)\r\n                    } else if (signature.type != \"wormhole\" && ((scanner.type && scanner.type.toLowerCase() != signature.type) || (scanner.name && scanner.name != signature.name))) {\r\n                        payload.signatures.update.push({\r\n                            \"id\": signature.id,\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                        undo.push(tripwire.client.signatures[signature.id]);\r\n                    }\r\n                } else {\r\n                    // Add signature\r\n                    if (scanner.type == \"Wormhole\") {\r\n                        payload.signatures.add.push({\r\n                            \"wormhole\": {\r\n                                \"type\": null,\r\n                                \"parent\": \"initial\",\r\n                                \"life\": \"stable\",\r\n                                \"mass\": \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                },\r\n                                {\r\n                                    \"signatureID\": null,\r\n                                    \"systemID\": null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                }\r\n                            ]\r\n                        });\r\n                    } else {\r\n                        payload.signatures.add.push({\r\n                            \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (payload.signatures.add.length || payload.signatures.update.length) {\r\n            var success = function(data) {\r\n                if (data.resultSet && data.resultSet[0].result == true) {\r\n                    $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                    if (data.results) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                        }\r\n                    }\r\n\r\n                    if (undo.length) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n\t\t\t\t\t\t} else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n\t\t\t\t\t\t}\r\n                    }\r\n\r\n                    sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                }\r\n            }\r\n\r\n            var always = function(data) {\r\n                processing = false;\r\n            }\r\n\r\n            tripwire.refresh('refresh', payload, success, always);\r\n        } else {\r\n            processing = false;\r\n        }\r\n    }\r\n\r\n    this.pasteSignatures.init = function() {\r\n        $(document).keydown(function(e)\t{\r\n            if ((e.metaKey || e.ctrlKey) && (e.keyCode == 86 || e.keyCode == 91) && !processing) {\r\n                //Abort - user is in input or textarea\r\n                if ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n                $(\"#clipboard\").focus();\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"click\", \"#fullPaste\", function(e) {\r\n            e.preventDefault();\r\n\r\n            var paste = $(this).data(\"paste\").split(\"\\n\");\r\n            var pasteIDs = [];\r\n            var removes = [];\r\n            var undo = [];\r\n\r\n            for (var i in paste) {\r\n                if (scan = rowParse(paste[i])) {\r\n                    pasteIDs.push((scan.id[0] + scan.id[1]).toLowerCase());\r\n                }\r\n            }\r\n\r\n            for (var i in tripwire.client.signatures) {\r\n                var signature = tripwire.client.signatures[i];\r\n\r\n                if (signature.systemID == viewingSystemID && signature.signatureID && $.inArray(signature.signatureID.toLowerCase(), pasteIDs) === -1 && signature.signatureID !== \"???\") {\r\n                    if (signature.type == \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        if (wormhole.type !== \"GATE\") {\r\n                            removes.push(wormhole);\r\n                            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, otherSignature]});\r\n                        }\r\n                    } else {\r\n                        removes.push(signature.id);\r\n                        undo.push(signature);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (removes.length > 0) {\r\n                var payload = {\"signatures\": {\"remove\": removes}};\r\n\r\n                var success = function(data) {\r\n                    if (data.resultSet && data.resultSet[0].result == true) {\r\n                        $(\"#undo\").removeClass(\"disabled\");\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n                        }\r\n\r\n                        sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                    }\r\n                }\r\n\r\n                tripwire.refresh('refresh', payload, success);\r\n            }\r\n        });\r\n\r\n        $(\"#clipboard\").on(\"paste\", function(e) {\r\n            e.preventDefault();\r\n            var paste = window.clipboardData ? window.clipboardData.getData(\"Text\") : (e.originalEvent || e).clipboardData.getData('text/plain');\r\n\r\n            $(\"#clipboard\").blur();\r\n            Notify.trigger(\"Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)\");\r\n            $(\"#fullPaste\").data(\"paste\", paste);\r\n            tripwire.pasteSignatures.parsePaste(paste);\r\n        });\r\n    }\r\n\r\n    this.pasteSignatures.init();\r\n}\r\ntripwire.pasteSignatures();\r\n","tripwire.redo = function() {\n    if (tripwire.signatures.redo[viewingSystemID].length > 0) {\n        $(\"#redo\").addClass(\"disabled\");\n        var lastIndex = tripwire.signatures.redo[viewingSystemID].length -1;\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\n\n        var redoItem = tripwire.signatures.redo[viewingSystemID][lastIndex];\n        var undo = $.map(redoItem.signatures, function(signature) {\n            // grab the current signature so we can restore the way it is now\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\n                // it was a wormhole and still is\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\n                // it was a regular signature but is now a wormhole\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\n                // it was a wormhole but is now a regular signature\n                return tripwire.client.signatures[signature.signatures[0].id];\n            } else {\n                // it was a regular signature and still is\n                return tripwire.client.signatures[signature.id];\n            }\n        });\n\n        switch(redoItem.action) {\n            case \"add\":\n                data.signatures.add = data.signatures.add.concat(redoItem.signatures);\n                break;\n            case \"remove\":\n                data.signatures.remove = data.signatures.remove.concat($.map(redoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\n                break;\n            case \"update\":\n                data.signatures.update = data.signatures.update.concat(redoItem.signatures);\n                break;\n        }\n\n        var success = function(data) {\n            if (data.resultSet && data.resultSet[0].result == true) {\n                tripwire.signatures.redo[viewingSystemID].pop();\n\n                $(\"#undo\").removeClass(\"disabled\");\n                if (viewingSystemID in tripwire.signatures.undo) {\n                    if (redoItem.action == \"add\") {\n                        // we are adding new signatures we removed so we need the new ids\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": data.results});\n                    } else if (redoItem.action == \"update\") {\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": undo});\n                    } else {\n                        tripwire.signatures.undo[viewingSystemID].push({action: redoItem.action, signatures: redoItem.signatures});\n                    }\n                } else {\n                    if (redoItem.action == \"add\") {\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": data.results}];\n                    } else if (redoItem.action == \"update\") {\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": undo}];\n                    } else {\n                        tripwire.signatures.undo[viewingSystemID] = [{action: redoItem.action, signatures: redoItem.signatures}];\n                    }\n                }\n\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\n            }\n        }\n\n        var always = function(data) {\n            if (tripwire.signatures.redo[viewingSystemID].length > 0) {\n                $(\"#redo\").removeClass(\"disabled\");\n            }\n        }\n\n        tripwire.refresh('refresh', data, success, always);\n    }\n}\n","// Handles pulling TQ status & player count\r\ntripwire.serverStatus = function() {\r\n    this.data;\r\n    this.timer;\r\n\r\n    clearTimeout(tripwire.serverStatus.timer);\r\n\r\n    tripwire.esi.eveStatus()\r\n        .always(function(data) {\r\n            if (data && data.players && data.players > 0) {\r\n                if (!tripwire.serverStatus.data || tripwire.serverStatus.data.players !== data.players) {\r\n                    $('#serverStatus').html(\"<span class='\"+(data.players > 0 ? 'stable' : 'critical')+\"'>TQ</span>: \"+Intl.NumberFormat().format(data.players));\r\n\r\n                    if (tripwire.serverStatus.data) {\r\n                        $(\"#serverStatus\").effect('pulsate', {times: 5});\r\n                    }\r\n                }\r\n\r\n                tripwire.serverStatus.data = data;\r\n            } else {\r\n                $('#serverStatus').html(\"<span class='critical'>TQ</span>\");\r\n            }\r\n\r\n            tripwire.serverStatus.timer = setTimeout(\"tripwire.serverStatus();\", 15000);\r\n        });\r\n}\r\ntripwire.serverStatus();\r\n\r\ntripwire.updateServerTime = function() {\r\n\tdocument.getElementById('serverTime').innerText = moment.utc().format('HH:mm')\r\n};\r\nsetInterval(tripwire.updateServerTime, 5000);\r\ntripwire.updateServerTime();","tripwire.sync = function(mode, data, successCallback, alwaysCallback) {\r\n    var data = typeof(data) === \"object\" ? $.extend(true, {}, data) : {};\r\n\r\n    // Grab any pending changes\r\n    $.extend(true, data, tripwire.data);\r\n\r\n    // Remove old timer to prevent multiple\r\n    if (this.timer) clearTimeout(this.timer);\r\n    if (this.xhr) {\r\n\t\tconsole.log('Awaiting existing XHR ' + this.xhr.data.mode + ': ', this.xhr);\r\n\t\ttripwire.data = data;\r\n\t\tthis.timer = setTimeout(function() { tripwire.sync(mode, data, successCallback, alwaysCallback); }, 50);\r\n\t\treturn false;\r\n\t}\r\n\r\n    if (mode == 'refresh' || mode == 'change') {\r\n        data.signatureCount = tripwire.serverSignatureCount;\r\n        data.signatureTime = Object.maxTime(this.client.signatures, \"modifiedTime\");\r\n\r\n        data.flareCount = chain.data.flares ? chain.data.flares.flares.length : 0;\r\n        data.flareTime = chain.data.flares ? chain.data.flares.last_modified : 0;\r\n\r\n        data.commentCount = Object.keys(this.comments.data||{}).length;\r\n        data.commentTime = Object.maxTime(this.comments.data, \"modified\");\r\n\r\n        data.activity = this.activity;\r\n    } else {\r\n        // Expand Tripwire with JSON data from EVE Data Dump and other static data\r\n        $.extend(this, appData);\r\n\r\n        this.aSystems = $.map(this.systems, function(system) { return system.name; });\r\n        this.aSigSystems = [\"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Class-1\", \"Class-2\", \"Class-3\", \"Class-4\", \"Class-5\", \"Class-6\", \"Class-13\", \"Triglavian\"];\r\n        $.merge(this.aSigSystems, this.aSystems.slice());\r\n\r\n        $(\".systemsAutocomplete\").inlinecomplete({source: this.aSystems, maxSize: 10, delay: 0});\r\n    }\r\n\r\n    data.mode = mode != \"init\" ? \"refresh\" : \"init\";\r\n    data.systemID = viewingSystemID;\r\n    data.systemName = viewingSystem;\r\n    data.instance = tripwire.instance;\r\n    data.version = tripwire.version;\r\n\r\n    this.xhr = $.ajax({\r\n        url: \"refresh.php\",\r\n        data: data,\r\n        type: \"POST\",\r\n        dataType: \"JSON\",\r\n        cache: false\r\n    }).done(function(data) {\r\n        if (data) {\r\n            tripwire.server = data;\r\n            if(data.signatures) { // Save this count before we delete entries\r\n                tripwire.serverSignatureCount = Object.keys(data.signatures||{}).length;\r\n            }\r\n\r\n            if (data.wormholes) {\r\n                // Purge bad wormhole signatures\r\n                var wormholeInitialIDs = {};\r\n                var wormholeSecondaryIDs = {};\r\n                Object.values(data.wormholes).forEach(function (wh) {\r\n                    wormholeInitialIDs[parseInt(wh.initialID)] = wh.id;\r\n                    wormholeSecondaryIDs[parseInt(wh.secondaryID)] = wh.id;\r\n                })\r\n                for (var i in data.signatures) {\r\n                  if (data.signatures[i].type == \"wormhole\") {\r\n                    var id = data.signatures[i].id;\r\n                    if (wormholeInitialIDs[id] === undefined && wormholeSecondaryIDs[id] === undefined) {\r\n                      delete data.signatures[i];\r\n                    }\r\n                  }\r\n                }\r\n            }\r\n\r\n            if (data.esi) {\r\n                tripwire.esi.parse(data.esi);\r\n            }\r\n\r\n            if (data.oauth) {\r\n                tripwire.esi.parseOauth(data.oauth);\r\n            }\r\n\r\n            if (data.sync) {\r\n                tripwire.serverTime.time = new Date(data.sync);\r\n            }\r\n\r\n            if (data.signatures) {\r\n                tripwire.parse(data, mode);\r\n            }\r\n\r\n            if (data.comments) {\r\n                tripwire.comments.parse(data.comments);\r\n            }\r\n\r\n            if (data.wormholes || data.occupied || data.flares) {\r\n                tripwire.chainMap.parse({\"map\": data.wormholes || null, \"occupied\": data.occupied || null, \"flares\": data.flares || null});\r\n            } else if (chain.data.occupied && chain.data.occupied.length && !data.occupied) {\r\n                // send update to remove all occupied system indicators\r\n                tripwire.chainMap.parse({\"occupied\": []});\r\n            }\r\n\r\n\t\t\ttripwire.updateReturnStatus();\r\n\r\n            tripwire.active(data.activity);\r\n\r\n            if (data.notify && !$(\"#serverNotification\")[0]) Notify.trigger(data.notify, \"yellow\", false, \"serverNotification\");\r\n\t\t\t\r\n\t\t\t$('[data-command=ping]')[data.discord_integration ? 'show' : 'hide']();\r\n        }\r\n\r\n        tripwire.data = {tracking: {}, esi: {}};\r\n        successCallback ? successCallback(data) : null;\r\n    }).always(function(data, status) {\r\n        tripwire.timer = setTimeout(\"tripwire.refresh();\", tripwire.refreshRate);\r\n\r\n        alwaysCallback ? alwaysCallback(data) : null;\r\n\r\n        if (data.status == 403) {\r\n            window.location.href = \".\";\r\n        } else if (status != \"success\" && status != \"abort\" && tripwire.connected == true) {\r\n            tripwire.connected = false;\r\n            $(\"#ConnectionSuccess\").click();\r\n            Notify.trigger(\"Error syncing with server\", \"red\", false, \"connectionError\");\r\n        } else if (status == \"success\" && tripwire.connected == false) {\r\n            tripwire.connected = true;\r\n            $(\"#connectionError\").click();\r\n            Notify.trigger(\"Successfully reconnected with server\", \"green\", 5000, \"connectionSuccess\");\r\n        }\r\n\t\t\r\n\t\ttripwire.xhr = null;\r\n    });\r\n\tthis.xhr.data = data;\r\n\t\r\n    return true;\r\n}\r\ntripwire.sync(\"init\");\r\n","// Change the currently viewed system\r\ntripwire.systemChange = function(systemID, mode) {\r\n\tconst system = systemAnalysis.analyse(systemID);\r\n\t\t\r\n    if (mode != \"init\") {\r\n        $(\"#infoSecurity\").removeClass();\r\n        $(\"#infoStatics\").empty();\r\n\r\n        viewingSystem = system.name;\r\n        viewingSystemID = systemID;\r\n\r\n        // Reset activity\r\n        activity.refresh(true);\r\n\r\n        // Reset signatures\r\n        $(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n        $(\"#sigTable tbody\").empty();\r\n        $(\"#signature-count\").html(0);\r\n        tripwire.signatures.list = {};\r\n        tripwire.client.signatures = null;\r\n\r\n        // Reset chain map\r\n        chain.redraw();\r\n\r\n        // Reset comments\r\n        $(\"#notesWidget .content .comment:visible\").remove();\r\n        tripwire.comments.data = null;\r\n\r\n        // Change the URL & history\r\n        history.replaceState(null, null, \"?system=\"+viewingSystem);\r\n\r\n        tripwire.refresh(\"change\");\r\n    }\r\n\r\n    // Change the title\r\n    document.title = system.name + \" - \" + app_name;\r\n\r\n    $(\"#infoSystem\").text(system.name);\r\n\r\n    // Current system favorite\r\n    $.inArray(parseInt(viewingSystemID), options.favorites) != -1 ? $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\") : $(\"#system-favorite\").attr(\"data-icon\", \"star-empty\").removeClass(\"active\");\r\n\t\r\n    if (system.class) {\r\n        // Security\r\n        $(\"#infoSecurity\").html(\"<span class='wh pointer'>Class \" + system.class + \"</span>\");\r\n\r\n        // Effects\r\n        if (system.effect) {\r\n            var tooltip = \"<table cellpadding=\\\"0\\\" cellspacing=\\\"1\\\">\";\r\n            for (var x in tripwire.effects[system.effect]) {\r\n                var effect = tripwire.effects[system.effect][x].name;\r\n                var base = tripwire.effects[system.effect][x].base;\r\n                var bad = tripwire.effects[system.effect][x].bad;\r\n                var whClass = system.class > 6 ? 6 : system.class;\r\n                var modifier = 0;\r\n\r\n                switch (Math.abs(base)) {\r\n                    case 15:\r\n                        modifier = base > 0 ? 7 : -7;\r\n                        break;\r\n                    case 30:\r\n                        modifier = base > 0 ? 14 : -14;\r\n                        break;\r\n                    case 60:\r\n                        modifier = base > 0 ? 28 : -28;\r\n                        break;\r\n                }\r\n\r\n                tooltip += \"<tr><td>\" + effect + \"</td><td style=\\\"padding-left: 25px; text-align: right;\\\" class=\\\"\" + (bad ? \"critical\" : \"stable\") + \"\\\">\";\r\n                tooltip += base + (modifier * (whClass -1)) + \"%</td></tr>\";\r\n            }\r\n            tooltip += \"</table>\";\r\n            $(\"#infoSecurity\").append(\"&nbsp;<span class='pointer' data-tooltip='\" + tooltip + \"'>\" + system.effect + \"</span>\");\r\n        }\r\n\r\n        // Statics\r\n        for (var x in system.statics) {\r\n            var type = system.statics[x];\r\n            var wormhole = tripwire.wormholes[type];\r\n            var color = \"wh\";\r\n\r\n            switch (wormhole.leadsTo) {\r\n                case \"High-Sec\":\r\n                    color = \"hisec\";\r\n                    break;\r\n                case \"Low-Sec\":\r\n                    color = \"lowsec\";\r\n                    break;\r\n                case \"Null-Sec\":\r\n                    color = \"nullsec\";\r\n                    break;\r\n            }\r\n\r\n            $(\"#infoStatics\").append(\"<div><span class='\"+ color +\"'>&#9679;</span> <b>\"+ wormhole.leadsTo +\"</b> via <span class='\"+ color +\"'>\"+ type +\"</span></div>\");\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(\"&nbsp;\");\r\n    } else {\r\n        // Security\r\n\t\tconst securityText = {HS: 'High-Sec', LS: 'Low-Sec', NS: 'Null-Sec', 'Trig': 'Triglavian' }[system.systemTypeName];\r\n       $(\"#infoSecurity\").addClass(system.systemTypeClass).html(securityText + \" \" + system.baseSecurity.toFixed(2) + system.systemTypeModifiers.join(' '));\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(system.factionID ? tripwire.factions[system.factionID].name : \"&nbsp;\");\r\n\t\t\r\n\t\t// Route to favourites\r\n\t\tfor (var fi in options.favorites) {\r\n\t\t\tconst f = options.favorites[fi];\r\n\t\t\tconst path = guidance.findShortestPath(tripwire.map.shortest, f - 30000000, viewingSystemID - 30000000);\r\n\t\t\tif(path) { $('#infoStatics').append('<p><b><a href=\".?system=' + tripwire.systems[f].name + '\">' +tripwire.systems[f].name + '</a></b>: ' + chain.renderPath(path) + '</p>'); }\r\n\t\t}\r\n    }\r\n\r\n\tTooltips.attach($(\"#infoStatics [data-tooltip]\"));\r\n    Tooltips.attach($(\"#infoSecurity [data-tooltip]\"));\r\n\r\n    // Region\r\n    $(\"#infoRegion\").text(tripwire.regions[system.regionID].name);\r\n\r\n    // Info Links\r\n    $(\"#infoWidget .infoLink\").each(function() {\r\n        this.href = $(this).data(\"href\").replace(/\\$systemName/gi, system.name).replace(/\\$systemID/gi, systemID);\r\n    });\r\n\r\n    // Reset undo/redo\r\n    tripwire.signatures.undo[systemID] && tripwire.signatures.undo[systemID].length > 0 ? $(\"#undo\").removeClass(\"disabled\") : $(\"#undo\").addClass(\"disabled\");\r\n    tripwire.signatures.redo[systemID] && tripwire.signatures.redo[systemID].length > 0 ? $(\"#redo\").removeClass(\"disabled\") : $(\"#redo\").addClass(\"disabled\");\r\n\r\n    // Reset delete signature icon\r\n    $(\"#sigTable tr.selected\").length == 0 ? $(\"#signaturesWidget #delete-signature\").addClass(\"disabled\") : $(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n}\r\ntripwire.systemChange(viewingSystemID, \"init\");\r\n","var tutorial;\n\n// infoWidget\n$(\"#infoWidget .tutorial\").click(function() {\n    tutorial = introJs().setOptions({\n        showStepNumbers: false,\n        steps: [\n            {\n                element: document.querySelector(\"#infoWidget\"),\n                intro: \"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>\"\n            },\n            {\n                element: document.querySelector(\"#infoGeneral\"),\n                intro: \"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>\"\n            },\n            {\n                element: document.querySelector(\"#activityGraph\"),\n                intro: \"<p>This is the graph containing historical ship jump and kill information from the EVE API.</p><br/><p>This data is only available for K-Space systems and not wormhole systems.</p><br/><p>The EVE API updates this data each hour, so this graph will update itself at the top of every hour.</p>\"\n            },\n            {\n                element: $(\"#activityGraph svg > g > g:nth-child(5)\")[0],\n                intro: \"<p>Each category can be toggled by clicking these keys to drill down the graph into finer detail.</p>\"\n            },\n            {\n                element: document.querySelector(\"#activityGraphControls\"),\n                intro: \"<p>Select different lengths of historical data to adjust the graph to display more or less information.</p>\"\n            },\n            {\n                element: document.querySelector(\"#infoStatics\"),\n                intro: \"<p>If a wormhole system is selected, the publicaly known static wormholes will appear here.</p>\"\n            },\n            {\n                element: document.querySelector(\"#infoLinks\"),\n                intro: \"<p>These are some quick links to various sites for this specific system.</p>\"\n            },\n            {\n                element: document.querySelector(\"#system-favorite\"),\n                intro: \"<p>This toggles wether this is a 'favorite' system, orange is active.</p><br/><p>'Favorite' systems can be rendered in the chain map to be able to see how far away trade hub systems are from your wormhole chain K-Space exits.</p>\"\n            }\n        ]\n    }).start();\n});\n\n// signaturesWidget\n$(\"#signaturesWidget .tutorial\").click(function() {\n    tutorial = introJs().setOptions({\n        showStepNumbers: false,\n        steps: [\n            {\n                element: document.querySelector(\"#signaturesWidget\"),\n                intro: \"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>\"\n            },\n            {\n                element: document.querySelector(\"#add-signature\"),\n                intro: \"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>\"\n            },\n            {\n                element: document.querySelector(\"#delete-signature\"),\n                intro: \"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>\"\n            },\n            {\n                element: document.querySelector(\"#signature-count\"),\n                intro: \"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>\"\n            },\n            {\n                element: document.querySelector(\"#undo\"),\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>\"\n            },\n            {\n                element: document.querySelector(\"#redo\"),\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>\"\n            },\n            {\n                element: document.querySelector(\"#toggle-automapper\"),\n                intro: \"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>\"\n            },\n            {\n                element: document.querySelector(\"#sigTable\"),\n                intro: \"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>\"\n            }\n        ]\n    }).start();\n});\n\n// notesWidget\n$(\"#notesWidget .tutorial\").click(function(e) {\n    e.preventDefault();\n\n    tutorial = introJs().setOptions({\n        showStepNumbers: false,\n        exitOnEsc: false,\n        exitOnOverlayClick: false,\n        skipLabel: \"Abort\",\n        steps: [\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>\"\n            },\n            {\n                element: document.querySelector(\"#add-comment\"),\n                intro: \"<p>Now click the + icon to begin adding a new comment in this system (\" + viewingSystem + \").</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>Type some basic text now and click save.</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>Click on the <b>Edit</b> now on our comment.</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>\"\n            },\n            {\n                element: document.querySelector(\"#notesWidget\"),\n                intro: \"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>\"\n            }\n        ]\n    }).start();\n\n    tutorial.onchange(function(element) {\n        switch(tutorial._currentStep) {\n            case 1:\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\n\n                console.log(\"switch mask to private\");\n                tutorial.previousMask = options.masks.active;\n                options.masks.active = options.character.id + \".1\";\n                options.save();\n\n                tutorial.stepFunc = function() {\n                    setTimeout(function() {\n                        tutorial._options.steps[2].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\n\n                        tutorial.exiting = false;\n                        tutorial.exit().start().goToStep(3);\n                        tutorial.exiting = true;\n                    }, 200);\n                }\n\n                $(\"#notesWidget #add-comment\").on(\"click\", tutorial.stepFunc);\n                break;\n            case 2:\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\n                $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\n\n                tutorial.stepFunc = function() {\n                    tutorial.comment = $(this).closest(\".comment\");\n                    setTimeout(function() {\n                        tutorial._options.steps[3].element = tutorial.comment[0];\n                        tutorial._options.steps[4].element = tutorial.comment.find(\".commentSticky\")[0];\n                        tutorial._options.steps[5].element = tutorial.comment.find(\".commentControls\")[0];\n                        tutorial._options.steps[6].element = tutorial.comment.find(\".commentControls\")[0];\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\n\n                        tutorial.exiting = false;\n                        tutorial.exit().start().goToStep(4);\n                        tutorial.exiting = true;\n                    }, 200);\n                }\n\n                $(\"#notesWidget\").on(\"click\", \".commentSave\", tutorial.stepFunc);\n                break;\n            case 6:\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\n                $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\n\n                tutorial.stepFunc = function() {\n                    setTimeout(function() {\n                        tutorial._options.steps[7].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\n                        tutorial._options.steps[8].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\n\n                        tutorial.exiting = false;\n                        tutorial.exit().start().goToStep(8);\n                        tutorial.exiting = true;\n                    }, 200);\n                }\n\n                $(\"#notesWidget\").on(\"click\", \".commentEdit\", tutorial.stepFunc);\n                break;\n        }\n    });\n\n    tutorial.onexit(function() {\n        if (tutorial.exiting) {\n            $(\".commentCancel:visible\").click();\n            // delete the tutorial comment that was created\n            if (tutorial.comment) {\n                var data = {\"mode\": \"delete\", \"commentID\": tutorial.comment.data(\"id\")};\n\n                $.ajax({\n                    url: \"comments.php\",\n                    type: \"POST\",\n                    data: data,\n                    dataType: \"JSON\"\n                }).done(function(data) {\n                    if (data && data.result == true) {\n                        tutorial.comment.remove();\n                    }\n                });\n            }\n\n            if (tutorial.previousMask) {\n                setTimeout(function() {\n                    console.log(\"change mask back, delete comment\", tutorial.previousMask);\n                    options.masks.active = tutorial.previousMask;\n                    options.save();\n                }, 200);\n            }\n\n            // remove event listeners\n            $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\n            $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\n            $(\"#notesWidget\").off(\"click\", \".commentEdit\", tutorial.stepFunc);\n            $(\"#notesWidget\").off(\"click\", \".cke_toolgroup:has(.cke_button__toolbarswitch)\", tutorial.stepFunc);\n        }\n    });\n\n    tutorial.previousMask;\n    tutorial.comment;\n    tutorial.stepFunc;\n    tutorial.exiting = true;\n});\n","tripwire.undo = function() {\n    if (tripwire.signatures.undo[viewingSystemID].length > 0) {\n        $(\"#undo\").addClass(\"disabled\");\n        var lastIndex = tripwire.signatures.undo[viewingSystemID].length -1;\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\n\n        var undoItem = tripwire.signatures.undo[viewingSystemID][lastIndex];\n        var redo = $.map(undoItem.signatures, function(signature) {\n            // grab the current signature so we can restore the way it is now\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\n                // it was a wormhole and still is\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\n                // it was a regular signature but is now a wormhole\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\n                // it was a wormhole but is now a regular signature\n                return tripwire.client.signatures[signature.signatures[0].id];\n            } else {\n                // it was a regular signature and still is\n                return tripwire.client.signatures[signature.id];\n            }\n        });\n\n        switch(undoItem.action) {\n            case \"add\":\n                data.signatures.remove = data.signatures.remove.concat($.map(undoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\n                break;\n            case \"remove\":\n                data.signatures.add = data.signatures.add.concat(undoItem.signatures);\n                break;\n            case \"update\":\n                data.signatures.update = data.signatures.update.concat(undoItem.signatures);\n                break;\n        }\n\n        var success = function(data) {\n            if (data.resultSet && data.resultSet[0].result == true) {\n                tripwire.signatures.undo[viewingSystemID].pop();\n\n                $(\"#redo\").removeClass(\"disabled\");\n                if (viewingSystemID in tripwire.signatures.redo) {\n                    if (undoItem.action == \"remove\") {\n                        // we are adding new signatures we removed so we need the new ids\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": data.results});\n                    } else if (undoItem.action == \"update\") {\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": redo});\n                    } else {\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": undoItem.signatures});\n                    }\n                } else {\n                    if (undoItem.action == \"remove\") {\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": data.results}];\n                    } else if (undoItem.action == \"update\") {\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": redo}];\n                    } else {\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": undoItem.signatures}];\n                    }\n                }\n\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\n            }\n        }\n\n        var always = function(data) {\n            if (tripwire.signatures.undo[viewingSystemID].length > 0) {\n                $(\"#undo\").removeClass(\"disabled\");\n            }\n        }\n\n        tripwire.refresh('refresh', data, success, always);\n    }\n}\n","var activity = new function() {\n\tthis.graph;\n\tthis.options;\n\tthis.view;\n\tthis.span = 24;\n\tthis.columns = [\n\t\t{id: \"time\", label: \"Time\", role: \"domain\", type: \"string\", calc: function(d, r) { return d.getValue(r, 0) + \"h\"; }},\n\t\t{id: \"jumps\", label: \"Jumps\", role: \"data\", type: \"number\", sourceColumn: 1, column: 1, title: \"Jumps\"},\n\t\t{id: \"podkills\", label: \"Pod Kills\", role: \"data\", type: \"number\", sourceColumn: 2, column: 2, title: \"Pod Kills\"},\n\t\t{id: \"shipkills\", label: \"Ship Kills\", role: \"data\", type: \"number\", sourceColumn: 3, column: 3, title: \"Ship Kills\"},\n\t\t{id: \"npckills\", label: \"NPC Kills\", role: \"data\", type: \"number\", sourceColumn: 4, column: 4, title: \"NPC Kills\"},\n\t\t//{id: \"annotationLabel\", label: \"Test\", role: \"annotation\", type: \"string\", sourceColumn: 5, title: \"Test\"},\n\t\t//{id: \"annotationText\", label: \"Test\", role: \"annotationText\", type: \"string\", sourceColumn: 6, title: \"Test\"}\n\t];\n\n\tthis.getData = function(span, cache) {\n\t\tvar span = typeof(span) !== \"undefined\" ? span : this.span;\n\t\tvar cache = typeof(cache) !== \"undefined\" ? cache : true;\n\n\t\t// Google hasn't finished loading yet\n\t\tif (!activity.graph) {\n\t\t\t\tsetTimeout(function() {activity.getData(span, cache)}, 500);\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn $.ajax({\n\t\t\turl: \"activity_graph.php\",\n\t\t\tdata: {systemID: viewingSystemID, time: span},\n\t\t\ttype: \"GET\",\n\t\t\tdataType: \"JSON\",\n\t\t\tcache: cache\n\t\t}).done(function(json) {\n\t\t\tif (json) {\n\t\t\t\tjson.rows.reverse();\n\t\t\t\tactivity.view = new google.visualization.DataView(new google.visualization.DataTable(json));\n\t\t\t\tactivity.view.setColumns(activity.columns);\n\t\t\t\tactivity.graph.draw(activity.view, activity.options);\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.selectHandler = function() {\n\t\tvar selections = activity.graph.getSelection();\n\n\t\tif (selections[0] && selections[0].row == null) {\n\t\t\tvar c = selections[0].column;\n\n\t\t\tif (activity.columns[c].sourceColumn) {\n\t\t\t\t//activity.columns[c].calc = function() { return null };\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title + \" (off)\";\n\t\t\t\tdelete activity.columns[c].sourceColumn;\n\t\t\t} else {\n\t\t\t\tactivity.columns[c].sourceColumn = activity.columns[c].column;\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title;\n\t\t\t\t//delete activity.columns[c].calc;\n\t\t\t}\n\n\t\t\tactivity.view.setColumns(activity.columns);\n\t\t\tactivity.options.animation.duration = 0;\n\t\t\tactivity.graph.draw(activity.view, activity.options);\n\t\t\tactivity.options.animation.duration = 500;\n\t\t}\n\t}\n\n\tthis.init = function() {\n\t\tactivity.graph = new google.visualization.AreaChart(document.getElementById(\"activityGraph\"));\n\t\tactivity.options = {\n\t\t\tisStacked: false,\n\t\t\tbackgroundColor: \"transparent\",\n\t\t\thAxis: {textStyle: {color: \"#999\", fontName: \"Verdana\", fontSize: 10}, showTextEvery: 3},\n\t\t\tvAxis: {textStyle: {color: \"#666\", fontName: \"Verdana\", fontSize: 10}, viewWindowMode: \"maximized\", viewWindow: {min: 0}, maxValue: 5},\n\t\t\tgridlineColor: \"#454545\",\n\t\t\tpointSize: 2,\n\t\t\tlineWidth: 1,\n\t\t\tchartArea: {left: \"10%\", top: \"5%\", width: \"88%\", height: \"85%\"},\n\t\t\tlegend: {position: \"in\", textStyle: {color: \"#CCC\", fontName: \"Verdana\", fontSize: 8.5}},\n\t\t\tanimation: {duration: 500, easing: \"inAndout\"},\n\t\t\ttooltip: {showColorCode: true},\n\t\t\tannotations: {style: \"line\", textStyle: {fontSize: 12, color: \"#ccc\"}, domain: 0},\n\t\t\tfocusTarget: \"category\"\n\t\t}\n\n\t\tgoogle.visualization.events.addListener(activity.graph, \"select\", activity.selectHandler);\n\n\t\tactivity.getData(activity.span);\n\t}\n\n\tthis.time = function(span) {\n\t\tswitch(span) {\n\t\t\tcase 24:\n\t\t\t\tthis.options.hAxis.showTextEvery = 3;\n\t\t\t\tbreak;\n\t\t\tcase 48:\n\t\t\t\tthis.options.hAxis.showTextEvery = 6;\n\t\t\t\tbreak;\n\t\t\tcase 168:\n\t\t\t\tthis.options.hAxis.showTextEvery = 24;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.span = span;\n\t\tthis.getData(span);\n\t}\n\n\tthis.redraw = function() {\n\t\tthis.graph.draw(this.view, this.options);\n\t}\n\n\tthis.refresh = function(cache) {\n\t\tthis.getData(this.span, cache);\n\t}\n\n\tgoogle.charts.setOnLoadCallback(this.init);\n}\n","var CKConfig = {\n\tskin: \"custom\",\n\theight: 100,\n\tallowedContent: true,\n\textraPlugins: \"toolbarswitch,autogrow,autolink\",\n\tenterMode: CKEDITOR.ENTER_BR,\n\tremoveDialogTabs: 'link:advanced',\n\tautoGrow_onStartup: true,\n\tautoGrow_minHeight: 100,\n\ttoolbar_minToolbar: [\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\"]},\n\t\t{name: \"paragraph\", items: [\"BulletedList\", \"Outdent\", \"Indent\"]},\n\t\t{name: \"links\", items: [\"Link\"]},\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\n\t\t{name: \"styles\", items: [\"FontSize\"]},\n\t\t{name: \"tools\", items: [\"Toolbarswitch\"]}\n\t],\n\ttoolbar_maxToolbar: [\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\", \"Subscript\", \"Superscript\"]},\n\t\t{name: \"paragraph\", items: [\"NumberedList\", \"BulletedList\", \"Outdent\", \"Indent\"]},\n\t\t{name: \"links\", items: [\"Link\"]},\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\n\t\t{name: \"styles\", items: [\"FontSize\", \"Font\"]},\n\t\t{name: \"tools\", items: [\"Source\", \"Toolbarswitch\"]}\n\t],\n\ttoolbar: \"minToolbar\",\n\tsmallToolbar: \"minToolbar\",\n\tmaximizedToolbar: \"maxToolbar\",\n\tfontSize_style: {\n\t    element:        'span',\n\t    styles:         { 'font-size': '#(size)' },\n\t    overrides:      [ { element :'font', attributes: { 'size': null } } ]\n\t}\n}\n\nCKEDITOR.on(\"instanceLoaded\", function(cke) {\n\tcke.editor.on(\"contentDom\", function() {\n\t\tcke.editor.on(\"key\", function(e) {\n\t\t\tif (e.data.keyCode == 27) {\n\t\t\t\t// escape key cancels\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentCancel\").click();\n\t\t\t\treturn false;\n\t\t\t} else if (e.data.domEvent.$.altKey && e.data.domEvent.$.keyCode == 83) {\n\t\t\t\t// alt+s saves\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentSave\").click();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t});\n\n\t$(\".cke_combo__font a\")\n\t\t.removeClass(\"cke_combo_button\")\n\t\t.addClass(\"cke_button cke_button_off\")\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\n\n\t$(\".cke_combo__fontsize a\")\n\t\t.removeClass(\"cke_combo_button\")\n\t\t.addClass(\"cke_button cke_button_off\")\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\n});\n\nCKEDITOR.on(\"instanceReady\", function(cke) {\n\t// ensure focus on init\n\tcke.editor.focus();\n\n\tvar s = cke.editor.getSelection(); // getting selection\n\tvar selected_ranges = s.getRanges(); // getting ranges\n\tvar node = selected_ranges[0].startContainer; // selecting the starting node\n\tvar parents = node.getParents(true);\n\n\tnode = parents[parents.length - 2].getFirst();\n\n\tif (!node) return false;\n\n\twhile (true) {\n\t\tvar x = node.getNext();\n\t\tif (x == null) {\n\t\t\tbreak;\n\t\t}\n\t\tnode = x;\n\t}\n\n\ts.selectElement(node);\n\tselected_ranges = s.getRanges();\n\tselected_ranges[0].collapse(false);  //  false collapses the range to the end of the selected node, true before the node.\n\ts.selectRanges(selected_ranges);  // putting the current selection there\n});\n\nCKEDITOR.on(\"dialogDefinition\", function(ev) {\n\tif (ev.data.name == 'link') {\n\t\tev.data.definition.getContents('target').get('linkTargetType')['default'] = '_blank';\n\t}\n});\n","$(\"#admin\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\")) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!$(\"#dialog-admin\").hasClass(\"ui-dialog-content\")) {\r\n\t\tvar refreshTimer = null;\r\n\t\tvar $total = null;\r\n\t\tvar $ajax = null;\r\n\r\n\t\tfunction refreshWindow() {\r\n\t\t\tif ($ajax) $ajax.abort();\r\n\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\r\n\t\t\t$ajax = $.ajax({\r\n\t\t\t\turl: \"admin.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: {mode: $(\"#dialog-admin .menu .active\").attr(\"data-window\")},\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.results) {\r\n\t\t\t\t\tvar rows = data.results;\r\n\t\t\t\t\tvar ids = [];\r\n\r\n\t\t\t\t\tfor (var i = 0, l = rows.length; i < l; i++) {\r\n\t\t\t\t\t\tvar $row = $(\"#dialog-admin .window .hasFocus tbody tr[data-id='\"+ rows[i].id +\"']\");\r\n\t\t\t\t\t\tids.push(rows[i].id);\r\n\r\n\t\t\t\t\t\tif ($row.length) {\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? Intl.NumberFormat().format(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$row = $(\"#dialog-admin .window .hasFocus table tr.hidden\").clone();\r\n\t\t\t\t\t\t\t$row.attr(\"data-id\", rows[i].id);\r\n\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? Intl.NumberFormat().format(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$row.removeClass(\"hidden\");\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-admin .window .hasFocus tbody\").append($row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").each(function() {\r\n\t\t\t\t\t\tif ($.inArray($(this).data(\"id\").toString(), ids) == -1) {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table\").trigger(\"update\", [true]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\t\t\t});\r\n\r\n\t\t\tif ($(\"#dialog-admin\").dialog(\"isOpen\") && $(\"#dialog-admin .menu .active\").attr(\"data-refresh\")) {\r\n\t\t\t\trefreshTimer = setTimeout(refreshWindow, $(\"#dialog-admin .menu .active\").attr(\"data-refresh\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#dialog-admin\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tmodal: true,\r\n\t\t\theight: 350,\r\n\t\t\twidth: 800,\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t// menu toggle\r\n\t\t\t\t$(\"#dialog-admin\").on(\"click\", \".menu li\", function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$menuItem = $(this);\r\n\t\t\t\t\tclearTimeout(refreshTimer);\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .menu .active\").removeClass(\"active\");\r\n\t\t\t\t\t$menuItem.addClass(\"active\");\r\n\t\t\t\t\t$(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\").html(\"\");\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window]\").removeClass(\"hasFocus\").hide();\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window='\"+ $menuItem.data(\"window\") +\"']\").addClass(\"hasFocus\").show();\r\n\r\n\t\t\t\t\trefreshWindow();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-admin [data-sortable='true']\").tablesorter({\r\n\t\t\t\t\tsortReset: true,\r\n\t\t\t\t\twidgets: ['saveSort'],\r\n\t\t\t\t\tsortList: [[0,0]]\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// dialog bottom tray\r\n\t\t\t\t$($(this)[0].parentElement).find(\".ui-dialog-buttonpane\").append(\"<div class='ui-dialog-traypane'></div>\");\r\n\t\t\t\t$total = $(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\");\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$menuItem = $(\"#dialog-admin .menu li.active\");\r\n\t\t\t\trefreshWindow();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-admin\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-admin\").dialog(\"open\");\r\n\t}\r\n});\r\n","// Dialog effects\r\n$(\"#wrapper\").addClass(\"transition\");\r\n\r\n$(document).on(\"dialogopen\", \".ui-dialog\", function (event, ui) {\r\n\t// Add additional full screen overlay for 2nd level dialog\r\n\tif ($(\".ui-dialog:visible\").length == 2 && $(this).hasClass(\"dialog-modal\"))\r\n\t\t$(\"body\").append($(\"<div id='overlay' class='overlay' />\").css(\"z-index\", $(this).css(\"z-index\") - 1));\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 1);\r\n\r\n\tif (!$(this).hasClass(\"dialog-noeffect\"))\r\n\t\t$(\"#wrapper\").addClass(\"blur\");\r\n});\r\n\r\n$(document).on(\"dialogclose\", \".ui-dialog\", function (event, ui) {\r\n\tif (!$(\".ui-dialog\").is(\":visible\"))\r\n\t\t$(\"#wrapper\").removeClass(\"blur\");\r\n\r\n\tif ($(\".ui-dialog:visible\").length == 1)\r\n\t\t$(\"#overlay\").remove();\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 2);\r\n\r\n\t//if ($(\".ui-dialog:visible\").length == 0 && options.buttons.follow && viewingSystemID != tripwire.client.EVE.systemID)\r\n\t//\twindow.location = \"?system=\"+tripwire.client.EVE.systemName;\r\n});\r\n\r\n","$(\".options\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\r\n\t$(\"#dialog-options\").dialog({\r\n\t\tautoOpen: false,\r\n\t\twidth: 450,\r\n\t\tminHeight: 400,\r\n\t\tmodal: true,\r\n\t\tbuttons: {\r\n\t\t\tSave: function() {\r\n\t\t\t\t// Options\r\n\t\t\t\tvar data = {mode: \"set\", options: JSON.stringify(options)};\r\n\t\t\t\tvar maskChange = false;\r\n\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\toptions.chain.typeFormat = $(\"#dialog-options #typeFormat\").val();\r\n\t\t\t\toptions.chain.classFormat = $(\"#dialog-options #classFormat\").val();\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.sigNameLocation = $(\"#dialog-options #chainSigNameLocation\").val();\r\n\t\t\t\toptions.chain.routingLimit = 1 * $(\"#dialog-options #chainRoutingLimit\").val();\r\n\t\t\t\toptions.chain.routeSecurity = $(\"#dialog-options #chainRouteSecurity\").val();\r\n\t\t\t\toptions.chain.routeIgnore.enabled = $(\"#dialog-options #route-ignore-enabled\").prop('checked');\r\n\t\t\t\toptions.chain.routeIgnore.systems = $(\"#dialog-options #route-ignore\").val().split(\",\").map(x => x.trim());\r\n\r\n\t\t\t\toptions.chain.gridlines = JSON.parse($(\"#dialog-options input[name=gridlines]:checked\").val());\r\n\r\n\t\t\t\toptions.chain[\"node-reference\"] = $(\"#dialog-options input[name=node-reference]:checked\").val();\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.renderer = $(\"#dialog-options #renderer\").val();\r\n\r\n\t\t\t\toptions.signatures.editType = $(\"#dialog-options #editType\").val();\r\n\r\n\t\t\t\toptions.signatures.pasteLife = $(\"#dialog-options #pasteLife\").val();\r\n\r\n\t\t\t\toptions.signatures.copySeparator = $(\"#dialog-options #copySeparator\").val();\r\n\r\n\t\t\t\toptions.background = $(\"#dialog-options #background-image\").val();\r\n\r\n\t\t\t\toptions.uiscale = $(\"#dialog-options #uiscale-slider\").slider(\"value\");\r\n\r\n\t\t\t\tif (options.masks.active != $(\"#dialog-options input[name='mask']:checked\").val()) {\r\n\t\t\t\t\tmaskChange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.masks.active = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\r\n\t\t\t\toptions.apply();\r\n\t\t\t\toptions.save() // Performs AJAX\r\n\t\t\t\t\t.done(function() {\r\n\t\t\t\t\t\tif (maskChange) {\r\n\t\t\t\t\t\t\t// Reset signatures\r\n\t\t\t\t\t\t\t$(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n\t\t\t\t\t\t\t$(\"#sigTable tbody\").empty()\r\n\t\t\t\t\t\t\t$(\"#signature-count\").html(0);\r\n\t\t\t\t\t\t\ttripwire.signatures.list = {};\r\n\t\t\t\t\t\t\ttripwire.client.signatures = [];\r\n\r\n\t\t\t\t\t\t\ttripwire.refresh('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", false).removeClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t$(\"#dialog-options input[name='mask']:checked\").data(\"admin\") ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t},\r\n\t\t\tReset: function() {\r\n\t\t\t\t$(\"#dialog-confirm #msg\").html(\"Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tReset: function() {\r\n\t\t\t\t\t\t\toptions.reset();\r\n\t\t\t\t\t\t\toptions.apply();\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t},\r\n\t\t\tClose: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t// Get user stats data\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"user_stats.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tfor (i in data.stats) {\r\n\t\t\t\t\tfor (x in data.stats[i]) {\r\n\t\t\t\t\t\t$(\"#optionsAccordion #\"+ x).text(data.stats[i][x]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\"#optionsAccordion #systems_visited\").text(data.system_visits);\r\n\t\t\t\t$(\"#optionsAccordion #logins\").text(data.account.logins);\r\n\t\t\t\t$(\"#optionsAccordion #lastLogin\").text(data.account.lastLogin);\r\n\t\t\t\t$(\"#optionsAccordion #username\").text(data.username);\r\n\t\t\t});\r\n\r\n\t\t\t// Get masks\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"masks.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #editType\").val(options.signatures.editType);\r\n\t\t\t$(\"#dialog-options #pasteLife\").val(options.signatures.pasteLife);\r\n\t\t\t$(\"#dialog-options #copySeparator\").val(options.signatures.copySeparator);\r\n\t\t\t$(\"#dialog-options #typeFormat\").val(options.chain.typeFormat);\r\n\t\t\t$(\"#dialog-options #chainRoutingLimit\").val(options.chain.routingLimit);\r\n\t\t\t$(\"#dialog-options #chainSigNameLocation\").val(options.chain.sigNameLocation);\r\n\t\t\t$(\"#dialog-options #chainRouteSecurity\").val(options.chain.routeSecurity);\r\n\t\t\t$(\"#dialog-options #route-ignore-enabled\").prop('checked', options.chain.routeIgnore.enabled);\r\n\t\t\t$(\"#dialog-options #route-ignore\").val(options.chain.routeIgnore.systems.join(','));\r\n\t\t\t$(\"#dialog-options #renderer\").val(options.chain.renderer);\r\n\t\t\t$(\"#dialog-options #classFormat\").val(options.chain.classFormat);\r\n\t\t\t$(\"#dialog-options input[name='node-reference'][value='\"+options.chain[\"node-reference\"]+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='gridlines'][value='\"+options.chain.gridlines+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options #background-image\").val(options.background);\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#optionsAccordion\").accordion({heightStyle: \"content\", collapsible: true, active: false});\r\n\r\n\t\t\t$(\"#uiscale-slider\").slider({\r\n\t\t\t\tmin: 0.7,\r\n\t\t\t\tmax: 1.4,\r\n\t\t\t\tstep: 0.05,\r\n\t\t\t\tvalue: options.uiscale || 1.0,\r\n\t\t\t\tchange: function(e, ui) {\r\n\t\t\t\t\t$(\"body\").css(\"zoom\", ui.value);\r\n\t\t\t\t},\r\n\t\t\t\tslide: function(e, ui) {\r\n\t\t\t\t\t$(\"label[for='uiscale-slider']\").html(ui.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"label[for='uiscale-slider']\").html($(\"#uiscale-slider\").slider(\"value\"));\r\n\r\n\t\t\t$(\"#dialog-pwChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#pwForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#pwForm input[name='password'], #pwForm input[name='confirm']\").val(\"\");\r\n\t\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-pwChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Password changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-pwChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#pwError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#pwError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-usernameChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#usernameForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#usernameForm #username\").html($(\"#dialog-options #username\").html());\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#usernameForm [name='username']\").val(\"\");\r\n\t\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Username changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #username\").html(response.result);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Mask selections\r\n\t\t\t$(\"#masks\").on(\"change\", \"input.selector:checked\", function() {\r\n\t\t\t\tif ($(this).data(\"owner\")) {\r\n\t\t\t\t\t$(\"#maskControls #edit\").removeAttr(\"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#maskControls #edit\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(this).val() != 0.0 && $(this).val().split(\".\")[1] == 0) {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-options #leave\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mask join\r\n\t\t\t$(\"#dialog-joinMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tvar mask = $(\"#dialog-joinMask #results input:checked\");\r\n\t\t\t\t\t\tvar label = $(\"#dialog-joinMask #results input:checked+label\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: {mask: mask.val(), mode: \"join\"},\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\tlabel.css(\"width\", \"\");\r\n\t\t\t\t\t\t\t\tlabel.find(\".info\").remove();\r\n\t\t\t\t\t\t\t\tlabel.append('<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+response.type+\" input.selector:last\").before(mask).before(label);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-joinMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").show();\r\n\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.eveIDs)\r\n\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar mask = response.results[x];\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+mask.mask+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"false\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+mask.mask+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+mask.label+'</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].category == \"character\" ? results[x].corporation.name +'<br/>' : null)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-joinMask #results\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(function() {\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").hide();\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-joinMask input[name='name']\").val(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \"input[name='find']+label\", function() {\r\n\t\t\t\t$(\"#dialog-joinMask input[name='find']\").val($(this).prev().val());\r\n\t\t\t\t$(\"#dialog-joinMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask leave\r\n\t\t\t$(\"#dialog-options #masks\").on(\"click\", \".closeIcon\", function() {\r\n\t\t\t\tvar mask = $(this).closest(\"input.selector+label\").prev();\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to remove this mask?\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tRemove: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"leave\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask delete\r\n\t\t\t$(\"#maskControls #delete\").click(function() {\r\n\t\t\t\tvar mask = $(\"#masks input.selector:checked\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to delete this mask?\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tDelete: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"delete\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// User Create mask\r\n\t\t\t$(\"#dialog-createMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tCreate: function() {\r\n\t\t\t\t\t\t$(\"#dialog-createMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \"#create_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t// Get masks\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #default\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #personal\").append(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options #masks #corporate\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\t\t\t\t\t\tresponse.masks[response.active].admin ? $(\"#admin\").removeClass(\"disabled\") : $(\"#admin\").addClass(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-createMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask select\").selectmenu({width: 100});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #create\").click(function() {\r\n\t\t\t\t$(\"#dialog-createMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t$(this).closest(\"input.selector+label\").prev().remove();\r\n\t\t\t\t$(this).closest(\"label\").remove();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-editMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t\t\t$(this).closest(\"input.selector+label\").prev().attr(\"name\", \"deletes[]\").hide();\r\n\t\t\t\t\t\t$(this).closest(\"label\").hide();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \"#edit_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\tvar mask = $(\"#dialog-options input[name='mask']:checked\").val();\r\n\t\t\t\t\t$(\"#dialog-editMask input[name='mask']\").val(mask);\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").hide();\r\n\t\t\t\t\t$(\"#dialog-editMask #loading\").show();\r\n\t\t\t\t\t$(\"#dialog-editMask #name\").text($(\"#dialog-options input[name='mask']:checked+label .selector_label\").text());\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: {mode: \"edit\", mask: mask},\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.results)\r\n\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").show();\r\n\t\t\t\t\t\t$(\"#dialog-editMask #loading\").hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #edit\").click(function() {\r\n\t\t\t\t$(\"#dialog-editMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// EVE search dialog\r\n\t\t\t$(\"#dialog-EVEsearch\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tif ($(\"#accessList input[value='\"+$(\"#EVESearchResults input\").val()+\"']\").length) {\r\n\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Already has access\");\r\n\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults .info\").append('<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />');\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"checked\", \"checked\");\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"onclick\", \"return false\");\r\n\r\n\t\t\t\t\t\tvar nodes = $(\"#EVESearchResults .maskNode:has(input:checked)\");\r\n\r\n\t\t\t\t\t\tif ($(\"#dialog-createMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-createMask #accessList .static:first\").before(nodes);\r\n\t\t\t\t\t\telse if ($(\"#dialog-editMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(nodes);\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tClose: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#EVEsearch\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ($(\"#EVEsearch input[name='name']\").val() == \"\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").show();\r\n\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t\t\ttripwire.esi.search($(\"#EVEsearch input[name='name']\").val(), $(\"#EVEsearch input[name='category']:checked\").val(), $(\"#EVEsearch input[name='exact']\")[0].checked)\r\n\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\tif (results && (results.character || results.corporation)) {\r\n\t\t\t\t\t\t\t\t\t// limit results\r\n\t\t\t\t\t\t\t\t\tresults = $.merge(results.character || [], results.corporation || []);\r\n\t\t\t\t\t\t\t\t\ttotal = results.length;\r\n\t\t\t\t\t\t\t\t\tresults = results.slice(0, 10);\r\n\t\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(results)\r\n\t\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchCount\").html(\"Found: \"+total+\"<br/>Showing: \"+(total<10?total:10));\r\n\t\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#EVEsearch input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-options\").dialog(\"open\");\r\n});\r\n","\t\t$(\"#dialog-ping\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tSend: function() {\r\n\t\t\t\t\tvar payload = {systemName: this.systemName, systemText: this.systemText, message: $('#ping-text').val() };\r\n\t\t\t\t\tconst _this = this;\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"ping.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: payload,\r\n\t\t\t\t\t\tdataType: \"text\"\r\n\t\t\t\t\t}).done(function(data) {\t$(_this).dialog(\"close\"); })\r\n\t\t\t\t\t.fail(function(xhr, status, error) { console.log(status, error); });\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tconst wormholeID = $(this).data(\"id\");\r\n\t\t\t\tconst systemID = $(this).data(\"systemID\");\r\n\t\t\t\tconst wormhole = tripwire.client.wormholes[wormholeID];\r\n\t\t\t\tconst fromSignature = wormhole ? tripwire.client.signatures[wormhole.initialID] : { name: null};\r\n\t\t\t\t\r\n\t\t\t\tthis.systemName = tripwire.systems[systemID].name;\r\n\t\t\t\tthis.systemText = this.systemName + (fromSignature.name !== null && fromSignature.name.length ? ' (' + fromSignature.name + ')' : '');\r\n\t\t\t\t\r\n\t\t\t\t$(\"#dialog-ping\").dialog(\"option\", \"title\", \"Ping about \"+this.systemText);\r\n\t\t\t\t$('#ping-text').val('');\r\n\t\t\t\t$('#ping-text').focus();\r\n\t\t\t}\r\n\t\t});","$(\"#signaturesWidget\").on(\"click\", \"#delete-signature\", function(e) {\n\te.preventDefault();\n\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\n\t\treturn false;\n\t} else if ($(\"#sigTable tr.selected\").length == 0) {\n\t\treturn false;\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\n\t\treturn false;\n\t}\n\n\t// check if dialog is open\n\tif (!$(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\")) {\n\t\t$(\"#dialog-deleteSig\").dialog({\n\t\t\tresizable: false,\n\t\t\tminHeight: 0,\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\n\t\t\tbuttons: {\n\t\t\t\tDelete: function() {\n\t\t\t\t\t// Prevent duplicate submitting\n\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"disable\");\n\t\t\t\t\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\n\t\t\t\t\tvar undo = [];\n\n\t\t\t\t\tvar signatures = $.map($(\"#sigTable tr.selected\"), function(n) {\n\t\t\t\t\t\tvar signature = tripwire.client.signatures[$(n).data(\"id\")];\n\t\t\t\t\t\tif (signature.type != \"wormhole\") {\n\t\t\t\t\t\t\tundo.push(signature);\n\t\t\t\t\t\t\treturn signature.id;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\n\t\t\t\t\t\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\n\t\t\t\t\t\t\treturn wormhole;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tpayload.signatures.remove = signatures;\n\n\t\t\t\t\tvar success = function(data) {\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\n\t\t\t\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"close\");\n\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar always = function(data) {\n\t\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\n\t\t\t\t\t}\n\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\n\t\t\t\t},\n\t\t\t\tCancel: function() {\n\t\t\t\t\t$(this).dialog(\"close\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tclose: function() {\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\n\t\t\t\t//$(\"#sigTable .sigDelete\").removeClass(\"invisible\");\n\t\t\t}\n\t\t});\n\t} else if (!$(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\n\t\t$(\"#dialog-deleteSig\").dialog(\"open\");\n\t}\n});\n","const sigDialog = {};\r\nconst sigDialogVM = {};\r\n\r\nsigDialog.openSignatureDialog = function(e) {\r\n\tif(e.preventDefault) { e.preventDefault(); }\t// Allow calls with fake event-like objects too\r\n\tsigDialogVM.mode = e.data.mode;\r\n\t\r\n\tswitch(sigDialogVM.mode) {\r\n\t\tcase 'update':\r\n\t\t\tif (e.data.source == \"sig-row\") {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\t\t\t\tsigDialogVM.sigId = $(this).data('id');\r\n\t\t\t} else if (e.data.source == \"edit-sig\") {\r\n\t\t\t\tvar elements = $(\"#sigTable tbody tr.selected\");\r\n\t\t\t\tif (elements.length !== 1) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsigDialogVM.sigId = $(elements[0]).data('id');\r\n\t\t\t\t}\r\n\t\t\t} else { sigDialogVM.sigId = e.data.signature; }\r\n\t\t\tbreak;\r\n\t\tdefault: delete sigDialogVM.sigId;\r\n\t}\r\n\t\r\n\tsigDialogVM.viewingSystemID = ( sigDialogVM.sigId ) ? tripwire.client.signatures[sigDialogVM.sigId].systemID : viewingSystemID;\r\n\tsigDialogVM.viewingSystem = tripwire.systems[sigDialogVM.viewingSystemID];\r\n\t\r\n\tif (!$(\"#dialog-signature\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-signature\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#signaturesWidget\")},\r\n\t\t\tbuttons: {\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tAdd: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\tvar aSigWormholes = $.map(tripwire.wormholes, function(item, index) { return index;});\r\n\t\t\t\taSigWormholes.splice(26, 0, \"K162\");\r\n\t\t\t\taSigWormholes.push(\"GATE\");\r\n\t\t\t\taSigWormholes.push(\"SML\");\r\n\t\t\t\taSigWormholes.push(\"MED\");\r\n\t\t\t\taSigWormholes.push(\"LRG\");\r\n\t\t\t\taSigWormholes.push(\"XLG\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigType']\").inlinecomplete({source: aSigWormholes, maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").durationPicker();\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").on(\"change\", function() {\r\n\t\t\t\t\t// prevent negative values\r\n\t\t\t\t\tif (this.value < 0) {\r\n\t\t\t\t\t\tthis.value = 0;\r\n\t\t\t\t\t\t$(this).change();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure first signature ID field only accepts letters\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[a-zA-Z?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Move to the numeric ID after filling out alpha ID\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID2_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure second signature ID field only accepts numbers\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[0-9?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Select value on click\r\n\t\t\t\t$(\"#dialog-signature .signatureID, #dialog-signature .wormholeType\").on(\"click\", function() {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Auto fill opposite side wormhole w/ K162\r\n\t\t\t\t$(\"#dialog-signature .wormholeType\").on(\"input, change\", function() {\r\n\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) != -1 && this.value.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\r\n\t\t\t\t\t\t// Also auto calculate duration\r\n\t\t\t\t\t\tif (tripwire.wormholes[this.value.toUpperCase()]) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(tripwire.wormholes[this.value.toUpperCase()].life.substring(0, 2) * 60 * 60).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value.toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\tif ($.inArray($(\"#dialog-signature .wormholeType\").not(this).val().toUpperCase(), aSigWormholes) === -1 || $(\"#dialog-signature .wormholeType\").not(this).val().toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"????\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value == \"????\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Toggle between wormhole and regular signatures\r\n\t\t\t\t$(\"#dialog-signature\").on(\"selectmenuchange\", \"[name='signatureType']\", function() {\r\n\t\t\t\t\tif (this.value == \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#form-signature\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar form = $(this).serializeObject();\r\n\t\t\t\t\tvar valid = true;\r\n\t\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t\t// Validate full signature ID fields (blank | 3 characters)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .signatureID:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.length < 3) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be 3 characters in length!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate full signature ID doesn't already exist in current system\r\n\t\t\t\t\tif (form.signatureID_Alpha.length === 3 && form.signatureID_Numeric.length === 3 && Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric, true) != false && Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric, true).id != $(\"#dialog-signature\").data(\"signatureid\")) {\r\n\t\t\t\t\t\tvar existingSignature = Object.find(tripwire.client.signatures, \"signatureID\", form.signatureID_Alpha + form.signatureID_Numeric);\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature .signatureID:first\")}).setContent(\"Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='\"+ existingSignature.id +\"' />\");\r\n\t\t\t\t\t\t$(\"#overwrite\").focus();\r\n\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate wormhole types (blank | wormhole)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .wormholeType:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && $.inArray(this.value.toUpperCase(), aSigWormholes) == -1 && this.value != \"????\") {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid wormhole type!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to system (blank | system)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && tripwire.aSigSystems.findIndex((item) => this.value.toLowerCase() === item.toLowerCase()) == -1) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to isn't the viewing system which causes a inner loop\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.toLowerCase() === sigDialogVM.viewingSystem.name.toLowerCase()) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Wormhole cannot lead to the same system it comes from!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\tvar payload = {};\r\n\t\t\t\t\tvar undo = [];\r\n\t\t\t\t\tif (form.signatureType === \"wormhole\") {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar leadsTo = null;\r\n\t\t\t\t\t\tif (Object.index(tripwire.systems, \"name\", form.leadsTo, true)) {\r\n\t\t\t\t\t\t\t// Leads To is a normal EVE system, so use the sytem ID\r\n\t\t\t\t\t\t\tleadsTo = Object.index(tripwire.systems, \"name\", form.leadsTo, true)\r\n\t\t\t\t\t\t} else if (tripwire.wormholes[form.wormholeType.toUpperCase()]) {\r\n\t\t\t\t\t\t\t// Leads To can be determined by the wormhole type, so lets use what we know it leads to\r\n\t\t\t\t\t\t\tif (tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase()) > -1) {\r\n\t\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => tripwire.wormholes[form.wormholeType.toUpperCase()].leadsTo.replace(' ', '-').toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase()) !== -1) {\r\n\t\t\t\t\t\t\t// Leads To is one of the valid types we allow, so use of of those indexes as reference\r\n\t\t\t\t\t\t\tleadsTo = tripwire.aSigSystems.findIndex((item) => form.leadsTo.toLowerCase() === item.toLowerCase());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar signature2 = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID2_Alpha + form.signatureID2_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": leadsTo,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName2,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar type = null;\r\n\t\t\t\t\t\tvar parent = null;\r\n\t\t\t\t\t\tif (form.wormholeType.length > 0 && $.inArray(form.wormholeType.toUpperCase(), aSigWormholes) != -1 && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && $.inArray(form.wormholeType2.toUpperCase(), aSigWormholes) != -1 && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar wormhole = {\r\n\t\t\t\t\t\t\t\"type\": type,\r\n\t\t\t\t\t\t\t\"parent\": parent,\r\n\t\t\t\t\t\t\t\"life\": form.wormholeLife,\r\n\t\t\t\t\t\t\t\"mass\": form.wormholeMass\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (sigDialogVM.mode == \"update\") {\r\n\t\t\t\t\t\t\tsignature.id = $(\"#dialog-signature\").data(\"signatureid\");\r\n\t\t\t\t\t\t\tsignature2.id = $(\"#dialog-signature\").data(\"signature2id\");\r\n\t\t\t\t\t\t\twormhole.id = $(\"#dialog-signature\").data(\"wormholeid\");\r\n\r\n\t\t\t\t\t\t\t// Update the initial and type based on which side of the wormhole we are editing\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\tif (form.wormholeType.length > 0 && $.inArray(form.wormholeType.toUpperCase(), aSigWormholes) != -1 && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && $.inArray(form.wormholeType2.toUpperCase(), aSigWormholes) != -1 && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (sigDialogVM.mode == \"update\") {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"id\": $(\"#dialog-signature\").data(\"signatureid\"),\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [signature]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\t\tvar signature2 = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [signature]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\r\n\t\t\t\t\t\t\tif (sigDialogVM.mode == \"add\") {\r\n\t\t\t\t\t\t\t\tundo = data.results;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (sigDialogVM.viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[sigDialogVM.viewingSystemID].push({action: sigDialogVM.mode, signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[sigDialogVM.viewingSystemID] = [{action: sigDialogVM.mode, signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function() {\r\n\t\t\t\t\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\r\n\t\t\t\t$(\"#dialog-signature input\").val(\"\");\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(\"unknown\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(\"stable\").selectmenu(\"refresh\");\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(\"stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature #site\").show();\r\n\t\t\t\t$(\"#dialog-signature #wormhole\").hide();\r\n\r\n\t\t\t\t// Side labels\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:first\").html(sigDialogVM.viewingSystem.name + \" Side\");\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:last\").html(\"Other Side\");\r\n\r\n\t\t\t\t// Default signature life\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").val(options.signatures.pasteLife * 60 * 60).change();\r\n\r\n\t\t\t\tvar id = sigDialogVM.sigId;\r\n\t\t\t\tif (sigDialogVM.mode == \"update\" && id && tripwire.client.signatures[id]) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[id];\r\n\t\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", id);\r\n\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").hide();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").show();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Edit Signature\");\r\n\r\n\t\t\t\t\tif (signature.type == \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == id || wormhole.secondaryID == id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", otherSignature.id);\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", wormhole.id);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst sigAlpha = signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\";\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(sigAlpha);\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='leadsTo']\").val(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : (tripwire.aSigSystems[otherSignature.systemID] ? tripwire.aSigSystems[otherSignature.systemID] : \"\"));\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Alpha']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Numeric']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName2']\").val(otherSignature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(wormhole.life).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(wormhole.mass).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\r\n\t\t\t\t\t\tif (wormhole[wormhole.parent+\"ID\"] == signature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t} else if (wormhole[wormhole.parent+\"ID\"] == otherSignature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType2']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Focus the sig ID, if it isn't set, otherwise the sig name\r\n\t\t\t\t\t\tif(sigAlpha != '???') { $(\"#dialog-signature input[name='wormholeName']\").select(); }\r\n\t\t\t\t\t\telse { $(\"#dialog-signature input[name='signatureID_Alpha']\").select(); }\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Not a wormhole - always focus the sig ID\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").select();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Hightlight first ID section, if not set, otherwise the name\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").show();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").hide();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Add Signature\");\r\n\r\n\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(options.signatures.editType || \"unknown\").selectmenu(\"refresh\")\r\n\t\t\t\t\tif ($(\"#dialog-signature [name='signatureType']\").val() === \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").hide();\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-signature\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-signature\").dialog(\"open\");\r\n\t}\r\n};\r\n\r\n$(\"#sigTable tbody\").on(\"dblclick\", \"tr\", {mode: \"update\", source:\"sig-row\"}, sigDialog.openSignatureDialog);\r\n$(\"#edit-signature\").on(\"click\", {mode: \"update\", source:\"edit-sig\"}, sigDialog.openSignatureDialog);\r\n$(\"#add-signature\").click({mode: \"add\"}, sigDialog.openSignatureDialog);\r\n\r\n// Signature overwrite. Attached to document because the element gets recreated each time\r\nsigDialog.overwriteSignature = function(sigToRemove, completeFunction, always) {\r\n\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\tvar undo = [];\r\n\r\n\tvar signature = tripwire.client.signatures[sigToRemove];\r\n\tif (signature.type != \"wormhole\") {\r\n\t\tundo.push(signature);\r\n\t\tpayload.signatures.remove.push(signature.id);\r\n\t} else {\r\n\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\tpayload.signatures.remove.push(wormhole);\r\n\t}\r\n\r\n\tvar success = function(data) {\r\n\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t} else {\r\n\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t}\r\n\r\n\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\r\n\t\tcompleteFunction(data);\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', payload, success, always);\r\n}\r\n\r\n/** Delegate the next action after sig overwrite to the save dialog */\r\nsigDialog.delegateSave = function(data) {\r\n\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\tValidationTooltips.close();\r\n\r\n\t\tif ($(\"#dialog-signature\").parent().find(\":button:contains('Save')\")) {\r\n\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").click();\r\n\t\t} else {\r\n\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Add')\").click();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n$(document).on(\"click\", \"#overwrite\", function() { \r\n\t$(\"#overwrite\").attr(\"disable\", true);\r\n\tsigDialog.overwriteSignature($(this).data(\"id\"), sigDialog.delegateSave, function() {\r\n\t\t$(\"#overwrite\").removeAttr(\"disable\");\r\n\t}); \r\n});\r\n","const mutator_favourite = new _FavouriteMutator();\r\nsystemAnalysis.addMutator(mutator_favourite);\r\n\r\nfunction _FavouriteMutator() {\r\n\tconst _this = this;\r\n\r\n\tthis.mutate = function(system, systemID) {\r\n\t\tif(options.favorites.indexOf(systemID * 1) >= 0) {\r\n\t\t\tsystem.pathSymbol = '★';\r\n\t\t\tsystem.systemTypeModifiers.push('<span class=\"favorite active\" data-icon=\"star\"></span>');\t\t// star added by CSS\r\n\t\t}\r\n\t}\r\n}","const invasions = new _Invasions();\r\nsystemAnalysis.addMutator(invasions);\r\n\r\nfunction _Invasions() {\r\n\tconst _this = this;\r\n\tconst pathSymbolMap = {\r\n\t\tstellar_reconnaissance: '◆',\r\n\t\t\r\n\t\ttriglavian_minor_victory: '▽',\r\n\t\tescalating_liminality: '▽',\r\n\t\tfinal_liminality: '▼',\r\n\t\t\r\n\t\tedencom_minor_victory: '△',\r\n\t\tredoubt: '△', bulwark: '△',\r\n\t\tfortress: '▲',\r\n\t};\r\n\tconst textMap = {\r\n\t\tstellar_reconnaissance: 'Stellar Reconnaissance',\r\n\t\t\r\n\t\ttriglavian_minor_victory: 'Triglavian Minor Victory',\r\n\t\tescalating_liminality: 'Escalating Liminality',\r\n\t\tfinal_liminality: 'Final Liminality',\r\n\t\t\r\n\t\tedencom_minor_victory: 'EDENCOM Minor Victory',\r\n\t\tredoubt: 'Redoubt',\r\n\t\tbulwark: 'Bulwark',\r\n\t\tfortress: 'EDENCOM Fortress',\r\n\t}\r\n\t\r\n\tthis.invasions = {};\r\n\t\r\n\t/** Update the system */\r\n\tthis.mutate = function(system, systemID) {\r\n\t\tconst systemInvasion = this.invasions[systemID];\r\n\t\tif(systemInvasion) {\r\n\t\t\tif(systemInvasion.derived_security_status) { system.security = 1 * systemInvasion.derived_security_status; }\r\n\t\t\tsystem.pathSymbol = pathSymbolMap[systemInvasion.status];\r\n\t\t\tconst tip = textMap[systemInvasion.status] +\r\n\t\t\t\t(systemInvasion.derived_security_status ? '<br>Effective security lowered to ' + systemInvasion.derived_security_status : '');\r\n\t\t\tsystem.systemTypeModifiers.push('<span class=\"invasion ' + systemInvasion.status + '\" data-tooltip=\"' + tip + '\">' + system.pathSymbol + '</span>');\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** Refresh the invasion data from the public Kybernauts API */\r\n\tthis.refresh = function() {\r\n\t\t$.ajax({\r\n\t\t\turl: 'cached_third_party.php?key=invasions',\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data, status, xhr) {\t\r\n\t\t\tif(!_.isEqual(data, _this.invasions)) {\r\n\t\t\t\tconsole.info('Updating map for invasions update');\r\n\t\t\t\t_this.invasions = _.keyBy(data, function(x) { return x.system_id; });\r\n\t\t\t\tchain.redraw();\r\n\t\t\t\ttripwire.systemChange(viewingSystemID);\r\n\t\t\t}\r\n\t\t}).fail(function(xhr, status, error) {\r\n\t\t\tconsole.warn('Failed to fetch invasion data from kybernaut.space: ' + status, error);\r\n\t\t});\r\n\t};\r\n\t\r\n\tsetInterval(this.refresh, 3600000);\r\n\tthis.refresh();\r\n}"]}